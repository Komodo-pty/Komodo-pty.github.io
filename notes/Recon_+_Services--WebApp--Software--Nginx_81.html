<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Nginx</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Nginx</h1><br/><p><a href="https://book.hacktricks.wiki/en/network-services-pentesting/pentesting-web/nginx.html">Hacktricks</a></p><p></p><p><h1>Automated Enumeration (nginxpwner)</h1></p><p>Run <a href="https://github.com/stark0de/nginxpwner">nginxpwner</a> inside a <a href="Appendix--Code--Python_77.html#python venv">Python Venv</a> to handle the dependencies for it &amp; its complimentary <a href="https://github.com/shibli2700/Kyubi">Github Repo</a>.</p><p></p><p><h2>Target Paths</h2></p><p>Supply a list of subdirectories &amp; files for tool to test. The relative URLs shouldn&#39;t start with a <strong>/</strong>. An easy method for compiling this list is to fuzz the Web App normally &amp; run it through burpsuite&#39;s Proxy to populate the Site Map.</p><p></p><p><strong>Site Map</strong> ↓ R Click the host ↓ <strong>Copy URLs in this host</strong> → Paste this into a file</p><p></p><p>Format the list. I added a shell script to the Repo&#39;s directory so you can just run <strong>./path_finder.sh</strong>. The following line outputs the formatted list to <strong>/tmp/pathlist</strong>.</p><p></p><p><em>cat $urllist | unfurl paths | cut -d&quot;/&quot; -f2-3 | sort -u &gt; /tmp/pathlist</em></p><p></p><p><h2>Basic Usage</h2></p><p>Run inside the Venv, specifying the root URL &amp; list of paths.</p><p></p><p><em>python3 nginxpwner.py http://10.10.128.87 /tmp/pathlist</em></p><p></p><p><h1>Misconfigurations</h1></p><p><h2>Alias LFI Misconfiguration</h2></p><p>[CTF D 10-11]</p><p></p><p>Configuration files for Nginx may have insecure use of the <strong>location</strong> directive, leading to LFI (or Directory Traversal?). The easiest way to detect this is with <strong>nginxpwner</strong>.</p><p></p><p>See <a href="Recon_+_Services--WebApp--Software--Nginx_81.html#Interesting Files">Interesting Files</a> for a list of Nginx specific files to target.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Note</span>: Target was giving 404 errors for certain web files that should&#39;ve been rendered with an LFI vuln. I&#39;m sure that the path was correct, so why?</p><p></p><p><h3>Example Config File</h3></p><p><span class="subheading">Vulnerable</span></p><p></p><p><strong>location /imgs {</strong><strong></strong></p><p><strong>    alias /path/images/;</strong><strong></strong></p><p><strong>}</strong></p><p></p><p><span class="subheading">Secure lmplementation</span>: Notice the slash following the location directory.</p><p></p><p><strong>location /imgs/ {</strong><strong></strong></p><p><strong>    alias /path/images/;</strong><strong></strong></p><p><strong>}</strong></p><p></p><p><h3>Exploitation</h3></p><p>You need to find the vulnerable endpoint &amp; Request it <span style="color:#ff0000;">without the</span><strong><span style="color:#ff0000;"> /</span></strong> before your LFI path.</p><p></p><p>For example, in this case, the vulnerable endpoint is <strong>/imgs</strong> &amp; it&#39;s translated to <strong>/path/images/</strong> on the Back End. A Req to<strong> /imgs..flag.txt</strong> would resolve to <strong>/path/images/../flag.txt</strong>.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Note</span>:<strong> /wordpress/images/../etc/passwd</strong> FAILED with 404, but<strong> /wordpress/images../etc/passwd</strong> WORKS. (Alias to<strong> /media/</strong>)</p><p></p><p><span class="subheading">Overshooting Traversal Sequences?</span>: For most File Inclusion &amp; Directory Traversal vulns, you can overshoot the traversal sequences &amp; it doesn&#39;t matter (since you can&#39;t go back further than<strong> /</strong>), so it&#39;s generally a good idea to add more than needed (e.g. <strong>../ </strong>).</p><p></p><p>However, it <span style="color:#ff0000;">doesn&#39;t seem to work for this vulnerability</span>. Both<strong> /wordpress/images.../etc/passwd</strong> (3x dots usually translates to 2x traversal sequences) &amp;<strong> /wordpress/images../../etc/passwd</strong> FAILED.</p><p></p><p><h2>Missing Root Location</h2></p><p>In the following example configuration,<strong> /etc/nginx</strong> is designated as the root directory. This setup allows access to files within the specified root directory, such as <strong>/hello.txt</strong>.</p><p></p><p>However, it&#39;s crucial to note that only a specific location (<strong>/hello.txt</strong>) is defined. There&#39;s no configuration for the root location (<strong>location / {...})</strong>.</p><p></p><p>This omission means that the root directive applies globally, enabling requests to the root path <strong>/ </strong>to access files under <strong>/etc/nginx</strong>.</p><p></p><p><h3>Example Config File</h3></p><p><strong>server {</strong><strong></strong></p><p><strong>        root /etc/nginx;</strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong>        location /hello.txt {</strong><strong></strong></p><p><strong>                try_files $uri $uri/ =404;</strong><strong></strong></p><p><strong>                proxy_pass http://127.0.0.1:8080/;</strong><strong></strong></p><p><strong>        }</strong><strong></strong></p><p><strong>}</strong></p><p></p><p><h3>Impact</h3></p><p>A simple GET request, like GET<strong> /nginx.conf</strong>, could expose sensitive information by serving the Nginx configuration file located at <strong>/etc/nginx/nginx.conf</strong>.</p><p></p><p>Setting the root to a less sensitive directory, like<strong> /etc</strong>, could mitigate this risk, yet it still may allow unintended access to other critical files, including other configuration files, access logs, and even encrypted credentials used for HTTP basic authentication.</p><p></p><p><a name="Interesting Files"></a><h1>Interesting Files</h1></p><p><h2>nginx.conf</h2></p><p>Default location is <strong>/etc/nginx/nginx.conf</strong>. Contains config info, including the file paths for Access &amp; Error Logs.</p><p></p><p><h2>Subdomain Enumeration</h2></p><p>Subdomains are often listed inside <strong>/etc/nginx/sites-available/default</strong></p><p></p><p><h2>Logs</h2></p><p>You may find info like subdomains inside Error &amp; Access logs. The default locations are<strong>  /var/log/nginx/error.log </strong>&amp;<strong> /var/log/nginx/access.log</strong></p></div>
</body>
</html>
