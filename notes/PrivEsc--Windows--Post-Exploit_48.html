<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Post-Exploit</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Post-Exploit</h1><br/><p>Repeat many of the same steps from <a href="PrivEsc--Linux_29.html">PrivEsc</a> procedure</p><p></p><p><h1>Recon as SYSTEM</h1></p><p><ol><li>1. <h2>1. </h2><h2>Winpeas</h2></li></ol></p><p>Skip <a href="PrivEsc_8.html">PrivEsc</a> checks for more speed. (May not see any output until it&#39;s finished. Shouldn&#39;t take longer than 5-10 minutes)</p><p></p><p><em>.\winpeas.exe systeminfo userinfo</em></p><p><ol><li>2. <h2>2. </h2><h2>SharpHound</h2></li></ol></p><p>Running from elevated context (using PS “Run as Admin” if possible) reveals more Dom info</p><p><ol><li>3. <h2>3. </h2><h2>Sensitive Files</h2></li></ol><h2></h2></p><p><h2></h2><ol><li>4. <h2>4. </h2><h2>Dump Hashes</h2></li></ol></p><p><ol><li>5. <h2>5. </h2><h2>Pivot</h2></li></ol></p><p>	If there is another interface to access another Net (e.g internal LAN)</p><p>	</p><p><h1>Keep a Shell from Dying</h1></p><p>After you&#39;ve compromised a high privilege account (i.e. SYSTEM), you can modify the <strong>WaitToKillServiceTimeout</strong> setting, in the Windows registry at <strong>HKLM\SYSTEM\CurrentControlSet\Control</strong><strong></strong></p><p><strong></strong></p><p>This dictates the maximum time Windows will wait before forcibly terminating a service. You can increase it up to the max value of 4294967295 (~50 days).</p><p></p><p>May / may not only work for reverse shells created by hijacking a service.</p><p></p><p><em>reg add &quot;HKLM\SYSTEM\CurrentControlSet\Control&quot; /v WaitToKillServiceTimeout /t REG_SZ /d 1200000 /f</em></p><p></p><p><h1>Elevate Local Admin to SYSTEM</h1></p><p>Certain factors (i.e. AV) may prevent some methods from working. You can often get SYSTEM by leveraging a PtH attack using the Local Admin&#39;s creds, or you can take advantage of the Admin&#39;s privileges for certain exploits.</p><p></p><p><h2>impacket-psexec</h2></p><p>This works by launching a payload using the <strong>ADMIN$</strong> SMB share, but it seems to be the most common vector that AV will block.</p><p></p><p><h2>evil-winrm</h2></p><p><em>evil-winrm -H NTLM...</em></p><p></p><p><h2>Mimikatz</h2></p><p></p><p><h2>GodPotato</h2></p></div>
</body>
</html>
