<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Recon + Services</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Recon + Services</h1><br/><p><h1>Methodology: Attack Paths</h1></p><p>Don&#39;t stop Enum after finding a vuln or atk vector during methodical Recon. Should usually stick to OG schedule/plan to keep an organized approach. It&#39;s easy to be pulled off in many directions &amp; miss important info/skip steps.</p><p></p><p>Even if info isn&#39;t immediately useful, it could be relevant later on. Take note of each finding, but finish enum before investing time into researching potential exploit (unless you&#39;re just waiting for the next scan to finish).</p><p></p><p><h1>General</h1><ul><li>Always use &gt;1 wordlist for enum.</li></ul></p><p><ul><li>Some hosts have FW that blocks pings. If an IP address doesn&#39;t respond to ICMP echo requests, this does not necessarily mean that the target machine is down or doesn&#39;t exist.</li></ul></p><p><ul><li><a href="Recon_+_Services--WebApp_12.html#Nikto">Nikto</a> can <span style="color:#ff0000;">discover subdirectories</span> missed by normal fuzzing. It&#39;s not a great vuln scanner though, since it has a lot of false positives &amp; false negatives.</li></ul></p><p><ul><li>Allowed to do <span style="color:#ff0000;">nmap vuln scan</span> on exam! Use it after normal port scan!</li></ul></p><p><ul><li>Pay attention to ports that seem out of place for your target&#39;s OS (e.g. On Win 5986 is WinRM, but on Linux it hint at OMIGod Exploit). </li></ul></p><p><ul><li>Sometimes a port won&#39;t show up as having an External Listener, even though it does! Don&#39;t blindly trust scan results (especially if you haven&#39;t repeated the scan).</li></ul></p><p></p><p>There could be multiple reasons as to why this happens (e.g. a mistake made by Nmap, which doesn&#39;t happen on subsequent scans), but it could be due to the target&#39;s FW config.</p><p></p><p>Even if the port has a Listener running on an External Interface, the target may be config to drop traffic coming to that port from external hosts (i.e. making the port appear to be <strong>filtered</strong> so it isn&#39;t shown by Nmap).</p><p></p><p><h1>Port Scans</h1></p><p>Offsec Mentor reccomended using <strong>-sT </strong>for connect scan- “It&#39;s slower, especially in tunnel, but more accurate.&quot; I don&#39;t think it&#39;s always more accurate though (see <a href="Recon_+_Services_4.html#TCP Connect vs SYN Stealth">comparison</a>).</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Warning</span>: Nmap doesn&#39;t always correctly ID the SVC using a port, especially if it&#39;s guessing with the <strong>?</strong>. <span style="color:#ff0000;">Look up other things  </span><a href="https://github.com/dashagriiva/OSCP-Prep-1/blob/master/ServicesPortsList.txt">commonly used</a><span style="color:#ff0000;"> for that port</span> (<span style="color:#ff0000;">even malware</span> that uses it, bc it could hint towards vulnerability).</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Warning</span>: <span style="color:#ff0000;">Nmap&#39;s </span><em><span style="color:#ff0000;">-oN</span></em> acts like &gt; instead of &gt;&gt;. It <span style="color:#ff0000;">willl</span> <span style="color:#ff0000;">overwrite</span> whatever the dest path is!</p><p></p><p><h2>Scanning through Proxy / Tunnel</h2></p><p>Depending on the Pivoting Method used (i.e. the method used &amp; its layer in the OSI Model), may need to use a certain type of scan with a supported protocol. See <a href="Pivoting_22.html#scan tunneling">Ligolo-ng</a> </p><p></p><p><span style="color:#060f94;text-decoration:underline;">Warning</span>: <span style="color:#ff0000;">Nmap sometimes misses things, especially when run through a tunnel</span>. Sometimes you&#39;ve more luck when running scan ONLY against 1 specific port.</p><p></p><p><span style="color:#ff0000;">★</span><h2>Troubleshooting- Slow Scans</h2></p><p><h3>Dropped Probes</h3></p><p>If your network &amp; the target network / target machine can handle it, increasing the speed of the scan may help. However, there is a<span style="color:#ff0000;"> higher risk of inaccurate results</span>!</p><p><strong>-T4</strong> caps the delay between probes at <strong>10ms</strong>. Can also set a custom value like-</p><p></p><p><strong>--min-rate</strong> &lt;number&gt;: Send packets no slower than &lt;number&gt; per second</p><p></p><p>“You can experiment other values such as --min-rate. It will really help with the scan.” -Offsec Support</p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Determine whether more speed can be handled</span>: “You can try to compare your scans with or without aggressive NMAP options.”</p><p></p><p><h2>TCP</h2><h2></h2></p><p><h2></h2>Windows hosts can take a very long time with <em>-A</em>, so can use <em>-sV</em> instead &amp; perform the script scans <em>-sC</em> after the fact as needed.</p><p> <h2></h2></p><p><h2></h2><a name="TCP Connect vs SYN Stealth"></a><h3>TCP Connect vs SYN Stealth</h3></p><p>&quot;Choosing between a default TCP Connect scan and a SYN Stealth scan often depends on your specific goals and the environment in which you&#39;re operating. A TCP Connect scan is more straightforward because it completes the three-way handshake, making it more detectable but also more reliable in certain contexts. On the other hand, a SYN Stealth scan is less intrusive and less likely to be logged by the target system since it doesn&#39;t complete the handshake, making it a preferred choice for stealthy operations.</p><p></p><p>If you&#39;re in a position where being detected is not a major concern, or if you&#39;re scanning in a more controlled environment (like a network you own or have permission to test), <span style="color:#ff0000;">the reliability of a TCP Connect scan could be advantageous</span>. However, <span style="color:#ff0000;">if you&#39;re trying to be discreet and minimize your footprint</span> on the target system, the <span style="color:#ff0000;">SYN Stealth scan</span> might be the better choice.&quot; -Offsec Student Mentor<h2></h2></p><p><h2></h2><h2></h2></p><p><h2></h2><span style="color:#8ff0a4;text-decoration:underline;">Accuracy</span>: It <span style="color:#ff0000;">depends</span> on the machine&#39;s config, so <span style="color:#ff0000;">try both</span>.</p><p></p><p>Generally, a SYN-Stealth Scan is more reliable because it avoids interacting with services and reduces chances of being rate-limited, throttled, or blocked. Some Firewalls ignore SYN packets, &amp; they&#39;re less likely to be logged / trigger alarms.</p><p></p><p>However, some defensive measures (i.e. Firewalls, IDS, DPI, Application Level Filtering) may silently drop SYN packets. In these cases, a TCP-Connect Scan may be more reliable.</p><p></p><p><h3>Methodology</h3></p><p>Start with basic scan without args to quickly get baseline, then do full port scan without other options, &amp; finally check interesting ports with -sV &amp; -sC (skipping script scan if it takes too long).</p><p>Maybe <span style="color:#ff0000;">run w/o sudo for def TCP Connect scan</span> instead of SYN Stealth?</p><p></p><p>Can try increasing speed with <em><span style="color:#ff0000;">-T4</span></em> (Timing Template). Even if the host seems to have bad connectivity, it seems to sometimes help?</p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Port Detection</span>: The below scans may be more accurate, but may be able to risk it &amp; run- <em>nmap -v -p- -T4 IP -oN tcp_nmap.</em>full</p><p><em>nmap -v IP -oN tcp_nmap.top</em></p><p><em>nmap -v -p- IP -oN tcp_nmap.</em>full</p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Service Enumeration</span>: Optionally, run -sC seperately, or omit the Script Scan all together.</p><p><em>sudo nmap -v -p- -sV -sC IP -oN tcp_nmap.</em>svc</p><p></p><p></p><p><h3>Maximum Detail</h3></p><p><em>sudo nmap -A -p- -vv -oN ./recon/tcp_nmap IP</em></p><p></p><p><span style="color:#237522;">Middle Ground</span><h2></h2></p><p><h2></h2><em>sudo nmap -sV -p- -vv -T4 -oN ./recon/tcp_nmap IP		</em>Then run <em>sudo nmap -sC  </em>against detected ports. Optionally incl -O for OS Detection to fact check other tools like CME or enum4linux-ng<em></em></p><p><em></em><h2></h2></p><p><h2>UDP</h2></p><p>Wait for TCP scan to finish before running a UDP Scan (seems to help laggy targets). By def, nmap “scans top 1000 ports for each protocol.” This should check SNMP (161) as well, but double check it. </p><p></p><p><em>sudo nmap -sUV --open -vv -T4 -oN ./recon/udp_nmap IP</em></p><p></p><p><h3>★</h3><h3>False Negatives</h3></p><p>UDP Scans seem to be less reliable in general, but using it with Service Detection (-sV) can help. I&#39;ve had more success by scanning 1 specific port (i.e. SNMP).</p><p></p><p>Nmap may not list the ports &amp; instead output <strong>Not shown: 1000 open|filtered udp ports (no-response)</strong>. This <span style="color:#ff0000;">doesn&#39;t mean that there aren&#39;t any open UDP ports</span>!</p><p></p><p><a name="TLS/SSL Certificates"></a><h2>TLS/SSL Certificates</h2></p><p>[CTF B 188]</p><p></p><p>Nmap sometimes lists valuable information about TLS Certs under fields like <strong>ssl-cert</strong>, <strong>Subject Alternative Name</strong>, &amp; <strong>Issuer</strong>. Examples of information include the following.</p><p></p><p><h3>Domains &amp; Subdomains</h3></p><p>You can find a website&#39;s Domain Name, or a subdomain, listed after <strong>commonName=</strong>, <strong>DNS:</strong>, &amp; <strong>Subject Alternative Name:</strong></p><p></p><p>You may also be able to find a website&#39;s Domain Name, or a subdomain by looking at the email domain (see below).</p><p></p><p><h3>Email</h3></p><p>You may find 1 or more email addresses listed for fileds like <strong>ssl-cert:</strong>...<strong>emailAddress=</strong> &amp; <strong>Issuer:</strong></p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Uses</span>: Knowing a target&#39;s email address can provide multiple clues &amp;/or open up several attack vectors.</p><p><ul><li><strong>Username</strong>: The <span style="color:#ff0000;">email address itself </span>may be a username on another SVC (e.g. Wordpress). Even if the full email isn&#39;t a username, <span style="color:#ff0000;">the name portion</span> may be a username that&#39;s used elsewhere (e.g. <strong>jsmith</strong>@xample.com).</li></ul></p><p><ul><li><strong>Domain Name</strong>: The email domain (e.g. jsmith<strong>@xamaple.com</strong>) could be used as a Domain Name for a website.</li></ul></p><p><ul><li><strong>Email Domain</strong>: The email domain will likely be used for various accounts, so you may be able to discover additional email addresses by <span style="color:#ff0000;">prepending known usernames</span> to the email domain <span style="color:#ff0000;">or by Brute Forcing</span> common names.</li></ul></p><p></p><p><span style="color:#060f94;text-decoration:underline;">Note</span>: <span style="color:#ff0000;">Companies sometimes use more than 1 email domain</span>! It&#39;s less common, but for example, each department could use a different email domain.</p><p><ul><li><strong>Database Breaches</strong>: See if there are any leaked passwords associated with the email (or a username derived from that email address).</li></ul></p><p><ul><li><strong>Access Email Server</strong>: You may be able to use the email address to sign into a Mail Service &amp; find sensitive info.</li></ul></p><p><ul><li><strong>Client Side Attacks</strong>: If you know an email address, you can use it for attacks like <span style="color:#ff0000;">Phishing</span>.</li></ul></p><p></p><p><h2>Vulnerability Scanning</h2></p><p>[OSCP 46-49]</p><p>Can throw a lot of useless results which you&#39;ll be obligated to comb through. Manual enum often better, but this can help if you&#39;re stuck.</p><p></p><p><em>sudo nmap -sV --script &quot;vuln&quot; -pPORTS -vv IP </em></p><p></p><p><h2>Tips</h2></p><p><ol><li>1) <h3>1) </h3><h3>Access Microsoft HTTPAPI</h3></li></ol></p><p><span style="color:#ff0000;">Sometimes &quot;Microsoft HTTPAPI&quot; is accessible</span>! </p><p>The former isn&#39;t accessible (WinRM), but the latter is accessible only when using the proper Domain Name in /etc/hosts</p><p></p><p>5985/tcp  open  http          syn-ack ttl 125 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</p><p>|_http-server-header: Microsoft-HTTPAPI/2.0</p><p>|_http-title: <strong>Not Found</strong></p><p></p><p>14080/tcp open  http          syn-ack ttl 125 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</p><p>|_http-server-header: Microsoft-HTTPAPI/2.0</p><p>|_http-title:<strong> Bad Request</strong></p><p></p><p>After assigning IP the domain name web02.relia.com &amp; running<em> nmap web02.relia.com...</em> You now see</p><p></p><p>14080/tcp open  http          syn-ack ttl 125 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</p><p>|_http-title: Site doesn&#39;t have a title (text/html; charset=utf-8).</p><p>|_http-trane-info: Problem with XML parsing of /evox/about</p><p>| http-methods: </p><p>|_  Supported Methods: GET HEAD POST</p><p>|_http-server-header: Microsoft-HTTPAPI/2.0</p><p><ol><li>2) <h3>2) </h3><h3>Scans Taking Forever</h3></li></ol></p><p>If a scan is taking far longer than it should, the safest bet is to revert the target &amp; try again after the network is less congested (incl scans performed on other hosts, even if they aren&#39;t connected for exam)</p><p></p><p><a name="Nmap Exotic Scans"></a><h1>Nmap Exotic Scans</h1></p><p>[Wreath 171-178]</p><p></p><p><h2>NULL, FIN, &amp; Xmas TCP Scans</h2></p><p>These are even stealthier than SYN Scans, but can be less reliable (similar to UDP Scans). In addition to being stealthy, the main advantage is firewall evasion. You can combine these with <a href="Recon_+_Services_4.html#Firewall Evasion">other techniques</a> for better evasion.</p><p></p><p><h3>Background</h3></p><p>If the port is open, then there is no response to the malformed packet. Unfortunately (as with open UDP ports), that is also an expected behaviour if the port is protected by a firewall.</p><p></p><p>If a port is identified as filtered with one of these scans then it is usually because the target has responded with an ICMP unreachable packet.</p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">False Negatives</span>: Although RFC 793 mandates that network hosts respond to malformed packets with a <strong>RST TCP</strong> packet for closed ports, and don&#39;t respond at all for open ports; this is not always the case in practice.</p><p></p><p>In particular Microsoft <span style="color:#ff0000;">Windows</span> (&amp; <span style="color:#ff0000;">many Cisco network devices</span>) are known to respond with a RST to any malformed TCP packet -- regardless of whether the port is actually open or not. This <span style="color:#ff0000;">results in all ports showing up as being closed</span>.</p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Firewall Evasion</span>: Many firewalls are configured to drop incoming TCP packets to blocked ports which have the SYN flag set (thus blocking new connection initiation requests).</p><p></p><p>By sending requests which do not contain the SYN flag, we effectively bypass this kind of firewall. However, most modern IDS solutions are savvy to these scan types, so don&#39;t rely on them to be 100% effective when dealing with modern systems.</p><p></p><p><h3>NULL Scan (-sN)</h3></p><p>A TCP Request sent without any flags. A closed port should Respond with <strong>RST</strong>.</p><p></p><p><h3>FIN Scan (-sF)</h3></p><p>A TCP Request that only has the <strong>FIN</strong> flag, which is typically used to gracefully close an active connection.</p><p></p><p><h3>Xmas Scan (-sX)</h3></p><p>A malformed TCP packet with <strong>PSH</strong>, <strong>URG</strong>, &amp; <strong>FIN</strong> flags set. These look like a blinking Christmas tree in Wireshark, hence the name.</p><p></p><p><h2>Zombie / Idle Scan (-sI)</h2></p><p></p><p><h3>OPSEC (-Pn)</h3></p><p>Skipping host discovery prevents Nmap from sending an initial ping packet to the target. Without this option, Nmap will reveal your real IP address to the target.</p><p></p><p><a name="Firewall Evasion"></a><h1>Firewall Evasion</h1></p><p>[Wreath 178]</p><p></p><p>You can combine these techniques with the <a href="Recon_+_Services_4.html#Nmap Exotic Scans">Nmap Exotic Scans</a> for better evasion.</p><p></p><p><h1>Autorecon</h1></p><p>Don&#39;t trust these results.</p><p></p><p><h2>Output File for Each Host</h2></p><p><em>for i in $(find results/ -name &quot;*nikto*&quot; 2&gt;/dev/null); do echo &quot;Outputting $i&quot;; cat $i; echo &quot;=========================================&quot;; done</em></p><p></p><p><h1>NetExec (NXC) vs CrackMapExec</h1></p><p>Many (if not all) of the same CME cmds can be used with <a href="Misc_Attacks--Password_Attack_5.html#nxc">NXC</a>.</p><p></p><p><h1>Tips</h1><ul><li>For nmap NSE, get help &amp; unique args like-<em> nmap </em><em><strong>--script-help</strong></em><em> smtp-enum-users</em>. For more info look up the script on Nmap&#39;s site. There <span style="color:#ff0000;">may be additional args not listed</span>. For ex-</li></ul></p><p> Auth for many scripts can be passed through a file like <em>--script-args &quot;</em><em><strong>userdb</strong></em><em>=/dev/shm/squid_user,</em><em><strong>passdb</strong></em><em>=/usr/share/wordlists/rockyou.txt&quot;</em></p></div>
</body>
</html>
