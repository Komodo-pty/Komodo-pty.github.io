<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Python</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Python</h1><br/><p><h1>Python2 to Python3</h1></p><p>The exact error message that it gives when run with <strong>python3</strong> will vary. Sometimes it&#39;s an obvious syntax error (e.g about a <strong>print</strong> statement), but can be anything. For ex-</p><p></p><p>Traceback (most recent call last):</p><p>  File &quot;/dev/shm/45161.py&quot;, line 136, in &lt;module&gt;</p><p>    _cmd = &quot;|| echo &quot; + base64.b64encode(args.cmd) + &quot;|base64 -d|bash&quot;</p><p>                        ^^^^^^^^^^^^^^^^^^^^^^^^^^</p><p>  File &quot;/usr/lib/python3.11/base64.py&quot;, line 58, in b64encode</p><p>    encoded = binascii.b2a_base64(s, newline=False)</p><p>              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</p><p><strong>TypeError: a bytes-like object is required, not &#39;str&#39;</strong></p><p></p><p><h2>Running with python2</h2></p><p>If a script is fails to run with <strong>python3</strong>, try running as is with <strong>python2</strong>.</p><p></p><p>Easiest fix, but may not always work (i.e. if its on a system that isn&#39;t connected to the internet &amp; doesn&#39;t have the necessary python2 dependencies installed).</p><p></p><p><h1>Dependencies</h1></p><p><span style="color:#060f94;text-decoration:underline;">Q</span>: Can you install a python library on your system &amp; transfer the file to the target? For example, if script has <strong>import base64</strong></p><p></p><p><em>find / -name “base64.py” 2&gt;/dev/null</em></p><p></p><p><a name="python venv"></a><h2>Python Virtual Environment</h2></p><p>Safely handles what would otherwise be dependency conflicts.</p><p></p><p>★<span style="color:#f66151;text-decoration:underline;">WARNING</span>★: Never use <strong>sudo</strong> or <strong>su</strong> in an env. <span style="color:#ff0000;">Running as root escapes the venv</span>!</p><p></p><p><h3>Create</h3></p><p>Nav to your project&#39;s directory &amp; run the following. The last arg (<strong>env</strong>) will be the name / location of the venv.</p><p></p><p><em>python3 -m venv env</em></p><p></p><p><h3>Activate</h3></p><p>★<span style="color:#f66151;text-decoration:underline;">WARNING</span>★: If you rename your project&#39;s directory, you&#39;ll need to manually adjust the variables used.</p><p></p><p><em>source env/bin/activate</em></p><p></p><p><span class="subheading">Verify</span>: You should see <strong>(env)</strong> at the start of the line in your terminal. You should also see a new PATH when running <em>which python</em>.</p><p></p><p><h3>Install Stuff</h3></p><p>NEVER use <strong>sudo</strong> or <strong>su</strong>. Ensure you&#39;re using the shell that has the <strong>(env) </strong>active.</p><p></p><p>Example installations include-</p><p></p><p><em>python3 ./setup.py  install</em><em></em></p><p><em></em><em></em></p><p><em>python3 -m pip install requests</em><em></em></p><p><em></em><em></em></p><p><em>python3 -m pip install ‘requests==2.18.4’</em><em></em></p><p><em></em><em></em></p><p><em>pip install -r /path/to/requirements.txt</em></p><p></p><p><span class="subheading">Verify</span>: You can run <strong>pip freeze</strong> to see packages installed in the Venv.</p><p></p><p><h3>Deactivate</h3></p><p>Use <em>deactivate</em> to exit. This doesn&#39;t delete <strong>./env</strong>, so it can be activated again without needing to be recreated.</p><p></p><p><h3>Delete Venv</h3></p><p>After exiting the venv, you can permanently delete it by removing that directory.</p><p></p><p><em>rm -Rd ./env</em></p><p></p><p><h3>★</h3><h3>Troubleshooting- pip Not Found</h3></p><p><strong>ModuleNotFoundError: No module named &#39;pip&#39;</strong></p><p></p><p>If pip is installed on the system but missing inside the virtual environment, it probably wasn’t bundled when the venv was created. This can happen if the venv module wasn&#39;t installed with its dependencies, or if ensurepip wasn&#39;t run properly.</p><p></p><p><span class="subheading">Verify it&#39;s installed</span>: First verify that pip is installed on the main system (outside of the Venv). Try both of the following commands. They should give the same output.</p><p></p><p><em>pip3 --version                  </em><em></em></p><p><em></em><em></em></p><p><em>python3 -m pip --version</em></p><p>   </p><p><strong>pip 25.0.1 from /usr/lib/python3/dist-packages/pip (python 3.13)</strong></p><p></p><p><span class="subheading">Install pip in Venv</span>: If pip is intalled on the machine, but not found in the Venv, try bootstrapping pip manually inside the venv. Verify it was installed, &amp; then upgrade pip just to be safe.</p><p></p><p><em>python3 -m ensurepip --upgrade</em><em></em></p><p><em></em><em></em></p><p><em>python3 -m pip --version</em><em></em></p><p><em></em><em></em></p><p><em>python3 -m pip install --upgrade pip</em></p><p></p><p></p><p><h2>Import Custom Module</h2></p><p>[OSCP 229]</p><p></p><p>Some scripts import custom modules (for Python, or equiv for other languages). These can&#39;t be installed normally (e.g via pip).</p><p></p><p>These modules <span style="color:#ff0000;">should be in the same Repo as the exploit</span>, &amp; could be <span style="color:#ff0000;">another </span><strong><span style="color:#ff0000;">.py</span></strong><span style="color:#ff0000;"> file</span>. The accompanying file(s) can be placed in the same dir as the exploit for Python. For example,</p><p></p><p>The first line of <a href="https://github.com/rekter0/exploits/blob/master/VestaCP/vestaROOT.py">vestaROOT.py</a> is</p><p></p><p><strong>from VestaFuncs import *</strong></p><p></p><p>Must have <strong>VestaFuncs.py</strong> in the same directory as the exploit is located in (for search path). This file is located in the same Github Repo.</p><p></p><p><h2>Python Version Directories</h2></p><p>Depending on the installation method, installation may create a specific directory for the dependencies (e.g. <strong>~/.local/lib/python3.11/site-packages/</strong>).</p><p></p><p>If you updated to a new version of Python, you will get <strong>ModuleNotFoundError</strong>. A lazy fix for this is to copy these files to the current Python directory (may cause Python version mismatch issues if older version is required, but it worked for me).</p><p></p><p><em>cp /home/asura/.local/lib/python3.11/site-packages/git_dumper.py /home/asura/.local/lib/python3.13/site-packages/git_dumper.py</em><em></em></p><p><em>cp /home/asura/.local/lib/python3.11/site-packages/dulwich /home/asura/.local/lib/python3.13/site-packages/dulwich</em></p><p></p><p><a name="python troubleshooting"></a><h1>Troubleshooting</h1></p><p>It can help to add additional print statements, to verify that certain parameters have the correct values. These can also act like “checkpoints” which confirm that the script execution is working at certain points of the program.</p><p></p><p><h2>Vulnerable Version Checker</h2><h3></h3></p><p><h3></h3>Sometimes <span style="color:#ff0000;">falsely flags target as not vuln version, as patched</span>, or as <span style="color:#ff0000;">not running the vuln SW</span>. Can edit exploit to remove this behavior (e.g for python script comment out <strong>sys.exit(0)</strong> &amp; replace with <strong>return</strong> to exit the ver checker loop).</p><p></p><p>Another option is to comment out the <strong>if</strong> conditional &amp; replace it with something that&#39;ll always evaluate true. For ex, in Python-</p><p></p><p><strong>if 1==1:</strong></p><p><h3></h3></p><p><h3></h3><h2>Beautiful Soup</h2></p><p>If it uses a web scraper like soup, &amp; you get errors like <strong>TypeError: &#39;NoneType&#39; object</strong>, about a variable missing or being incorrect, etc-</p><p></p><p><span style="color:#ff0000;">Verify that all the connection info is correct! </span>(i.e Target URL, creds, etc)</p><p></p><p>If you supplied incorrect info &amp; soup can&#39;t connect, then it can&#39;t scrape the neccessary values for variables.</p><p></p><p><h2>Python requests- Invalid Certificate</h2></p><p>Disable Certificate verification for Python&#39;s <strong>requests</strong> library by adding <em>verify=False</em></p><p></p><p><em>requests.get(&#39;https://site.com&#39;, verify=False)</em></p><p></p><p><h2>Using Blank String for Arguments</h2></p><p>A PoC may wnat you to supply a value for an arg, even if you don&#39;t have any value for it. For ex, if it wants a path to a site&#39;s subdir but you want to target webroot.</p><p></p><p>Running PoC without supplying this arg may give an error like- <strong>TypeError: can only concatenate str (not &quot;NoneType&quot;) to str</strong></p><p></p><p>If it wants a string, give it a string. Try supplying an empty string for the arg&#39;s value (e.g<strong> -U “”</strong> )</p><p></p><p><h2>To Shebang or Not to Shebang</h2></p><p>Some exploits <span style="color:#ff0000;">must be invoked like &quot;python3 ...&quot; </span>instead of using the shebang, like <strong>./SCRIPT.py</strong>.</p><p></p><p>Other exploits <span style="color:#ff0000;">must be invoked using the shebang</span> (after <em>chmod +x ./SCRIPT.py</em>) like <strong>./SCRIPT.py</strong>.</p><p></p><p>In some cases, I believe this could have to do with the number of expected args.</p><p></p><p><span style="color:#f6d32d;">★</span><h2>Tabs &amp; Spaces Mismatch</h2></p><p><strong>TabError: inconsistent use of tabs and spaces in indentation</strong></p><p></p><p>Unlike many other languages, Python cares wheter you&#39;re using 4x spaces or an indent, &amp; whichever you chose, it must remain consistent throughout the script.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: The “Character Escape” for a tab is<strong> \t</strong></p><p></p><p><h3>sed</h3></p><p><em>sed -i $&#39;s/    /\t/g&#39; script.py</em></p><p></p><p><h3>Cyberchef</h3></p><p>Copy / Paste the script into <a href="https://gchq.github.io/CyberChef/#recipe=Find_/_Replace(%7B'option':'Extended%20(%5C%5Cn,%20%5C%5Ct,%20%5C%5Cx...)','string':'%5C%5Ct'%7D,'%20%20%20%20',true,false,true,false)">Cyberchef</a>, using <strong>find / replace</strong> with</p><p><strong>Find: Extended</strong> ↓ <strong>\t</strong></p><p></p><p><h1>Web Requests</h1></p><p><a name="Adding Cookies"></a><h2>Adding Cookies</h2></p><p>When using the <strong>requests</strong> library you can specify cookies in JSON format. In the following example, the script contains the variable headers (HTTP Headers) &amp; data (Body Data).</p><p></p><p><em>requests.get(&#39;https://site.com&#39;, headers=headers, data=data, verify=False, </em><em><strong>cookies={&quot;isHuman&quot;:&quot;1&quot;}</strong></em><em>)</em></p><p></p><p><h1>Writing to Files</h1></p><p><h2>Closing Files</h2></p><p>Files are first “opened” so you can interact with them, &amp; then the file MUST be subsequently “closed” when you&#39;re done. In the following examples, you&#39;re writing the data that&#39;s saved to the “payload” variable to the specified location.</p><p></p><p><h3>Safer Implementation</h3></p><p>The <strong>with</strong> statement in Python is used to create a <span style="color:#ff0000;">context manager</span>. This automatically handles opening and closing resources, such as files, and ensures that cleanup happens reliably.</p><p></p><p>When you use with <strong>open(...)</strong>, the file is opened and assigned to <strong>f</strong>. Once the block of code inside the with completes, the context manager will automatically close the file, <span style="color:#ff0000;">even if an error occurs</span> inside the block. It performs the following steps:</p><p><ol><li>Open the file: open(&#39;/dev/shm/payload.bin&#39;, &#39;wb&#39;)</li></ol></p><p><ol><li>Write to the file: f.write(payload)</li></ol></p><p><ol><li>Automatically close the file after the block is finished, even if an exception occurs during the write process.</li></ol></p><p></p><p><strong>with open(&#39;/dev/shm/payload.bin&#39;, &#39;wb&#39;) as f:</strong><strong></strong></p><p><strong>    f.write(payload)</strong></p><p></p><p><span class="subheading">Improved Error Handling</span>: This guarantees the file is always closed, and resources are freed even if the write operation fails.</p><p></p><p><strong>try:</strong><strong></strong></p><p><strong>    with open(&#39;/dev/shm/payload.bin&#39;, &#39;wb&#39;) as f:</strong><strong></strong></p><p><strong>        f.write(payload)</strong><strong></strong></p><p><strong>        # If any error happens here, &#39;f&#39; is still properly closed</strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong>except Exception as e:</strong><strong></strong></p><p><strong>    print(f&quot;Error occurred: {e}&quot;)</strong></p><p></p><p><h3>Alternate Usage</h3></p><p>This is a common method for writing to files, but it&#39;s less safe than the aforementioned <strong>with</strong> method. <span style="color:#ff0000;">If an error happens</span> before <strong>f.close()</strong> is called, the <span style="color:#ff0000;">file won&#39;t be closed properly</span>.</p><p></p><p><strong>f = open(&#39;/dev/shm/payload.bin&#39;, &#39;wb&#39;)</strong><strong></strong></p><p><strong>f.write(payload)</strong><strong></strong></p><p><strong>f.close()</strong></p><p></p><p><h3>Importance</h3></p><p>If the file isn&#39;t closed properly, it can lead to:</p><p><ul><li>Memory leaks or file handles that are left open.</li></ul></p><p><ul><li>Corrupted data (because the file might not be flushed correctly).</li></ul></p><p></p><p><h2>Overwriting Files (&#39;wb&#39;)</h2></p><p>The<strong> &#39;wb&#39; </strong>mode works like the <strong>&gt;</strong> output redirector, overwriting the destination file if it already exists. <strong>w</strong> stands for write &amp; <strong>b</strong> stands for binary mode.</p><p></p></div>
</body>
</html>
