<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Memcached</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Memcached</h1><br/><p><h1>Background</h1></p><p>[OSCP 104-106, CTF B 162-163]</p><p></p><p>Port <strong>11211</strong> by default.</p><p></p><p>Slabs are pieces of memory which contain key-value pairs (known as items?)</p><p></p><p><h2>Connecting</h2></p><p><em>telnet localhost 11211</em></p><p></p><p><em> nc TARGET 11211</em></p><p> </p><p><h2> cachedump</h2></p><p> Undocumented feature. It should still work, but it may be removed in later versions.</p><p> </p><p> The “correct” command for the newer versions of Memcached is <a href="Recon_+_Services--Memcached_72.html#lru_crawler">lru_crawler</a>. See <a href="https://stackoverflow.com/questions/51180802/is-memcached-s-cachedump-expected-to-be-consistent">StackOverflow</a></p><p> </p><p><h3> Syntax</h3></p><p> Specify the slab number used to retrieve the keys &amp; the result limit.</p><p> </p><p> Using <strong>0</strong> for the <strong>limit</strong> means return as much data as possible (Memcached still maxes out the function&#39;s return at 1-2MB)</p><p> </p><p><em> stats cachedump &lt;slab&gt; &lt;limit&gt;</em></p><p> </p><p><a name="lru_crawler"></a><h2>lru_crawler</h2></p><p>Intended method for dumping data.</p><p></p><p><em>lru_crawler metadump 1</em></p><p></p><p><em>lru_crawler metadump all</em></p><p></p><p><h1>Enumeration</h1></p><p>The <span style="color:#ff0000;">data</span> contained in the server <span style="color:#ff0000;">may change based on actions performed</span> (e.g. <span style="color:#ff0000;">signing into a website</span> could save the cookie to the host&#39;s Memcached server).</p><p></p><p><h2>Basic Info</h2></p><p><em>version</em><em></em></p><p><em></em><em></em></p><p><em>stats</em>		(Details about the Server&#39;s Storage)</p><p></p><p><h2>Dumping Data</h2></p><p>Slab Enumeration &amp; Item Enumeration Methods which should be interchangable, but 1 may work better in certain situations.</p><p></p><p><h3>Slab Enumeration</h3></p><p>In the following example, there&#39;s only 1 active_slab &amp; all slab values start with 1, so there&#39;s only 1 slab &amp; its id / name is 1.</p><p></p><p><em>stats slabs</em></p><p></p><p><strong>STAT </strong><strong><span style="color:#ff0000;">1</span></strong><strong>:chunk_size 80</strong></p><p>...</p><p><strong>STAT active_slabs </strong><strong><span style="color:#ff0000;">1</span></strong></p><p></p><p><h3>Item Enumeration</h3></p><p>I believe that listing items also shows you that item&#39;s slab #, so it should work the same as the Slab Enumeration.</p><p></p><p>All the items in this example are stored under slab 1.</p><p></p><p><em>stats items</em></p><p></p><p><strong>items:</strong><strong><span style="color:#ff0000;">1</span></strong><strong>:number 5</strong></p><p>...</p><p><strong>items:</strong><strong><span style="color:#ff0000;">1</span></strong><strong>:age:4090</strong></p><p></p><p><h3>Dumping Slab</h3></p><p>The following shows use of cachedump, but may need to use <a href="Recon_+_Services--Memcached_72.html#lru_crawler">lru_crawler</a> for newer versions of Memcached.</p><p></p><p>Shows the Item Key, Size of the Key, &amp; the expiration timestamp in seconds</p><p></p><p><em>stats cachedump 1 0	</em>			(OR <em>stats cachedump 1 100</em>)</p><p></p><p><strong>ITEM password [15 b; 1729363961 s]</strong><strong></strong></p><p><strong>ITEM username</strong>....</p><p></p><p><h3>Retrieve Data</h3></p><p><em>get username</em><em></em></p><p><em></em><em></em></p><p><em>get password</em></p><p></p><p>OR</p><p></p><p><em>get item:username</em><em></em></p><p><em></em><em></em></p><p><em>get item:password</em></p><p></p></div>
</body>
</html>
