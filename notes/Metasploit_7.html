<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Metasploit</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Metasploit</h1><br/><p><h1>General</h1><ul><li>May need to run msfconsole with <em>sudo</em> so you can listen on lower ports (doesn&#39;t matter for Kali)</li></ul></p><p><ul><li><span style="color:#ff0000;">Meterpreter upgrade</span> uses current shell to trigger R shell with Meterpreter payload, but the <span style="color:#ff0000;">def port</span> used for this <span style="color:#ff0000;">may be blocked</span>. Manually change with <em>search meterpreter upgrade</em> &amp; <em>set lport 445</em>, for ex.</li></ul></p><p><ul><li><em>setg</em> doesn&#39;t seem to always change values, at least for payloads. Ensure correct values are being used, &amp; maybe just use <em>set</em> instead.</li></ul></p><p><ul><li>Msfconsole has exploits that aren&#39;t listed on Exploit-DB!</li></ul></p><p><ul><li>Sometimes need to <span style="color:#ff0000;">adjust the Target ID</span> like, <strong>set target 1</strong>. After doing so, you usually need to also change the payload like, <strong>set payload PAYLOAD</strong> (Tab Complete lets you list valid options).</li></ul></p><p></p><p></p><p><h1>Setup</h1></p><p>[OSCP 209]</p><p></p><p><h1>Proxies / Pivoting</h1></p><p><h2>Built-in Metasploit Functionality</h2></p><p>[Infrastructure 20-23]</p><p></p><p><h2>Exploit&#39;s Proxy Option</h2></p><p>Some Modules have an option for proxies (check with <strong>options</strong>). For example, to run exploit through Chisel:</p><p></p><p><em>set proxies socks5:127.0.0.1:1080</em></p><p></p><p><h3>Getting Reverse Shell</h3></p><p>Fact check this, but some payloads may not work through a proxy or may require a certain option. For example, got the following error when running an exploit through Chisel.</p><p></p><p><strong>[-] Exploit failed: RuntimeError TCP connect-back payloads cannot be used with Proxies. Use &#39;set ReverseAllowProxy true&#39; to override this behaviour.</strong><strong></strong></p><p><strong>[*] Exploit completed, but no session was created.</strong></p><p></p><p><em>set ReverseAllowProxy true</em></p><p></p><p><h2>Proxychains</h2></p><p>Less elegant than the previous solutions, but it should still work. Just start MsF with proxychains.</p><p></p><p><em>proxychains msfconsole</em></p><p></p><p><h1>Msfvenom</h1></p><p><a name="AV Bypass"></a><h2>AV Bypass</h2></p><p>You can try using built-in encoders (with <strong>-e</strong>) to obfuscate the payloads, but by itself, 1 encoding method may be too generic to fool AV. You can list all options with <strong>-l</strong> (i.e. <strong>-l encoders</strong>).</p><p></p><p><h3>Layer Encoding</h3></p><p>A more thorough means of obfuscation is to create the payload &amp; use it as a template (using <strong>-x</strong>) for layer encoding.</p></div>
</body>
</html>
