<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>DNS</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>DNS</h1><br/><p><h1>DNS Enumeration</h1></p><p>You need to know the <strong><span style="color:#ff0000;">correct</span></strong><span style="color:#ff0000;"> hostname for the target</span>! (e.g. <strong>fusion.thm</strong> may have no results, but <strong>fusion.corp</strong> could return subdomains)</p><p></p><p><span class="subheading">Requirements: </span>Target needs to have some form of Name Resoultion that can be queried, so you to use a tool like <em>dig</em>. For ex-</p><p><ol><li>Connected to internet for External DNS (Not on OSCP)</li></ol></p><p><ol><li>Machine on its Net has port 53 open for internal DNS (does target also need 53 open if another host handles DNS?). Send query to whichever host has port 53 open. <span style="color:#ff0000;">DCs usually have 53 open</span>!</li></ol></p><p><ol><li>Host uses an alt method for Name Resolution (i.e NetBIOS for Windows, port 139 by def)</li></ol></p><p></p><p><span style="color:#060f94;text-decoration:underline;">Note</span>: If host handles its own DNS, you&#39;ll use its IP. Otherwise specify the IP of the DNS Server.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Note</span>: <strong>hostmaster</strong> is a commonly used subdomain &amp; it often doesn&#39;t have anything new, but sometimes it has interesting info!</p><p></p><p><h2>Find Domain Name</h2></p><p><h3>SMB</h3></p><p>SMB will often reveal the Domain Name that&#39;s used for servers, etc.</p><p></p><p>Use <strong>enum4linux-ng</strong>.</p><p></p><p><h3>Web App</h3></p><p>If you send a Request to the server&#39;s IP, some servers will redirect you to a Domain Name.</p><p></p><p>Domain Name may also be referenced in a Web App&#39;s source code on 1 or more pages, either in <span style="color:#ff0000;">links</span> or <span style="color:#ff0000;">email addresses</span>.</p><p></p><p><h3>Encryption Certificates</h3></p><p>You can often <span style="color:#ff0000;">find the Domain Name </span>&amp;/or<span style="color:#ff0000;"> </span><strong><span style="color:#ff0000;">subdomains</span></strong><span style="color:#ff0000;"> </span>from<span style="color:#ff0000;"> encyption certificates</span> (e.g. RDP, <a href="Recon_+_Services_4.html#TLS/SSL Certificates">TLS/SSL</a>, WinRM, etc).</p><p></p><p>However, it may not be the full domain name &amp; <span style="color:#ff0000;">could be missing the TLD</span> (e.g. DOMAIN vs DOMAIN<strong>.com</strong> or DOMAIN<strong>.org</strong>)!</p><p></p><p><h2>Basic Enumeration</h2></p><p><em>dig any windcorp.thm @10.10.26.228</em><em></em></p><p><em>dig all windcorp.thm @10.10.26.228</em></p><p></p><p><h2>Zone Transfer (axfr)</h2></p><p><em>dig axfr oscp.exam @192.168.231.156</em></p><p></p><p><h2>CHAOS (CH)</h2></p><p>[CTF 80]</p><p></p><p><h1>Fuzzing Subdomains</h1></p><p>Using <strong>ffuf</strong> and the <strong>Host</strong> HTTP Header. See <a href="Recon_+_Services--WebApp_12.html#Domain Name">Web App</a> for more info.</p><p></p><p><h2>Setup</h2></p><p><span style="color:#ff0000;">Must use a Domain Name</span>, &amp; not an IP, so 1st create an entry in <strong>/etc/hosts</strong> if necessary.</p><p></p><p><h3>Wildcard Redirect</h3></p><p>Most Web Apps use a Wildcard Redirect, where invalid subdomains are directed to a domain (usually the main domain).</p><p></p><p>Identify a commonality in these Responses (e.g. word count) so you can filter them out. I typically use Word Count, but other metrics may be better in certain situations. To filter by Word Count with <strong>ffuf</strong> use<strong> -fw</strong></p><p></p><p><span class="subheading">Baseline</span>: <em>ffuf -c -u &quot;http://rocket.thm&quot; -H &quot;Host: FUZZ.rocket.thm&quot; -w /usr/share/wordlists/seclists/Discovery/DNS/shubs-subdomains.txt</em></p><p></p><p><h1>Fuzzing</h1></p><p>Repeat with <span style="color:#ff0000;">MULTIPLE different wordlists</span> for subdomains!</p><p></p><p>For example, if the baseline showed a Wildcard Redirect with 20 words in the Response, your 1st fuzzing command could be-</p><p></p><p><em>ffuf -c -u &quot;http://rocket.thm&quot; -H &quot;Host: FUZZ.rocket.thm&quot; -w /usr/share/wordlists/seclists/Discovery/DNS/shubs-subdomains.txt -fw 20</em></p><p></p><p><h1>Passive Subdomain Enumeration</h1></p><p>VirusTotal</p><p>dnsdumpster (?)</p><p>Google Dorking</p><p>(sublist3r is active isnt it?)</p><p></p><p><h2>Google Dorking</h2></p><p>Limit search results to a specific domain (e.g. flaws.cloud). You can also exclude results from known subdomains using the minus symbol</p><p></p><p><strong>site:flaws.cloud -example.flaws.cloud</strong></p><p></p><p><h1>Resolving Domain Names</h1></p><p>If an IP address isn&#39;t resolving to the corresponding Domain Name, &amp; you&#39;re using a Linux Machine, add it to <strong>/etc/hosts</strong></p><p></p><p><h2>/etc/hosts</h2></p><p>Don&#39;t use port numbers!</p><p></p><p>On a new line use the following syntax-</p><p></p><p><strong>IP_ADDRESS domain.com sub1.domain.com sub2.domain.com</strong></p><p></p><p>Notice that there&#39;s a space between the text fields, it starts with IP, then main domain, &amp; the subdomains come after that.</p></div>
</body>
</html>
