<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>SNMP</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>SNMP</h1><br/><p><h1>Remote Recon</h1></p><p>[OSCP 45-46]</p><p>Information goldmine! If it&#39;s found, query SNMP first to get more info that could help later (or even get outright RCE). </p><p></p><p>Used on both Linux &amp; Windows</p><p></p><p><h2>Info to Find</h2><ol><li>User account names (&amp; potentially emails)</li></ol></p><p><ol><li>Running Processes (e.g can indicate what AV is running, if any, or potentially vuln apps)</li></ol></p><p><ol><li>All Installed SW (cross-reference with running procs &amp; you&#39;ll know the SW ver in use)</li></ol></p><p><ol><li>Listening Ports (TCP &amp; UDP Ports, even if they&#39;re only listening locally)</li></ol></p><p></p><p><h2>Scan</h2></p><p>Should be detected with def UDP nmap scan (top 1000 ports), but can also manually specify port 161</p><p></p><p><span style="color:#f66151;text-decoration:underline;">WARNING</span>: Sometimes Nmap won&#39;t list UDP ports &amp; instead says <strong>Not shown: 1000 open|filtered udp ports (no-response)</strong>. This <span style="color:#ff0000;">doesn&#39;t mean</span> these UDP <span style="color:#ff0000;">ports aren&#39;t in use</span>! May want to <span style="color:#ff0000;">check SNMP anyways</span>!</p><p></p><p><em>sudo nmap -sU --open -vv -oN ./recon/udp_nmap IP</em></p><p></p><p><em>sudo nmap -sU --script &quot;snmp* and not snmp-brute&quot; IP -p161 -v</em></p><p></p><p><h1>Query</h1></p><p><h2>Community Name Enum</h2></p><p>Diff communities can contain diff info &amp; have diff functionality.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip- Locally Accessible</span>: Some communities may only be accessible locally (or via whitelisted IPs). These <span style="color:#ff0000;">won&#39;t show up from remote onesixtyone enum</span>.</p><p></p><p>Specify wordlist with “community” names to try. See the lists inside <a href="file:///usr/share/wordlists/seclists/Discovery/SNMP">/usr/share/wordlists/seclists/Discovery/SNMP</a>. For ex, run against 1 host-</p><p></p><p><em>onesixtyone -c /usr/share/wordlists/seclists/Discovery/SNMP/snmp-onesixtyone.txt -o ./recon/snmp.log IP</em></p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Overkill</span>: <em>for i in $(find -L /usr/share/wordlists/seclists -iname &quot;*snmp*&quot; 2&gt;/dev/null);do onesixtyone -c $i IP;done</em></p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Output</span>: For ex, if the community string found was “public”, it could look like-</p><p></p><p><em>192.168.200.145 [</em><em><strong>public</strong></em><em>] Hardware: AMD64 Family 25 Model 1 Stepping 1 AT/AT COMPATIBLE - Software: Windows Version 6.3 (Build 19041 Multiprocessor Free)</em></p><p></p><p><h2>Query MIB Tree</h2></p><p>Specify community string &amp; ver (try version 1).</p><p></p><p><span style="color:#ff0000;">Use both</span> <strong>snmp-check</strong> &amp; variations of the <strong>snmpwalk</strong> commands. Sometimes 1 detects information missed by the other!</p><p></p><p><h3>snmp-check</h3></p><p>Returns a lot of info, but it&#39;s more manageable than snmpwalk.</p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Quick &amp; Human Readable</span>: <em>snmp-check -c public -v 1 IP | tee ./recon/snmp_public</em></p><p></p><p><h3>snmpwalk</h3></p><p>May need to <span style="color:#ff0000;">append a period</span> to the end of the command for snmpbulkwalk to get more output.</p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: Start with juicy stuff (with <strong>NET-SNMP-EXTEND-MIB::nsExtendObjects</strong>), then look at full output (with <strong>.</strong>) so you don&#39;t miss anything.</p><p></p><p><em>snmpbulkwalk -c public -v2c IP</em><em><strong> </strong></em><em><strong><span style="color:#ff0000;">.</span></strong></em></p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">More Info</span>: <em>snmpwalk -c public -v1 -Oa IP | tee ./recon/snmp_public	</em>		(More options, supports more versions, can be used against specific OIDs, etc.)</p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">More Info but Quicker</span>: snmpbulkwalk -c public -v2c IP 		(Like regular snmpwalk, but faster for many queries. <span style="color:#ff0000;">Only works on version 2c</span>)</p><p></p><p><h3>Get Extended</h3></p><p>Append <strong>NET-SNMP-EXTEND-MIB::nsExtendObjects</strong> like you&#39;d append a normal OID</p><p></p><p><em>snmpbulkwalk -c public -v2c 192.168.213.149 NET-SNMP-EXTEND-MIB::nsExtendObjects</em></p><p></p><p><span style="color:#060f94;text-decoration:underline;">Tip</span>: Depending on config, <span style="color:#ff0000;">this may execute a script/cmd</span>. <span style="color:#ff0000;">If you revert a machine, may need to re-run</span> this to make sure its re-executed (e.g if it resets a passwd)</p><p></p><p><span style="color:#8ff0a4;text-decoration:underline;">Troubleshooting</span>: List of errors like <strong>Cannot find module</strong>, <strong>Unlinked OID</strong>, etc. Install common MIBs like so-</p><p></p><p><em>sudo apt-get install snmp-mibs-downloader</em></p><p></p><p><h1>Local Recon</h1></p><p>Some information (&amp; potentially some communities) can&#39;t be found via Remote Recon</p><p></p><p><h2>Things to Look For</h2></p><p><h3>Configuration Files</h3></p><p><em>find / -name &quot;*snmp*.conf&quot; 2&gt;/dev/null</em></p><p></p><p><h3>Additional Communities</h3></p><p>Some communities may only be accessible locally (or via whitelisted IPs). These <span style="color:#ff0000;">won&#39;t show up from remote onesixtyone enum</span>.</p><p></p><p>You may need to find them by enumerating the File System &amp; running processes for references to these communities.</p><p></p><p><h3>Triggered Processes</h3></p><p>If you can&#39;t view SNMP files locally, try querying again <span style="color:#ff0000;">while Pspy is running to capture activity in full</span>!</p><p></p><p>This activity may only appear when querying a specific community, or by using certain arguments. For example,</p><p></p><p><em>snmpbulkwalk -c public -v2c 192.168.213.149 NET-SNMP-EXTEND-MIB::nsExtendObjects</em></p><p></p><p><h1>Example OIDs</h1></p><p>OIDs can be appended to snmpwalk for querying specific info.</p><p>For example, the following MIB values correspond to specific Microsoft Windows SNMP parameters and contain much more than network-based information:</p><p></p><p><table class="table"><tr><th> </th><th> </th></tr><tr><td>1.3.6.1.2.1.25.1.6.0</td><td>System Processes</td></tr><tr><td>1.3.6.1.2.1.25.4.2.1.2</td><td>Running Programs</td></tr><tr><td>1.3.6.1.2.1.25.4.2.1.4</td><td>Processes Path</td></tr><tr><td>1.3.6.1.2.1.25.2.3.1.4</td><td>Storage Units</td></tr><tr><td>1.3.6.1.2.1.25.6.3.1.2</td><td>Software Name</td></tr><tr><td>1.3.6.1.4.1.77.1.2.25</td><td>User Accounts</td></tr><tr><td>1.3.6.1.2.1.6.13.1.3</td><td>TCP Local Ports</td></tr></table></p><p></p><p></p><p></p><p><h1>RCE</h1></p><p>[SVCs 25-28]</p></div>
</body>
</html>
